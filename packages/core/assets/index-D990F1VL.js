var vt=Object.defineProperty;var wt=(t,r,n)=>r in t?vt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var ce=(t,r,n)=>wt(t,typeof r!="symbol"?r+"":r,n);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var le,I,Ze,X,De,Xe,Ye,et,Ce,xe,ve,tt,se={},rt=[],_t=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,oe=Array.isArray;function W(t,r){for(var n in r)t[n]=r[n];return t}function Te(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Se(t,r,n){var a,i,s,o={};for(s in r)s=="key"?a=r[s]:s=="ref"?i=r[s]:o[s]=r[s];if(arguments.length>2&&(o.children=arguments.length>3?le.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return ne(t,o,a,i,null)}function ne(t,r,n,a,i){var s={type:t,props:r,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Ze,__i:-1,__u:0};return i==null&&I.vnode!=null&&I.vnode(s),s}function ee(t){return t.children}function ae(t,r){this.props=t,this.context=r}function te(t,r){if(r==null)return t.__?te(t.__,t.__i+1):null;for(var n;r<t.__k.length;r++)if((n=t.__k[r])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?te(t):null}function nt(t){var r,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,r=0;r<t.__k.length;r++)if((n=t.__k[r])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return nt(t)}}function we(t){(!t.__d&&(t.__d=!0)&&X.push(t)&&!he.__r++||De!=I.debounceRendering)&&((De=I.debounceRendering)||Xe)(he)}function he(){for(var t,r,n,a,i,s,o,d=1;X.length;)X.length>d&&X.sort(Ye),t=X.shift(),d=X.length,t.__d&&(n=void 0,i=(a=(r=t).__v).__e,s=[],o=[],r.__P&&((n=W({},a)).__v=a.__v+1,I.vnode&&I.vnode(n),Ee(r.__P,n,a,r.__n,r.__P.namespaceURI,32&a.__u?[i]:null,s,i??te(a),!!(32&a.__u),o),n.__v=a.__v,n.__.__k[n.__i]=n,it(s,n,o),n.__e!=i&&nt(n)));he.__r=0}function at(t,r,n,a,i,s,o,d,l,m,b){var c,x,p,u,h,g,w=a&&a.__k||rt,y=r.length;for(l=Nt(n,r,w,l,y),c=0;c<y;c++)(p=n.__k[c])!=null&&(x=p.__i==-1?se:w[p.__i]||se,p.__i=c,g=Ee(t,p,x,i,s,o,d,l,m,b),u=p.__e,p.ref&&x.ref!=p.ref&&(x.ref&&Ae(x.ref,null,p),b.push(p.ref,p.__c||u,p)),h==null&&u!=null&&(h=u),4&p.__u||x.__k===p.__k?l=st(p,l,t):typeof p.type=="function"&&g!==void 0?l=g:u&&(l=u.nextSibling),p.__u&=-7);return n.__e=h,l}function Nt(t,r,n,a,i){var s,o,d,l,m,b=n.length,c=b,x=0;for(t.__k=new Array(i),s=0;s<i;s++)(o=r[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=s+x,(o=t.__k[s]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?ne(null,o,null,null,null):oe(o)?ne(ee,{children:o},null,null,null):o.constructor==null&&o.__b>0?ne(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,d=null,(m=o.__i=kt(o,n,l,c))!=-1&&(c--,(d=n[m])&&(d.__u|=2)),d==null||d.__v==null?(m==-1&&(i>b?x--:i<b&&x++),typeof o.type!="function"&&(o.__u|=4)):m!=l&&(m==l-1?x--:m==l+1?x++:(m>l?x--:x++,o.__u|=4))):t.__k[s]=null;if(c)for(s=0;s<b;s++)(d=n[s])!=null&&!(2&d.__u)&&(d.__e==a&&(a=te(d)),ot(d,d));return a}function st(t,r,n){var a,i;if(typeof t.type=="function"){for(a=t.__k,i=0;a&&i<a.length;i++)a[i]&&(a[i].__=t,r=st(a[i],r,n));return r}t.__e!=r&&(r&&t.type&&!n.contains(r)&&(r=te(t)),n.insertBefore(t.__e,r||null),r=t.__e);do r=r&&r.nextSibling;while(r!=null&&r.nodeType==8);return r}function _e(t,r){return r=r||[],t==null||typeof t=="boolean"||(oe(t)?t.some(function(n){_e(n,r)}):r.push(t)),r}function kt(t,r,n,a){var i,s,o=t.key,d=t.type,l=r[n];if(l===null&&t.key==null||l&&o==l.key&&d==l.type&&!(2&l.__u))return n;if(a>(l!=null&&!(2&l.__u)?1:0))for(i=n-1,s=n+1;i>=0||s<r.length;){if(i>=0){if((l=r[i])&&!(2&l.__u)&&o==l.key&&d==l.type)return i;i--}if(s<r.length){if((l=r[s])&&!(2&l.__u)&&o==l.key&&d==l.type)return s;s++}}return-1}function Ie(t,r,n){r[0]=="-"?t.setProperty(r,n??""):t[r]=n==null?"":typeof n!="number"||_t.test(r)?n:n+"px"}function de(t,r,n,a,i){var s,o;e:if(r=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof a=="string"&&(t.style.cssText=a=""),a)for(r in a)n&&r in n||Ie(t.style,r,"");if(n)for(r in n)a&&n[r]==a[r]||Ie(t.style,r,n[r])}else if(r[0]=="o"&&r[1]=="n")s=r!=(r=r.replace(et,"$1")),o=r.toLowerCase(),r=o in t||r=="onFocusOut"||r=="onFocusIn"?o.slice(2):r.slice(2),t.l||(t.l={}),t.l[r+s]=n,n?a?n.u=a.u:(n.u=Ce,t.addEventListener(r,s?ve:xe,s)):t.removeEventListener(r,s?ve:xe,s);else{if(i=="http://www.w3.org/2000/svg")r=r.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(r!="width"&&r!="height"&&r!="href"&&r!="list"&&r!="form"&&r!="tabIndex"&&r!="download"&&r!="rowSpan"&&r!="colSpan"&&r!="role"&&r!="popover"&&r in t)try{t[r]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&r[4]!="-"?t.removeAttribute(r):t.setAttribute(r,r=="popover"&&n==1?"":n))}}function Le(t){return function(r){if(this.l){var n=this.l[r.type+t];if(r.t==null)r.t=Ce++;else if(r.t<n.u)return;return n(I.event?I.event(r):r)}}}function Ee(t,r,n,a,i,s,o,d,l,m){var b,c,x,p,u,h,g,w,y,v,_,S,N,$,f,C,U,T=r.type;if(r.constructor!=null)return null;128&n.__u&&(l=!!(32&n.__u),s=[d=r.__e=n.__e]),(b=I.__b)&&b(r);e:if(typeof T=="function")try{if(w=r.props,y="prototype"in T&&T.prototype.render,v=(b=T.contextType)&&a[b.__c],_=b?v?v.props.value:b.__:a,n.__c?g=(c=r.__c=n.__c).__=c.__E:(y?r.__c=c=new T(w,_):(r.__c=c=new ae(w,_),c.constructor=T,c.render=Tt),v&&v.sub(c),c.props=w,c.state||(c.state={}),c.context=_,c.__n=a,x=c.__d=!0,c.__h=[],c._sb=[]),y&&c.__s==null&&(c.__s=c.state),y&&T.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=W({},c.__s)),W(c.__s,T.getDerivedStateFromProps(w,c.__s))),p=c.props,u=c.state,c.__v=r,x)y&&T.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),y&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(y&&T.getDerivedStateFromProps==null&&w!==p&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(w,_),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(w,c.__s,_)===!1||r.__v==n.__v){for(r.__v!=n.__v&&(c.props=w,c.state=c.__s,c.__d=!1),r.__e=n.__e,r.__k=n.__k,r.__k.some(function(P){P&&(P.__=r)}),S=0;S<c._sb.length;S++)c.__h.push(c._sb[S]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(w,c.__s,_),y&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(p,u,h)})}if(c.context=_,c.props=w,c.__P=t,c.__e=!1,N=I.__r,$=0,y){for(c.state=c.__s,c.__d=!1,N&&N(r),b=c.render(c.props,c.state,c.context),f=0;f<c._sb.length;f++)c.__h.push(c._sb[f]);c._sb=[]}else do c.__d=!1,N&&N(r),b=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++$<25);c.state=c.__s,c.getChildContext!=null&&(a=W(W({},a),c.getChildContext())),y&&!x&&c.getSnapshotBeforeUpdate!=null&&(h=c.getSnapshotBeforeUpdate(p,u)),C=b,b!=null&&b.type===ee&&b.key==null&&(C=lt(b.props.children)),d=at(t,oe(C)?C:[C],r,n,a,i,s,o,d,l,m),c.base=r.__e,r.__u&=-161,c.__h.length&&o.push(c),g&&(c.__E=c.__=null)}catch(P){if(r.__v=null,l||s!=null)if(P.then){for(r.__u|=l?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;s[s.indexOf(d)]=null,r.__e=d}else for(U=s.length;U--;)Te(s[U]);else r.__e=n.__e,r.__k=n.__k;I.__e(P,r,n)}else s==null&&r.__v==n.__v?(r.__k=n.__k,r.__e=n.__e):d=r.__e=Ct(n.__e,r,n,a,i,s,o,l,m);return(b=I.diffed)&&b(r),128&r.__u?void 0:d}function it(t,r,n){for(var a=0;a<n.length;a++)Ae(n[a],n[++a],n[++a]);I.__c&&I.__c(r,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){I.__e(s,i.__v)}})}function lt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:oe(t)?t.map(lt):W({},t)}function Ct(t,r,n,a,i,s,o,d,l){var m,b,c,x,p,u,h,g=n.props,w=r.props,y=r.type;if(y=="svg"?i="http://www.w3.org/2000/svg":y=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(m=0;m<s.length;m++)if((p=s[m])&&"setAttribute"in p==!!y&&(y?p.localName==y:p.nodeType==3)){t=p,s[m]=null;break}}if(t==null){if(y==null)return document.createTextNode(w);t=document.createElementNS(i,y,w.is&&w),d&&(I.__m&&I.__m(r,s),d=!1),s=null}if(y==null)g===w||d&&t.data==w||(t.data=w);else{if(s=s&&le.call(t.childNodes),g=n.props||se,!d&&s!=null)for(g={},m=0;m<t.attributes.length;m++)g[(p=t.attributes[m]).name]=p.value;for(m in g)if(p=g[m],m!="children"){if(m=="dangerouslySetInnerHTML")c=p;else if(!(m in w)){if(m=="value"&&"defaultValue"in w||m=="checked"&&"defaultChecked"in w)continue;de(t,m,null,p,i)}}for(m in w)p=w[m],m=="children"?x=p:m=="dangerouslySetInnerHTML"?b=p:m=="value"?u=p:m=="checked"?h=p:d&&typeof p!="function"||g[m]===p||de(t,m,p,g[m],i);if(b)d||c&&(b.__html==c.__html||b.__html==t.innerHTML)||(t.innerHTML=b.__html),r.__k=[];else if(c&&(t.innerHTML=""),at(r.type=="template"?t.content:t,oe(x)?x:[x],r,n,a,y=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&te(n,0),d,l),s!=null)for(m=s.length;m--;)Te(s[m]);d||(m="value",y=="progress"&&u==null?t.removeAttribute("value"):u!=null&&(u!==t[m]||y=="progress"&&!u||y=="option"&&u!=g[m])&&de(t,m,u,g[m],i),m="checked",h!=null&&h!=t[m]&&de(t,m,h,g[m],i))}return t}function Ae(t,r,n){try{if(typeof t=="function"){var a=typeof t.__u=="function";a&&t.__u(),a&&r==null||(t.__u=t(r))}else t.current=r}catch(i){I.__e(i,n)}}function ot(t,r,n){var a,i;if(I.unmount&&I.unmount(t),(a=t.ref)&&(a.current&&a.current!=t.__e||Ae(a,null,r)),(a=t.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(s){I.__e(s,r)}a.base=a.__P=null}if(a=t.__k)for(i=0;i<a.length;i++)a[i]&&ot(a[i],r,n||typeof t.type!="function");n||Te(t.__e),t.__c=t.__=t.__e=void 0}function Tt(t,r,n){return this.constructor(t,n)}function St(t,r,n){var a,i,s,o;r==document&&(r=document.documentElement),I.__&&I.__(t,r),i=(a=!1)?null:r.__k,s=[],o=[],Ee(r,t=r.__k=Se(ee,null,[t]),i||se,se,r.namespaceURI,i?null:r.firstChild?le.call(r.childNodes):null,s,i?i.__e:r.firstChild,a,o),it(s,t,o)}function Et(t,r,n){var a,i,s,o,d=W({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),r)s=="key"?a=r[s]:s=="ref"?i=r[s]:d[s]=r[s]===void 0&&o!=null?o[s]:r[s];return arguments.length>2&&(d.children=arguments.length>3?le.call(arguments,2):n),ne(t.type,d,a||t.key,i||t.ref,null)}function At(t){function r(n){var a,i;return this.getChildContext||(a=new Set,(i={})[r.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){a=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&a.forEach(function(o){o.__e=!0,we(o)})},this.sub=function(s){a.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){a&&a.delete(s),o&&o.call(s)}}),n.children}return r.__c="__cC"+tt++,r.__=t,r.Provider=r.__l=(r.Consumer=function(n,a){return n.children(a)}).contextType=r,r}le=rt.slice,I={__e:function(t,r,n,a){for(var i,s,o;r=r.__;)if((i=r.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,a||{}),o=i.__d),o)return i.__E=i}catch(d){t=d}throw t}},Ze=0,ae.prototype.setState=function(t,r){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=W({},this.state),typeof t=="function"&&(t=t(W({},n),this.props)),t&&W(n,t),t!=null&&this.__v&&(r&&this._sb.push(r),we(this))},ae.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),we(this))},ae.prototype.render=ee,X=[],Xe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ye=function(t,r){return t.__v.__b-r.__v.__b},he.__r=0,et=/(PointerCapture)$|Capture$/i,Ce=0,xe=Le(!1),ve=Le(!0),tt=0;var $t=0;function e(t,r,n,a,i,s){r||(r={});var o,d,l=r;if("ref"in l)for(d in l={},r)d=="ref"?o=r[d]:l[d]=r[d];var m={type:t,props:l,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--$t,__i:-1,__u:0,__source:i,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(d in o)l[d]===void 0&&(l[d]=o[d]);return I.vnode&&I.vnode(m),m}var ie,O,fe,Oe,pe=0,ct=[],q=I,Me=q.__b,qe=q.__r,ze=q.diffed,Ke=q.__c,Be=q.unmount,Re=q.__;function $e(t,r){q.__h&&q.__h(O,t,pe||r),pe=0;var n=O.__H||(O.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function k(t){return pe=1,Ft(ut,t)}function Ft(t,r,n){var a=$e(ie++,2);if(a.t=t,!a.__c&&(a.__=[ut(void 0,r),function(d){var l=a.__N?a.__N[0]:a.__[0],m=a.t(l,d);l!==m&&(a.__N=[m,a.__[1]],a.__c.setState({}))}],a.__c=O,!O.__f)){var i=function(d,l,m){if(!a.__c.__H)return!0;var b=a.__c.__H.__.filter(function(x){return!!x.__c});if(b.every(function(x){return!x.__N}))return!s||s.call(this,d,l,m);var c=a.__c.props!==d;return b.forEach(function(x){if(x.__N){var p=x.__[0];x.__=x.__N,x.__N=void 0,p!==x.__[0]&&(c=!0)}}),s&&s.call(this,d,l,m)||c};O.__f=!0;var s=O.shouldComponentUpdate,o=O.componentWillUpdate;O.componentWillUpdate=function(d,l,m){if(this.__e){var b=s;s=void 0,i(d,l,m),s=b}o&&o.call(this,d,l,m)},O.shouldComponentUpdate=i}return a.__N||a.__}function R(t,r){var n=$e(ie++,3);!q.__s&&dt(n.__H,r)&&(n.__=t,n.u=r,O.__H.__h.push(n))}function jt(t){return pe=5,Pt(function(){return{current:t}},[])}function Pt(t,r){var n=$e(ie++,7);return dt(n.__H,r)&&(n.__=t(),n.__H=r,n.__h=t),n.__}function Ut(){for(var t;t=ct.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(me),t.__H.__h.forEach(Ne),t.__H.__h=[]}catch(r){t.__H.__h=[],q.__e(r,t.__v)}}q.__b=function(t){O=null,Me&&Me(t)},q.__=function(t,r){t&&r.__k&&r.__k.__m&&(t.__m=r.__k.__m),Re&&Re(t,r)},q.__r=function(t){qe&&qe(t),ie=0;var r=(O=t.__c).__H;r&&(fe===O?(r.__h=[],O.__h=[],r.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(r.__h.forEach(me),r.__h.forEach(Ne),r.__h=[],ie=0)),fe=O},q.diffed=function(t){ze&&ze(t);var r=t.__c;r&&r.__H&&(r.__H.__h.length&&(ct.push(r)!==1&&Oe===q.requestAnimationFrame||((Oe=q.requestAnimationFrame)||Dt)(Ut)),r.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),fe=O=null},q.__c=function(t,r){r.some(function(n){try{n.__h.forEach(me),n.__h=n.__h.filter(function(a){return!a.__||Ne(a)})}catch(a){r.some(function(i){i.__h&&(i.__h=[])}),r=[],q.__e(a,n.__v)}}),Ke&&Ke(t,r)},q.unmount=function(t){Be&&Be(t);var r,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(a){try{me(a)}catch(i){r=i}}),n.__H=void 0,r&&q.__e(r,n.__v))};var He=typeof requestAnimationFrame=="function";function Dt(t){var r,n=function(){clearTimeout(a),He&&cancelAnimationFrame(r),setTimeout(t)},a=setTimeout(n,35);He&&(r=requestAnimationFrame(n))}function me(t){var r=O,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),O=r}function Ne(t){var r=O;t.__c=t.__(),O=r}function dt(t,r){return!t||t.length!==r.length||r.some(function(n,a){return n!==t[a]})}function ut(t,r){return typeof r=="function"?r(t):r}var It={};function ue(t,r){for(var n in r)t[n]=r[n];return t}function Lt(t,r,n){var a,i=/(?:\?([^#]*))?(#.*)?$/,s=t.match(i),o={};if(s&&s[1])for(var d=s[1].split("&"),l=0;l<d.length;l++){var m=d[l].split("=");o[decodeURIComponent(m[0])]=decodeURIComponent(m.slice(1).join("="))}t=ke(t.replace(i,"")),r=ke(r||"");for(var b=Math.max(t.length,r.length),c=0;c<b;c++)if(r[c]&&r[c].charAt(0)===":"){var x=r[c].replace(/(^:|[+*?]+$)/g,""),p=(r[c].match(/[+*?]+$/)||It)[0]||"",u=~p.indexOf("+"),h=~p.indexOf("*"),g=t[c]||"";if(!g&&!h&&(p.indexOf("?")<0||u)){a=!1;break}if(o[x]=decodeURIComponent(g),u||h){o[x]=t.slice(c).map(decodeURIComponent).join("/");break}}else if(r[c]!==t[c]){a=!1;break}return(n.default===!0||a!==!1)&&o}function Ot(t,r){return t.rank<r.rank?1:t.rank>r.rank?-1:t.index-r.index}function Mt(t,r){return t.index=r,t.rank=function(n){return n.props.default?0:ke(n.props.path).map(qt).join("")}(t),t.props}function ke(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function qt(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var zt={},Y=[],Ve=[],B=null,mt={url:Fe()},Kt=At(mt);function Fe(){var t;return""+((t=B&&B.location?B.location:B&&B.getCurrentLocation?B.getCurrentLocation():typeof location<"u"?location:zt).pathname||"")+(t.search||"")}function ht(t,r){return r===void 0&&(r=!1),typeof t!="string"&&t.url&&(r=t.replace,t=t.url),function(n){for(var a=Y.length;a--;)if(Y[a].canRoute(n))return!0;return!1}(t)&&function(n,a){a===void 0&&(a="push"),B&&B[a]?B[a](n):typeof history<"u"&&history[a+"State"]&&history[a+"State"](null,null,n)}(t,r?"replace":"push"),pt(t)}function pt(t){for(var r=!1,n=0;n<Y.length;n++)Y[n].routeTo(t)&&(r=!0);return r}function Bt(t){if(t&&t.getAttribute){var r=t.getAttribute("href"),n=t.getAttribute("target");if(r&&r.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return ht(r)}}function Rt(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Ht(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var r=t.target;do if(r.localName==="a"&&r.getAttribute("href")){if(r.hasAttribute("data-native")||r.hasAttribute("native"))return;if(Bt(r))return Rt(t)}while(r=r.parentNode)}}var We=!1;function ft(t){t.history&&(B=t.history),this.state={url:t.url||Fe()}}ue(ft.prototype=new ae,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var r=_e(this.props.children);return this.g(r,t)!==void 0},routeTo:function(t){this.setState({url:t});var r=this.canRoute(t);return this.p||this.forceUpdate(),r},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;We||(We=!0,B||addEventListener("popstate",function(){pt(Fe())}),addEventListener("click",Ht)),Y.push(this),B&&(this.u=B.listen(function(r){var n=r.location||r;t.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Y.splice(Y.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,r){t=t.filter(Mt).sort(Ot);for(var n=0;n<t.length;n++){var a=t[n],i=Lt(r,a.props.path,a.props);if(i)return[a,i]}},render:function(t,r){var n,a,i=t.onChange,s=r.url,o=this.c,d=this.g(_e(t.children),s);if(d&&(a=Et(d[0],ue(ue({url:s,matches:n=d[1]},n),{key:void 0,ref:void 0}))),s!==(o&&o.url)){ue(mt,o=this.c={url:s,previous:o&&o.url,current:a,path:a?a.props.path:null,matches:n}),o.router=this,o.active=a?[a]:[];for(var l=Ve.length;l--;)Ve[l]({});typeof i=="function"&&i(o)}return Se(Kt.Provider,{value:o},a)}});var G=function(t){return Se(t.component,t)};function gt(t){var r,n,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(n=gt(t[r]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n);return a}function Vt(){for(var t,r,n=0,a="",i=arguments.length;n<i;n++)(t=arguments[n])&&(r=gt(t))&&(a&&(a+=" "),a+=r);return a}function Wt(){R(()=>{const t=async()=>{try{(await fetch(`${window.location.origin}/auth/status`)).status===401&&window.location.pathname!=="/auth/login"&&(console.warn("Session expired, redirecting to login..."),window.location.href="/auth/login")}catch(r){console.debug("Auth check failed on focus:",r)}};return window.addEventListener("focus",t),t(),()=>{window.removeEventListener("focus",t)}},[])}function Jt({children:t}){return Wt(),e("div",{class:"min-h-screen bg-gray-50",children:[e("nav",{class:"bg-white shadow-sm border-b",children:e("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e("div",{class:"flex justify-between h-16",children:[e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0 flex items-center",children:e("h1",{class:"text-xl font-bold text-gray-900",children:"Vibebase"})}),e("div",{class:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[e(Z,{href:"/",children:"Dashboard"}),e(Z,{href:"/database",children:"Database"}),e(Z,{href:"/custom-sql",children:"Custom SQL"}),e(Z,{href:"/storage",children:"Storage"}),e(Z,{href:"/push",children:"Push"}),e(Z,{href:"/auth",children:"Auth"}),e(Z,{href:"/settings",children:"Settings"})]})]}),e("div",{class:"flex items-center space-x-4",children:e("a",{href:"/api/docs/swagger",target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"ðŸ“š API Docs"})})]})})}),e("main",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t})]})}function Z({href:t,children:r}){return e("a",{href:t,onClick:n=>{n.preventDefault(),ht(t)},class:Vt("inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium","hover:border-gray-300 hover:text-gray-700","border-transparent text-gray-500 cursor-pointer"),children:r})}function Qt(){window.location.pathname!=="/auth/login"&&(console.warn("Authentication required, redirecting to login..."),window.location.href="/auth/login")}async function F(t,r={}){const n=await fetch(t,r);if(n.status===401)throw Qt(),new Error("Authentication required");return n}const V=window.location.origin,Gt={async health(){return(await F(`${V}/api/health`)).json()},async getItems(){const t=await F(`${V}/api/items`);if(!t.ok)throw new Error("Failed to fetch items");return t.json()},async createItem(t){const r=await F(`${V}/api/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to create item");return r.json()},async updateItem(t,r){const n=await F(`${V}/api/items/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error("Failed to update item");return n.json()},async deleteItem(t){const r=await F(`${V}/api/items/${t}`,{method:"DELETE"});if(!r.ok)throw new Error("Failed to delete item");return r.json()},async getOAuthProviders(){const t=await F(`${V}/api/admin/oauth/providers`);if(!t.ok){let r="Failed to fetch OAuth providers";try{const n=await t.json();n.error==="Authentication required"?r="Admin authentication required. Please log in to access OAuth settings.":r=n.error||r}catch{}throw new Error(r)}return t.json()},async getOAuthProvider(t){const r=await F(`${V}/api/admin/oauth/providers/${t}`);if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to fetch OAuth provider")}return r.json()},async updateOAuthProvider(t,r){const n=await F(`${V}/api/admin/oauth/providers/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to update OAuth provider")}return n.json()},async toggleOAuthProvider(t,r){const n=await F(`${V}/api/admin/oauth/providers/${t}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_enabled:r})});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to toggle OAuth provider")}return n.json()},async deleteOAuthProvider(t){const r=await F(`${V}/api/admin/oauth/providers/${t}`,{method:"DELETE"});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to delete OAuth provider")}return r.json()},async getSupportedProviders(){const t=await F(`${V}/api/admin/oauth/supported-providers`);if(!t.ok){let r="Failed to fetch supported providers";try{const n=await t.json();n.error==="Authentication required"?r="Admin authentication required. Please log in to access OAuth settings.":r=n.error||r}catch{}throw new Error(r)}return t.json()}},L=window.location.origin,Zt={async getTables(){const t=await F(`${L}/api/tables`);if(!t.ok)throw new Error("Failed to fetch tables");return t.json()},async getTableSchema(t){const r=await F(`${L}/api/tables/${t}/schema`);if(!r.ok)throw new Error("Failed to fetch table schema");return r.json()},async getTableData(t,r=100,n=0){const a=await F(`${L}/api/tables/${t}/data?limit=${r}&offset=${n}`);if(!a.ok)throw new Error("Failed to fetch table data");return a.json()},async createTable(t,r){const n=await F(`${L}/api/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,columns:r})});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to create table")}return n.json()},async dropTable(t){const r=await F(`${L}/api/tables/${t}`,{method:"DELETE"});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to drop table")}return r.json()},async executeSQL(t,r=[]){const n=await F(`${L}/api/tables/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:t,params:r})});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to execute SQL")}return n.json()},async addColumn(t,r){const n=await F(`${L}/api/tables/${t}/columns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to add column")}return n.json()},async renameColumn(t,r,n){const a=await F(`${L}/api/tables/${t}/columns/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldName:r,newName:n})});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to rename column")}return a.json()},async dropColumn(t,r){const n=await F(`${L}/api/tables/${t}/columns/${r}`,{method:"DELETE"});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to drop column")}return n.json()},async modifyColumn(t,r,n){const a=await F(`${L}/api/tables/${t}/columns/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to modify column")}return a.json()},async validateColumnChanges(t,r,n){const a=await F(`${L}/api/tables/${t}/columns/${r}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to validate column changes")}return a.json()},async insertRecord(t,r){const n=await F(`${L}/api/tables/${t}/data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to create record")}return n.json()},async updateRecord(t,r,n){const a=await F(`${L}/api/tables/${t}/data/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const i=await a.json();throw new Error(i.error||"Failed to update record")}return a.json()},async deleteRecord(t,r){const n=await F(`${L}/api/tables/${t}/data/${r.id}`,{method:"DELETE"});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to delete record")}return n.json()},async getSnapshots(t=20,r=0){const n=await F(`${L}/api/snapshots?limit=${t}&offset=${r}`);if(!n.ok)throw new Error("Failed to fetch snapshots");return n.json()},async getSnapshot(t){const r=await F(`${L}/api/snapshots/${t}`);if(!r.ok)throw new Error("Failed to fetch snapshot");return r.json()},async createSnapshot(t){const r=await F(`${L}/api/snapshots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to create snapshot")}return r.json()},async restoreSnapshot(t){const r=await F(`${L}/api/snapshots/${t}/restore`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().catch(()=>({error:"Failed to restore snapshot"}));throw new Error(n.error||"Failed to restore snapshot")}return r.json()},async deleteSnapshot(t){const r=await F(`${L}/api/snapshots/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().catch(()=>({error:"Failed to delete snapshot"}));throw new Error(n.error||"Failed to delete snapshot")}return r.json()},async compareSnapshots(t,r){const n=await F(`${L}/api/snapshots/compare/${t}/${r}`);if(!n.ok)throw new Error("Failed to compare snapshots");return n.json()},async getTableIndexes(t){const r=await F(`${L}/api/tables/${t}/indexes`);if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to fetch table indexes")}return r.json()},async getAllIndexes(){const t=await F(`${L}/api/tables/indexes`);if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to fetch all indexes")}return t.json()},async createIndex(t,r){const n=await F(`${L}/api/tables/${t}/indexes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to create index")}return n.json()},async dropIndex(t,r){const n=await F(`${L}/api/tables/${t}/indexes/${r}`,{method:"DELETE"});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to drop index")}return n.json()},async getTablePolicy(t){const r=await F(`${L}/api/tables/${t}/policy`);if(!r.ok){const n=await r.json();throw new Error(n.error||"Failed to get table policy")}return r.json()},async updateTablePolicy(t,r){const n=await F(`${L}/api/tables/${t}/policy`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_policy:r})});if(!n.ok){const a=await n.json();throw new Error(a.error||"Failed to update table policy")}return n.json()}},M={...Gt,...Zt};function Xt({supportedProvider:t,configuredProvider:r,onUpdate:n}){const[a,i]=k(!1),[s,o]=k(!1),[d,l]=k({client_id:(r==null?void 0:r.client_id)||"",client_secret:(r==null?void 0:r.client_secret)||"",is_enabled:(r==null?void 0:r.is_enabled)||!1,scopes:(r==null?void 0:r.scopes)||t.default_scopes}),[m,b]=k(!1),[c,x]=k(null),p=!!r,u=(r==null?void 0:r.is_enabled)||!1,h=async()=>{if(!d.client_id||!d.client_secret){x("Client ID and Client Secret are required");return}o(!0),x(null);try{await M.updateOAuthProvider(t.provider,d),i(!1),n()}catch(v){x(v instanceof Error?v.message:"Failed to save provider")}finally{o(!1)}},g=async()=>{if(p){o(!0),x(null);try{await M.toggleOAuthProvider(t.provider,!u),n()}catch(v){x(v instanceof Error?v.message:"Failed to toggle provider")}finally{o(!1)}}},w=async()=>{if(!(!p||!confirm(`Are you sure you want to delete the ${t.name} OAuth configuration?`))){o(!0),x(null);try{await M.deleteOAuthProvider(t.provider),n()}catch(v){x(v instanceof Error?v.message:"Failed to delete provider")}finally{o(!1)}}};return e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("div",{class:"flex items-start justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("div",{class:"w-8 h-8 flex items-center justify-center",children:(v=>({google:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Google logo",children:[e("title",{children:"Google logo"}),e("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),github:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"GitHub logo",children:[e("title",{children:"GitHub logo"}),e("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})]}),facebook:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#1877F2","aria-label":"Facebook logo",children:[e("title",{children:"Facebook logo"}),e("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})]}),linkedin:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#0A66C2","aria-label":"LinkedIn logo",children:[e("title",{children:"LinkedIn logo"}),e("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})]}),twitter:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Twitter/X logo",children:[e("title",{children:"Twitter/X logo"}),e("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})]}),apple:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Apple logo",children:[e("title",{children:"Apple logo"}),e("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})]}),microsoft:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Microsoft logo",children:[e("title",{children:"Microsoft logo"}),e("path",{d:"M0 0h11.377v11.372H0z",fill:"#F25022"}),e("path",{d:"M12.623 0H24v11.372H12.623z",fill:"#7FBA00"}),e("path",{d:"M0 12.628h11.377V24H0z",fill:"#00A4EF"}),e("path",{d:"M12.623 12.628H24V24H12.623z",fill:"#FFB900"})]}),discord:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#5865F2","aria-label":"Discord logo",children:[e("title",{children:"Discord logo"}),e("path",{d:"M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419-.0190 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9460 2.4189-2.1568 2.4189Z"})]}),slack:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Slack logo",children:[e("title",{children:"Slack logo"}),e("path",{d:"M5.042 15.165a2.528 2.528 0 01-2.52 2.523A2.528 2.528 0 010 15.165a2.527 2.527 0 012.522-2.52h2.52v2.52z",fill:"#E01E5A"}),e("path",{d:"M6.313 15.165a2.527 2.527 0 012.521-2.52 2.527 2.527 0 012.521 2.52v6.313A2.528 2.528 0 018.834 24a2.528 2.528 0 01-2.521-2.522v-6.313z",fill:"#E01E5A"}),e("path",{d:"M8.834 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 018.834 0a2.528 2.528 0 012.521 2.522v2.52H8.834z",fill:"#36C5F0"}),e("path",{d:"M8.834 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521H2.522A2.528 2.528 0 010 8.834a2.528 2.528 0 012.522-2.521h6.312z",fill:"#36C5F0"}),e("path",{d:"M18.956 8.834a2.528 2.528 0 012.521-2.521A2.528 2.528 0 0124 8.834a2.528 2.528 0 01-2.523 2.521h-2.521V8.834z",fill:"#2EB67D"}),e("path",{d:"M17.688 8.834a2.528 2.528 0 01-2.523 2.521 2.527 2.527 0 01-2.52-2.521V2.522A2.527 2.527 0 0115.165 0a2.528 2.528 0 012.523 2.522v6.312z",fill:"#2EB67D"}),e("path",{d:"M15.165 18.956a2.528 2.528 0 012.523 2.521A2.528 2.528 0 0115.165 24a2.527 2.527 0 01-2.52-2.523v-2.521h2.52z",fill:"#ECB22E"}),e("path",{d:"M15.165 17.688a2.527 2.527 0 01-2.52-2.523 2.526 2.526 0 012.52-2.52h6.313A2.527 2.527 0 0124 15.165a2.528 2.528 0 01-2.522 2.523h-6.313z",fill:"#ECB22E"})]})})[v]||e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Default provider logo",children:[e("title",{children:"Default provider logo"}),e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})]}))(t.provider)}),e("div",{children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:t.name}),e("div",{class:"flex items-center gap-2 mt-1",children:[e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p?u?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:p?u?"Enabled":"Disabled":"Not Configured"}),t.note&&e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.note})]})]})]}),e("div",{class:"flex items-center gap-2",children:[p&&e("button",{type:"button",onClick:g,disabled:s,class:`px-3 py-1 text-sm rounded-md font-medium transition-colors ${u?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"} disabled:opacity-50`,children:u?"Disable":"Enable"}),e("button",{type:"button",onClick:()=>i(!a),disabled:s,class:"px-3 py-1 text-sm rounded-md font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors disabled:opacity-50",children:a?"Cancel":p?"Edit":"Configure"})]})]}),c&&e("div",{class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:c})}),a?e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"client_id",class:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),e("input",{id:"client_id",type:"text",value:d.client_id,onInput:v=>l({...d,client_id:v.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client ID"})]}),e("div",{children:[e("label",{htmlFor:"client_secret",class:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),e("div",{class:"relative",children:[e("input",{id:"client_secret",type:m?"text":"password",value:d.client_secret,onInput:v=>l({...d,client_secret:v.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client Secret"}),e("button",{type:"button",onClick:()=>b(!m),class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:m?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),e("div",{children:[e("div",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{class:"flex flex-wrap gap-2",children:d.scopes.map(v=>e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:v},v))})]}),e("div",{class:"flex items-center gap-3 pt-4",children:[e("button",{type:"button",onClick:h,disabled:s,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Saving...":"Save Configuration"}),p&&e("button",{type:"button",onClick:w,disabled:s,class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]}):e("div",{class:"space-y-3",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Setup Instructions:"}),e("p",{class:"mt-1",children:t.setup_instructions})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"OAuth Callback URL for Provider:"}),e("br",{}),e("code",{class:"px-2 py-1 bg-gray-100 rounded text-xs",children:[window.location.origin,"/api/auth/callback/",t.provider]}),e("p",{class:"mt-1 text-xs text-gray-500",children:"Use this URL when configuring your OAuth application with the provider. After authentication, users will be redirected to your app based on the callback URLs you configure in your application settings."})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Default Scopes:"}),e("div",{class:"flex flex-wrap gap-1 mt-1",children:t.default_scopes.map(v=>e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:v},v))})]}),p&&e("div",{class:"pt-2 border-t border-gray-100",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Status:"})," Configured and ",u?"enabled":"disabled"]}),r&&e("div",{class:"text-sm text-gray-600 mt-1",children:[e("strong",{children:"Last updated:"})," ",new Date(r.updated_at).toLocaleDateString()]})]})]})]})}function Yt(){const[t,r]=k([]),[n,a]=k(""),[i,s]=k(!0),[o,d]=k(!1),[l,m]=k(null),b=async()=>{try{s(!0),m(null);const h=await fetch("/api/app-settings",{credentials:"include"});if(!h.ok)throw new Error("Failed to load app settings");const g=await h.json();r(g.settings.allowed_callback_urls||[])}catch(h){console.error("Failed to load callback URLs:",h),m(h instanceof Error?h.message:"Failed to load callback URLs")}finally{s(!1)}},c=async h=>{try{if(d(!0),m(null),!(await fetch("/api/app-settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({allowed_callback_urls:h})})).ok)throw new Error("Failed to save callback URLs");r(h)}catch(g){console.error("Failed to save callback URLs:",g),m(g instanceof Error?g.message:"Failed to save callback URLs")}finally{d(!1)}},x=async()=>{if(!n.trim())return;const h=[...t,n.trim()];await c(h),a("")},p=async h=>{const g=t.filter((w,y)=>y!==h);await c(g)},u=h=>{h.key==="Enter"&&(h.preventDefault(),x())};return R(()=>{b()},[]),i?e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading callback URLs..."})}):e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"Allowed Callback URLs"}),e("p",{class:"text-gray-600 mt-2",children:"Configure URLs where users can be redirected after OAuth authentication. Supports web URLs (https://), mobile deep links (myapp://), and localhost for development."})]}),l&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:l})}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:"Add Callback URL"}),e("div",{class:"flex gap-3",children:[e("input",{type:"text",value:n,onInput:h=>{const g=h.target;a(g.value)},onKeyPress:u,placeholder:"https://myapp.com/auth/callback or myapp://auth/callback",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e("button",{type:"button",onClick:x,disabled:!n.trim()||o,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Adding...":"Add URL"})]})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:["Configured URLs (",t.length,")"]}),t.length===0?e("div",{class:"text-center py-8 text-gray-500",children:[e("p",{class:"mb-2",children:"No callback URLs configured"}),e("p",{class:"text-sm",children:"When no URLs are configured, any callback URL will be allowed (for backward compatibility)"})]}):e("div",{class:"space-y-3",children:t.map((h,g)=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex-1",children:[e("code",{class:"text-sm text-gray-800",children:h}),e("div",{class:"text-xs text-gray-500 mt-1",children:h.startsWith("https://")?"ðŸŒ Web App":h.startsWith("http://localhost")||h.startsWith("http://127.0.0.1")?"ðŸ”§ Development":h.includes("://")?"ðŸ“± Mobile/Desktop App":"â“ Unknown"})]}),e("button",{type:"button",onClick:()=>p(g),disabled:o,class:"ml-3 text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50",children:"Remove"})]},`callback-url-${g}-${h}`))})]}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-blue-900 mb-3",children:"URL Format Examples"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:[e("strong",{children:"Web Applications:"})," ",e("code",{children:"https://myapp.com/auth/callback"})]}),e("p",{children:[e("strong",{children:"Mobile Apps:"})," ",e("code",{children:"myapp://auth/callback"})," or"," ",e("code",{children:"com.example.myapp://callback"})]}),e("p",{children:[e("strong",{children:"Desktop Apps:"})," ",e("code",{children:"myapp://localhost/callback"})]}),e("p",{children:[e("strong",{children:"Development:"})," ",e("code",{children:"http://localhost:3000/callback"})," or"," ",e("code",{children:"http://127.0.0.1:8080/auth"})]})]})]}),e("div",{class:"mt-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-gray-900 mb-3",children:"API Usage"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("p",{children:e("strong",{children:"Login with callback:"})}),e("code",{class:"block bg-white p-2 rounded border",children:"GET /api/auth/login/google?callback_url=https://myapp.com/auth/callback"}),e("p",{class:"mt-3",children:e("strong",{children:"The callback response includes:"})}),e("code",{class:"block bg-white p-2 rounded border text-xs",children:JSON.stringify({success:!0,access_token:"...",refresh_token:"...",user:{id:"...",email:"...",name:"..."},return_url:"https://myapp.com/auth/callback"},null,2)})]})]})]})}function er(){const[t,r]=k("providers"),[n,a]=k([]),[i,s]=k([]),[o,d]=k(!0),[l,m]=k(null),b=async()=>{d(!0),m(null);try{const[u,h]=await Promise.all([M.getSupportedProviders(),M.getOAuthProviders()]);a(u.supported_providers),s(h.providers)}catch(u){m(u instanceof Error?u.message:"Failed to load OAuth providers"),console.error("Error loading OAuth providers:",u)}finally{d(!1)}};R(()=>{b()},[]);const c=u=>i.find(h=>h.provider===u),x=i.filter(u=>u.is_enabled).length,p=i.length;return o?e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading OAuth providers..."})})]}):e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{type:"button",onClick:()=>r("providers"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="providers"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"OAuth Providers"}),e("button",{type:"button",onClick:()=>r("callback-urls"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="callback-urls"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Callback URLs"})]})}),e("div",{class:"flex-1 min-w-0",children:[t==="providers"&&e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"OAuth Providers"}),e("p",{class:"text-gray-600 mt-2",children:"Configure OAuth providers to enable user authentication in your applications"})]}),l&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-sm text-red-600",children:l}),l.includes("authentication required")?e("div",{class:"mt-3",children:[e("p",{class:"text-sm text-red-700 mb-2",children:"You need to log in as an administrator to manage OAuth settings."}),e("a",{href:"/",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Go to Dashboard"})]}):e("button",{type:"button",onClick:b,class:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]}),e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-gray-900",children:n.length}),e("div",{class:"text-sm text-gray-600",children:"Supported Providers"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-blue-600",children:p}),e("div",{class:"text-sm text-gray-600",children:"Configured"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-green-600",children:x}),e("div",{class:"text-sm text-gray-600",children:"Enabled"})]})]}),e("div",{class:"space-y-6",children:n.map(u=>e(Xt,{supportedProvider:u,configuredProvider:c(u.provider),onUpdate:b},u.provider))}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-blue-900 mb-3",children:"Getting Started"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:["1. ",e("strong",{children:"Choose a provider:"}),' Click "Configure" on any OAuth provider you want to enable']}),e("p",{children:["2. ",e("strong",{children:"Create OAuth app:"})," Follow the setup instructions to create an OAuth application"]}),e("p",{children:["3. ",e("strong",{children:"Configure credentials:"})," Enter your Client ID and Client Secret"]}),e("p",{children:["4. ",e("strong",{children:"Enable provider:"}),' Toggle the provider to "Enabled" status']}),e("p",{children:["5. ",e("strong",{children:"Test authentication:"})," Users can now authenticate with this provider"]})]})]}),e("div",{class:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900 mb-3",children:"Authentication Endpoints"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("div",{children:[e("strong",{children:"Available providers:"})," ",e("code",{children:"GET /api/auth/providers"})]}),e("div",{children:[e("strong",{children:"Start authentication:"})," ",e("code",{children:["GET /api/auth/login/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"OAuth callback:"})," ",e("code",{children:["GET /api/auth/callback/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"Get user info:"})," ",e("code",{children:"GET /api/auth/me"})]}),e("div",{children:[e("strong",{children:"Refresh token:"})," ",e("code",{children:"POST /api/auth/refresh"})]}),e("div",{children:[e("strong",{children:"Logout:"})," ",e("code",{children:"POST /api/auth/logout"})]})]})]})]}),t==="callback-urls"&&e(Yt,{})]})]})]})}const Je=t=>{if(!t.trim())return Date.now().toString(36).slice(-8).padStart(8,"0");let r=t.length+1e3;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);r=r*31+s,r=r&2147483647}let n="",a=r;for(let i=0;i<8;i++){a=a*1664525+1013904223&2147483647;const s=a%36;n+=s.toString(36)}return n},tr=t=>{const r=/:(\w+)/g,n=new Set;let a;for(a=r.exec(t);a!==null;)n.add(a[1]),a=r.exec(t);return Array.from(n).map(i=>({name:i,type:"string",required:!0,description:""}))},ge=t=>{const r=t.trim().toLowerCase(),n=r.startsWith("select"),a=r.includes("pragma");return{method:n?"GET":"POST",readonly:n||a}},rr=t=>{const r={};if(t.name.trim()||(r.name="ã‚¯ã‚¨ãƒªåã¯å¿…é ˆã§ã™"),t.slug.trim()?/^[a-z0-9_-]+$/.test(t.slug)||(r.slug="ã‚¹ãƒ©ãƒƒã‚°ã¯å°æ–‡å­—ã®è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™"):r.slug="ã‚¹ãƒ©ãƒƒã‚°ã¯å¿…é ˆã§ã™",!t.sql_query.trim())r.sql_query="SQLã‚¯ã‚¨ãƒªã¯å¿…é ˆã§ã™";else{const n=/:(\w+)/g,a=new Set;let i;for(i=n.exec(t.sql_query);i!==null;)a.add(i[1]),i=n.exec(t.sql_query);const s=new Set(t.parameters.map(d=>d.name)),o=Array.from(a).filter(d=>!s.has(d));o.length>0&&(r.sql_query=`SQLã«æœªå®šç¾©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã¾ã™: ${o.join(", ")}`)}return t.parameters.forEach((n,a)=>{n.name.trim()?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n.name)||(r[`parameter_${a}_name`]="ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼åã¯è‹±æ–‡å­—ã¾ãŸã¯ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã§å§‹ã¾ã‚Šã€è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™"):r[`parameter_${a}_name`]="ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼åã¯å¿…é ˆã§ã™"}),r};function nr({isCreating:t,isEditing:r,formData:n,validationErrors:a,error:i,onFormDataChange:s,onValidationErrorsChange:o,onCreate:d,onUpdate:l,onClose:m}){if(!t&&!r)return null;const b=()=>{s({...n,parameters:[...n.parameters,{name:"",type:"string",required:!1}]})},c=u=>{s({...n,parameters:n.parameters.filter((h,g)=>g!==u)})},x=(u,h)=>{if(s({...n,parameters:n.parameters.map((g,w)=>w===u?{...g,...h}:g)}),h.name!==void 0){const g=`parameter_${u}_name`;if(a[g]){const w={...a};delete w[g],o(w)}}},p=u=>{if(a[u]){const h={...a};delete h[u],o(h)}};return e("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:t?"Create Custom Query":"Edit Custom Query"}),i&&e("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:i}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"query-name",className:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{id:"query-name",type:"text",value:n.name,onChange:u=>{const h=u.target.value;s({...n,name:h,slug:t?Je(h):n.slug}),p("name"),t&&p("slug")},className:`mt-1 w-full px-3 py-2 border rounded-md ${a.name?"border-red-500 bg-red-50":"border-gray-300"}`}),a.name&&e("p",{className:"mt-1 text-sm text-red-600",children:a.name})]}),e("div",{children:[e("div",{className:"flex justify-between items-center",children:[e("label",{htmlFor:"query-slug",className:"block text-sm font-medium text-gray-700",children:["Slug",e("span",{className:"text-xs text-gray-500",children:"(auto-generated, but editable)"})]}),e("button",{type:"button",onClick:()=>{s({...n,slug:Je(n.name)}),p("slug")},className:"text-xs text-indigo-600 hover:text-indigo-800",children:"Re-generate from name"})]}),e("input",{id:"query-slug",type:"text",value:n.slug,onChange:u=>{s({...n,slug:u.target.value}),p("slug")},placeholder:"lowercase-with-hyphens",className:`mt-1 w-full px-3 py-2 border rounded-md ${a.slug?"border-red-500 bg-red-50":"border-gray-300"}`}),a.slug&&e("p",{className:"mt-1 text-sm text-red-600",children:a.slug}),e("p",{className:"mt-1 text-sm text-gray-500",children:["This will be the API endpoint: /api/custom/",n.slug||"a1b2c3d4"]})]}),e("div",{children:[e("label",{htmlFor:"query-description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e("input",{id:"query-description",type:"text",value:n.description,onChange:u=>s({...n,description:u.target.value}),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:[e("label",{htmlFor:"query-sql",className:"block text-sm font-medium text-gray-700",children:"SQL Query"}),e("textarea",{id:"query-sql",value:n.sql_query,onChange:u=>{const h=u.target.value,g=tr(h),w=new Set(n.parameters.map(v=>v.name)),y=[...n.parameters.filter(v=>h.includes(`:${v.name}`)),...g.filter(v=>!w.has(v.name))];s({...n,sql_query:h,parameters:y}),p("sql_query")},rows:6,placeholder:"SELECT * FROM users WHERE created_at > :start_date",className:`mt-1 w-full px-3 py-2 border rounded-md font-mono text-sm ${a.sql_query?"border-red-500 bg-red-50":"border-gray-300"}`}),a.sql_query&&e("p",{className:"mt-1 text-sm text-red-600",children:a.sql_query}),e("div",{className:"mt-2 flex justify-between items-center",children:[e("p",{className:"text-sm text-gray-500",children:"Use :parameter_name for parameters (will be auto-detected)"}),n.sql_query&&e("div",{className:"flex gap-2",children:[e("span",{className:`px-2 py-1 rounded text-xs ${ge(n.sql_query).method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:ge(n.sql_query).method}),ge(n.sql_query).readonly&&e("span",{className:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-800",children:"Read-only"})]})]})]}),e("div",{children:[e("div",{className:"flex justify-between items-center mb-2",children:[e("div",{className:"block text-sm font-medium text-gray-700",children:["Parameters",n.parameters.length>0&&e("span",{className:"text-xs text-gray-500 ml-1",children:["(",n.parameters.length," detected)"]})]}),e("button",{type:"button",onClick:b,className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Add Parameter"})]}),n.parameters.length===0?e("div",{className:"text-sm text-gray-500 bg-gray-50 p-3 rounded border-2 border-dashed border-gray-200",children:"No parameters detected. Use :param_name in your SQL query to automatically add parameters here."}):n.parameters.map((u,h)=>e("div",{className:"mb-3",children:[e("div",{className:"flex gap-2 mb-1",children:[e("input",{id:`param-name-${h}`,type:"text",value:u.name,onChange:g=>x(h,{name:g.target.value}),placeholder:"param_name",className:`flex-1 px-3 py-1 border rounded-md text-sm ${a[`parameter_${h}_name`]?"border-red-500 bg-red-50":"border-gray-300"}`}),e("select",{id:`param-type-${h}`,value:u.type,onChange:g=>x(h,{type:g.target.value}),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e("option",{value:"string",children:"String"}),e("option",{value:"number",children:"Number"}),e("option",{value:"boolean",children:"Boolean"}),e("option",{value:"date",children:"Date"})]}),e("label",{htmlFor:`param-required-${h}`,className:"flex items-center",children:[e("input",{id:`param-required-${h}`,type:"checkbox",checked:u.required,onChange:g=>x(h,{required:g.target.checked}),className:"mr-1"}),e("span",{className:"text-sm",children:"Required"})]}),e("button",{type:"button",onClick:()=>c(h),className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),a[`parameter_${h}_name`]&&e("p",{className:"text-xs text-red-600 ml-1",children:a[`parameter_${h}_name`]})]},`param-${u.name}-${h}`))]}),e("div",{children:[e("label",{htmlFor:"query-cache-ttl",className:"block text-sm font-medium text-gray-700",children:"Cache TTL (seconds)"}),e("input",{id:"query-cache-ttl",type:"number",value:n.cache_ttl,onChange:u=>s({...n,cache_ttl:parseInt(u.target.value)||0}),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:e("label",{htmlFor:"query-enabled",className:"flex items-center",children:[e("input",{id:"query-enabled",type:"checkbox",checked:n.enabled,onChange:u=>s({...n,enabled:u.target.checked}),className:"mr-2"}),e("span",{className:"text-sm font-medium text-gray-700",children:"Enabled"})]})})]}),e("div",{className:"flex justify-end gap-2 mt-6",children:[e("button",{type:"button",onClick:m,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"button",onClick:t?d:l,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:t?"Create":"Update"})]})]})})}function ar({queries:t,selectedQuery:r,onSelectQuery:n,onEditClick:a,onDeleteClick:i,onToggleEnabled:s,onCreateClick:o}){return e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Queries"}),e("button",{type:"button",onClick:o,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Create Query"})]}),e("div",{className:"space-y-2",children:t.length===0?e("p",{className:"text-gray-500",children:"No custom queries yet"}):t.map(d=>e("button",{type:"button",className:`text-left w-full p-3 border rounded hover:bg-gray-50 ${(r==null?void 0:r.id)===d.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>{const l={...d,parameters:typeof d.parameters=="string"?JSON.parse(d.parameters||"[]"):d.parameters||[]};n(l)},children:e("div",{className:"flex justify-between items-start",children:[e("div",{children:[e("h4",{className:"font-medium text-gray-900",children:d.name}),e("p",{className:"text-sm text-gray-500",children:["/",d.slug]}),e("div",{className:"flex gap-2 mt-1",children:[e("span",{className:`text-xs px-2 py-1 rounded ${d.method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:d.method}),e("span",{className:`text-xs px-2 py-1 rounded ${d.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:d.enabled?"Enabled":"Disabled"}),d.is_readonly&&e("span",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-800",children:"Read-only"})]})]}),e("div",{className:"flex gap-2",children:[e("button",{type:"button",onClick:l=>{l.stopPropagation(),s(d.id,!d.enabled)},className:d.enabled?"text-orange-600 hover:text-orange-800":"text-green-600 hover:text-green-800",children:d.enabled?"Disable":"Enable"}),e("button",{type:"button",onClick:l=>{l.stopPropagation(),a(d)},className:"text-indigo-600 hover:text-indigo-800",children:"Edit"}),e("button",{type:"button",onClick:l=>{l.stopPropagation(),i(d.id)},className:"text-red-600 hover:text-red-800",children:"Delete"})]})]})},d.id))})]})}function sr({selectedQuery:t,testParams:r,testResult:n,testError:a,testing:i,onTestParamsChange:s,onTest:o}){if(!t)return e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Query Details"}),e("p",{className:"text-gray-500 mt-4",children:"Select a query to view details and test"})]});const d=(l,m,b)=>{let c=m;b==="number"?c=m===""?void 0:Number(m):b==="boolean"?c=m==="true":b==="date"&&(c=m===""?void 0:m),s({...r,[l]:c})};return e("div",{className:"bg-white shadow rounded-lg p-6",children:e("div",{className:"space-y-4",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),t.description&&e("p",{className:"text-gray-600 mt-1",children:t.description}),e("p",{className:"text-sm text-gray-500 mt-2",children:["Endpoint:"," ",e("code",{className:"bg-gray-100 px-1 py-0.5 rounded",children:[t.method," /api/custom/",t.slug]})]})]}),e("div",{children:[e("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"SQL Query"}),e("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-x-auto",children:t.sql_query})]}),t.parameters&&t.parameters.length>0&&e("div",{children:[e("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Test Parameters"}),e("div",{className:"space-y-3",children:t.parameters.map(l=>e("div",{children:[e("label",{htmlFor:`param-${l.name}`,className:"block text-sm font-medium text-gray-700",children:[l.name,l.required&&e("span",{className:"text-red-500 ml-1",children:"*"}),e("span",{className:"text-gray-500 ml-1",children:["(",l.type,")"]})]}),l.description&&e("p",{className:"text-xs text-gray-500 mt-1",children:l.description}),l.type==="boolean"?e("select",{id:`param-${l.name}`,value:String(r[l.name]??""),onChange:m=>d(l.name,m.target.value,l.type),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e("option",{value:"",children:"Select..."}),e("option",{value:"true",children:"true"}),e("option",{value:"false",children:"false"})]}):e("input",{id:`param-${l.name}`,type:l.type==="number"?"number":l.type==="date"?"date":"text",value:String(r[l.name]??""),onChange:m=>d(l.name,m.target.value,l.type),placeholder:l.default?`Default: ${l.default}`:"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]},l.name))})]}),e("button",{type:"button",onClick:o,disabled:i,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:i?"Testing...":"Test Query"}),a&&e("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:[e("h4",{className:"font-medium",children:"Test Error"}),e("p",{className:"mt-1",children:a})]}),n&&e("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e("h4",{className:"font-medium text-green-800 mb-2",children:"Test Results"}),e("div",{className:"text-sm text-green-700 space-y-1",children:[e("p",{children:["Rows returned: ",n.row_count]}),e("p",{children:["Execution time: ",n.execution_time,"ms"]})]}),n.data&&n.data.length>0&&e("div",{className:"mt-3",children:[e("h5",{className:"font-medium text-green-800 mb-2",children:"Sample Data (first 5 rows)"}),e("div",{className:"bg-white rounded border overflow-x-auto",children:e("table",{className:"min-w-full text-sm",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:Object.keys(n.data[0]).map(l=>e("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:l},l))})}),e("tbody",{className:"divide-y divide-gray-200",children:n.data.slice(0,5).map((l,m)=>{const b=l,c=Object.values(b).join("-")||`row-${m}`;return e("tr",{children:Object.entries(b).map(([x,p])=>e("td",{className:"px-3 py-2 text-gray-900",children:String(p)},x))},c)})})]})})]})]})]})})}function ir(t){const{apiConfig:r,initialData:n=[],autoFetch:a=!0,validateFn:i,transformResponse:s=_=>_.data||[],transformItem:o=_=>_.data||_}=t,[d,l]=k({items:n,selectedItem:null,loading:!1,creating:!1,updating:!1,deleting:!1,error:null,validationErrors:{}});R(()=>{a&&b()},[a]);const m=async(_,S={})=>{const N={credentials:"include",headers:{"Content-Type":"application/json",...S.headers},...S},$=await fetch(_,N);if(!$.ok){const f=await $.json().catch(()=>({}));throw new Error(f.error||f.message||`HTTP ${$.status}`)}return $},b=async()=>{l(_=>({..._,loading:!0,error:null}));try{const S=await(await m(r.listEndpoint)).json(),N=s(S);l($=>({...$,items:N,loading:!1}))}catch(_){const S=_ instanceof Error?_.message:"Failed to fetch items";l(N=>({...N,error:S,loading:!1}))}};return{...d,fetchItems:b,createItem:async _=>{if(l(S=>({...S,error:null,validationErrors:{}})),i){const S=i(_);if(Object.keys(S).length>0)return l(N=>({...N,validationErrors:S})),null}l(S=>({...S,creating:!0}));try{const N=await(await m(r.createEndpoint,{method:"POST",body:JSON.stringify(_)})).json(),$=o(N);return l(f=>({...f,items:[...f.items,$],creating:!1})),$}catch(S){const N=S instanceof Error?S.message:"Failed to create item";return l($=>({...$,error:N,creating:!1})),null}},updateItem:async(_,S)=>{if(l(N=>({...N,error:null,validationErrors:{}})),i){const N=i(S);if(Object.keys(N).length>0)return l($=>({...$,validationErrors:N})),null}l(N=>({...N,updating:!0}));try{const $=await(await m(r.updateEndpoint(_),{method:"PUT",body:JSON.stringify(S)})).json(),f=o($);return l(C=>{var U;return{...C,items:C.items.map(T=>T.id===_?f:T),selectedItem:((U=C.selectedItem)==null?void 0:U.id)===_?f:C.selectedItem,updating:!1}}),f}catch(N){const $=N instanceof Error?N.message:"Failed to update item";return l(f=>({...f,error:$,updating:!1})),null}},deleteItem:async _=>{l(S=>({...S,deleting:!0,error:null}));try{return await m(r.deleteEndpoint(_),{method:"DELETE"}),l(S=>{var N;return{...S,items:S.items.filter($=>$.id!==_),selectedItem:((N=S.selectedItem)==null?void 0:N.id)===_?null:S.selectedItem,deleting:!1}}),!0}catch(S){const N=S instanceof Error?S.message:"Failed to delete item";return l($=>({...$,error:N,deleting:!1})),!1}},setSelectedItem:_=>{l(S=>({...S,selectedItem:_}))},setError:_=>{l(S=>({...S,error:_}))},clearValidationErrors:()=>{l(_=>({..._,validationErrors:{}}))},setValidationErrors:_=>{l(S=>({...S,validationErrors:_}))},refreshData:async()=>{await b()},getItemById:_=>d.items.find(S=>S.id===_)}}const lr={baseUrl:window.location.origin,listEndpoint:"/api/custom-queries",getEndpoint:t=>`/api/custom-queries/${t}`,createEndpoint:"/api/custom-queries",updateEndpoint:t=>`/api/custom-queries/${t}`,deleteEndpoint:t=>`/api/custom-queries/${t}`};function or(){const t=ir({apiConfig:lr,validateFn:N=>{const $={slug:N.slug||"",name:N.name||"",description:N.description||"",sql_query:N.sql_query||"",parameters:N.parameters||[],cache_ttl:N.cache_ttl||0,enabled:N.enabled??!0};return rr($)},transformResponse:N=>N.queries||[]}),[r,n]=k(!1),[a,i]=k(!1),[s,o]=k({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),[d,l]=k({}),[m,b]=k(null),[c,x]=k(null),[p,u]=k(!1),h=async()=>{try{await t.createItem(s)&&_()}finally{n(!1)}},g=async()=>{if(t.selectedItem)try{await t.updateItem(t.selectedItem.id,s)&&(t.setSelectedItem(null),_())}finally{i(!1)}},w=async N=>{var f;if(!confirm("Are you sure you want to delete this query?"))return;await t.deleteItem(N)&&((f=t.selectedItem)==null?void 0:f.id)===N&&t.setSelectedItem(null)},y=async()=>{if(t.selectedItem){u(!0),b(null),x(null);try{const N=await fetch(`/api/custom-queries/${t.selectedItem.id}/test`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({parameters:d})});if(!N.ok){const f=await N.json().catch(()=>({error:"Failed to test query"}));throw new Error(f.error||"Failed to test query")}const $=await N.json();b($)}catch(N){x(N instanceof Error?N.message:"Failed to test query")}finally{u(!1)}}},v=async(N,$)=>{try{if(!(await fetch(`/api/custom-queries/${N}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({enabled:$})})).ok)throw new Error("Failed to toggle query");await t.refreshData()}catch(f){t.setError(f instanceof Error?f.message:"Failed to toggle query")}},_=()=>{o({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),t.clearValidationErrors()},S=N=>{o({slug:N.slug,name:N.name,description:N.description||"",sql_query:N.sql_query,parameters:N.parameters,cache_ttl:N.cache_ttl,enabled:N.enabled}),t.clearValidationErrors()};return{queries:t.items,selectedQuery:t.selectedItem,loading:t.loading,error:t.error,validationErrors:t.validationErrors,isCreating:r,isEditing:a,formData:s,testParams:d,testResult:m,testError:c,testing:p,setSelectedQuery:t.setSelectedItem,setError:t.setError,setValidationErrors:t.setValidationErrors,setIsCreating:n,setIsEditing:i,setFormData:o,setTestParams:l,setTestResult:b,setTestError:x,fetchQueries:t.refreshData,handleCreate:h,handleUpdate:g,handleDelete:w,handleTest:y,handleToggleEnabled:v,resetForm:_,loadQueryToForm:S}}function cr(){const{queries:t,selectedQuery:r,isCreating:n,isEditing:a,loading:i,error:s,validationErrors:o,formData:d,testParams:l,testResult:m,testError:b,testing:c,setSelectedQuery:x,setIsCreating:p,setIsEditing:u,setError:h,setFormData:g,setTestParams:w,setTestResult:y,setTestError:v,setValidationErrors:_,handleCreate:S,handleUpdate:N,handleDelete:$,handleTest:f,handleToggleEnabled:C,resetForm:U,loadQueryToForm:T}=or(),P=A=>{x(A),w({}),y(null),v(null)},E=A=>{x(A),T(A),u(!0)},D=()=>{U(),p(!0)},j=()=>{p(!1),u(!1),U(),h(null)};return i?e("div",{className:"flex items-center justify-center h-screen",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):e("div",{className:"min-h-screen bg-gray-50 py-6",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e("div",{className:"mb-6",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Custom SQL Queries"}),e("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage custom SQL queries with secure parameter handling and caching"})]}),s&&!n&&!a&&e("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:s}),e("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e(ar,{queries:t,selectedQuery:r,onSelectQuery:P,onEditClick:E,onDeleteClick:$,onToggleEnabled:C,onCreateClick:D}),e(sr,{selectedQuery:r,testParams:l,testResult:m,testError:b,testing:c,onTestParamsChange:w,onTest:f})]}),e(nr,{isCreating:n,isEditing:a,formData:d,validationErrors:o,error:s,onFormDataChange:g,onValidationErrorsChange:_,onCreate:S,onUpdate:N,onClose:j})]})})}const je=["admins","sessions","schema_snapshots","schema_snapshot_counter","d1_migrations","api_keys","user_sessions","oauth_providers","app_settings","table_policies"],dr=t=>t?t.length>8?`${t.substring(0,4)}...`:t:"-",bt=t=>t.filter(r=>!je.includes(r.name)),ur=(t,r)=>{const n=r.filter(a=>a.trim()!=="").join("_");return`idx_${t}_${n}`.toLowerCase()},mr=async t=>{try{return await navigator.clipboard.writeText(t),!0}catch{try{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.focus(),n.select();const a=document.execCommand("copy");return document.body.removeChild(n),a}catch(n){return console.error("Failed to copy to clipboard:",n),!1}}},hr=t=>{try{const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}},Qe=t=>typeof t!="string"?!1:/^[a-f0-9]{8}[a-f0-9]{4}[a-f0-9]{4}[a-f0-9]{4}[a-f0-9]{12}$/i.test(t)||/^[a-f0-9]{8,}$/i.test(t)||t.length>=6&&/^[a-zA-Z0-9_-]+$/.test(t),pr=t=>!t||typeof t!="string"||t.length>63||je.includes(t)?!1:/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t),fr=t=>!t||typeof t!="string"||t.length>63?!1:/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t),yt=()=>["TEXT","INTEGER","REAL","BLOB","NUMERIC","DATE","DATETIME","TIMESTAMP","BOOLEAN","VARCHAR(255)","CHAR(50)"],Pe=()=>{const[t,r]=k({loading:!1,error:null}),n=p=>{r(u=>({...u,loading:p}))},a=p=>{r(u=>({...u,error:p}))},i=()=>{r(p=>({...p,error:null}))},s=p=>p.trim()?pr(p)?null:"Invalid table name format. Use letters, numbers, and underscores only.":"Table name is required",o=p=>p.trim()?fr(p)?null:"Invalid column name format. Use letters, numbers, and underscores only.":"Column name is required";return{...t,createTable:async p=>{n(!0),a(null);try{const u=s(p.name);if(u)return a(u),n(!1),!1;const h=p.columns.filter(v=>v.name.trim()!=="");if(h.length===0)return a("At least one column is required"),n(!1),!1;const g=h.map(v=>v.name.toLowerCase()),w=g.filter((v,_)=>g.indexOf(v)!==_);if(w.length>0)return a(`Duplicate column names: ${w.join(", ")}`),n(!1),!1;for(const v of h){const _=o(v.name);if(_)return a(`Column "${v.name}": ${_}`),n(!1),!1}const y=h.map(v=>({name:v.name,type:v.type,constraints:v.notNull?"NOT NULL":void 0,foreignKey:v.foreignKey.enabled?{table:v.foreignKey.table,column:v.foreignKey.column}:void 0}));await M.createTable(p.name,y);for(const v of p.indexes)if(v.columns.length>0&&v.name.trim()!=="")try{await M.createIndex(p.name,{name:v.name,columns:v.columns,unique:v.unique})}catch(_){console.warn(`Failed to create index ${v.name}:`,_)}return n(!1),!0}catch(u){const h=u instanceof Error?u.message:"Failed to create table";return a(h),n(!1),!1}},dropTable:async p=>{n(!0),a(null);try{return await M.dropTable(p),n(!1),!0}catch(u){const h=u instanceof Error?u.message:"Failed to drop table";return a(h),n(!1),!1}},changeAccessPolicy:async(p,u)=>{n(!0),a(null);try{return await M.updateTablePolicy(p,u),n(!1),!0}catch(h){const g=h instanceof Error?h.message:"Failed to change access policy";return a(g),n(!1),!1}},createRecord:async(p,u)=>{n(!0),a(null);try{const h=Object.entries(u).reduce((g,[w,y])=>(y!==""&&y!==null&&y!==void 0&&(g[w]=y),g),{});return await M.insertRecord(p,h),n(!1),!0}catch(h){const g=h instanceof Error?h.message:"Failed to create record";return a(g),n(!1),!1}},deleteRecord:async(p,u)=>{n(!0),a(null);try{return await M.deleteRecord(p,{id:u}),n(!1),!0}catch(h){const g=h instanceof Error?h.message:"Failed to delete record";return a(g),n(!1),!1}},addColumn:async(p,u)=>{n(!0),a(null);try{const h=o(u.name);if(h)return a(h),n(!1),!1;const g={name:u.name,type:u.type,constraints:u.notNull?"NOT NULL":void 0,foreignKey:u.foreignKey.enabled?{table:u.foreignKey.table,column:u.foreignKey.column}:void 0};return await M.addColumn(p,g),n(!1),!0}catch(h){const g=h instanceof Error?h.message:"Failed to add column";return a(g),n(!1),!1}},validateTableName:s,validateColumnName:o,clearError:i}};function gr({tableName:t,tableData:r,tableColumns:n,onDataChange:a,loading:i}){const[s,o]=k(!1),[d,l]=k({}),[m,b]=k(null),[c,x]=k(null),[p,u]=k(null),h=jt(!1),{createRecord:g,deleteRecord:w,loading:y,error:v,clearError:_}=Pe(),S=async E=>{E.preventDefault(),_(),await g(t,d)&&(l({}),o(!1),a())},N=async E=>{if(!confirm("Are you sure you want to delete this record? This action cannot be undone."))return;await w(t,E)&&a()},$=(E,D,j)=>{if(["id","created_at","updated_at"].includes(D))return;const A=n.find(H=>H.name===D);if(A&&Qe(j)||!A){const H=r.find(Q=>Q.id===E);H&&x({id:E,data:{...H}})}else h.current=!1,b({rowId:E,columnName:D,value:j})},f=async(E,D,j)=>{console.log("Cell save:",{rowId:E,columnName:D,newValue:j}),b(null),a()},C=()=>{b(null)},U=async()=>{c&&(console.log("Record save:",c),x(null),a())},T=async(E,D,j)=>{await mr(E)&&(u(`${D}-${j}`),setTimeout(()=>u(null),2e3))},P=async(E,D)=>{console.log("Jump to record:",{id:E,columnName:D})};return t?e("div",{className:"bg-white rounded-lg shadow-sm border",children:[e("div",{className:"p-6 border-b",children:[e("div",{className:"flex justify-between items-center",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:[t," Data"]}),e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors",disabled:i||y,children:"Add Record"})]}),v&&e("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:v}),e("button",{type:"button",onClick:_,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]})]}),i?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):r.length===0?e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"No records found"})}):e("div",{className:"overflow-x-auto",children:e("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:[n.map(E=>e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:E.name},E.name)),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:r.map((E,D)=>e("tr",{className:"hover:bg-gray-50",children:[n.map(j=>{const A=E[j.name],z=`${D}-${j.name}`,H=(m==null?void 0:m.rowId)===E.id&&(m==null?void 0:m.columnName)===j.name,Q=p===z,J=["id","created_at","updated_at"].includes(j.name);return e("td",{className:`px-4 py-3 text-sm relative ${J?"text-gray-500":"text-gray-900"} ${J?"":"cursor-pointer hover:bg-blue-50"}`,onClick:()=>!H&&$(E.id,j.name,A),onKeyDown:K=>{(K.key==="Enter"||K.key===" ")&&!H&&$(E.id,j.name,A)},tabIndex:J?-1:0,role:J?void 0:"button",children:H?e("input",{type:"text",value:m.value,onChange:K=>b(Ue=>Ue?{...Ue,value:K.currentTarget.value}:null),onKeyDown:K=>{K.key==="Enter"?f(E.id,j.name,m.value):K.key==="Escape"&&C()},onBlur:()=>f(E.id,j.name,m.value),className:"w-full px-2 py-1 border border-blue-500 rounded focus:outline-none"}):e("div",{className:"flex items-center gap-2",children:[e("span",{children:j.name==="id"?dr(A):["created_at","updated_at"].includes(j.name)?hr(A):A===null?"NULL":A===""?"(empty)":String(A)}),(j.name==="id"||Qe(A))&&e("div",{className:"flex gap-1",children:[e("button",{type:"button",onClick:K=>{K.stopPropagation(),T(A,D,j.name)},className:`p-1 rounded text-xs ${Q?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400"}`,title:"Copy to clipboard",children:Q?"âœ“":"ðŸ“‹"}),j.name!=="id"&&e("button",{type:"button",onClick:K=>{K.stopPropagation(),P(A,j.name)},className:"p-1 hover:bg-gray-100 text-gray-400 rounded text-xs",title:"Jump to related record",children:"ðŸ”—"})]})]})},j.name)}),e("td",{className:"px-4 py-3 text-sm",children:e("button",{type:"button",onClick:()=>N(E.id),className:"text-red-600 hover:text-red-800 text-sm",disabled:y,children:"Delete"})})]},E.id))})]})}),s&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Add New Record"}),e("form",{onSubmit:S,className:"space-y-4",children:[n.filter(E=>!["id","created_at","updated_at"].includes(E.name)).map(E=>e("div",{children:[e("label",{htmlFor:`new-${E.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:[E.name,E.notnull===1&&e("span",{className:"text-red-500",children:"*"})]}),e("input",{id:`new-${E.name}`,type:"text",value:d[E.name]||"",onChange:D=>l(j=>({...j,[E.name]:D.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Enter ${E.name}`,required:E.notnull===1})]},E.name)),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{o(!1),l({}),_()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:y,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50",disabled:y,children:y?"Creating...":"Create Record"})]})]})]})}),c&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Edit Record"}),e("div",{className:"space-y-4",children:[n.map(E=>e("div",{children:[e("label",{htmlFor:`edit-${E.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:[E.name,["id","created_at","updated_at"].includes(E.name)&&e("span",{className:"text-gray-500 text-xs ml-1",children:"(read-only)"})]}),e("input",{id:`edit-${E.name}`,type:"text",value:c.data[E.name]||"",onChange:D=>x(j=>j?{...j,data:{...j.data,[E.name]:D.currentTarget.value}}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:["id","created_at","updated_at"].includes(E.name)})]},E.name)),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"button",onClick:U,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Save Changes"})]})]})]})})]}):e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table to view its data"})})})}function be({size:t="sm"}){return e("svg",{class:`animate-spin ${t==="sm"?"h-4 w-4":"h-6 w-6"} text-white`,fill:"none",viewBox:"0 0 24 24","aria-label":"Loading spinner",children:[e("title",{children:"Loading spinner"}),e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}function br({onClose:t,onRestore:r}){const[n,a]=k([]),[i,s]=k(null),[o,d]=k(!0),[l,m]=k(null),[b,c]=k(!1),[x,p]=k({name:"",description:""}),[u,h]=k(null),[g,w]=k(null),[y,v]=k(null),[_,S]=k(!1),[N,$]=k(!1),[f,C]=k(!1);R(()=>{U()},[]),R(()=>{const A=z=>{if(y){const H=z.target;!H.closest("[data-menu-container]")&&!H.closest("[data-menu-button]")&&v(null)}};return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[y]);const U=async()=>{try{d(!0),m(null);const A=await M.getSnapshots();a(A.snapshots)}catch(A){m(A instanceof Error?A.message:"Failed to load data")}finally{d(!1)}},T=async A=>{A.preventDefault();try{m(null),S(!0),await M.createSnapshot(x),c(!1),p({name:"",description:""}),await U()}catch(z){m(z instanceof Error?z.message:"Failed to create snapshot")}finally{S(!1)}},P=async()=>{if(u)try{m(null),$(!0),await M.restoreSnapshot(u),h(null),r&&r(),t()}catch(A){m(A instanceof Error?A.message:"Failed to restore"),h(null)}finally{$(!1)}},E=async()=>{if(g)try{m(null),C(!0),await M.deleteSnapshot(g),w(null),v(null),await U()}catch(A){m(A instanceof Error?A.message:"Failed to delete snapshot"),w(null)}finally{C(!1)}},D=A=>new Date(A).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZoneName:"short"}),j=A=>{const z=new Date(A),Q=new Date().getTime()-z.getTime(),J=Math.floor(Q/(1e3*60*60*24)),K=Math.floor(Q%(1e3*60*60*24)/(1e3*60*60));return J>0?`${J} day${J>1?"s":""} ago`:K>0?`${K} hour${K>1?"s":""} ago`:"Just now"};return e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e("div",{class:"px-6 py-4 border-b flex items-center justify-between",children:[e("h2",{class:"text-xl font-semibold text-gray-900",children:"Schema Snapshots"}),e("button",{type:"button",onClick:t,class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Close",children:[e("title",{children:"Close"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})]})})]}),l&&e("div",{class:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:e("div",{class:"text-sm text-red-700",children:l})}),e("div",{class:"mx-6 mt-4 bg-blue-50 border border-blue-200 rounded-md p-4",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20","aria-label":"Information",children:[e("title",{children:"Information"}),e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]})}),e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-blue-800",children:"ðŸ’¡ Cloudflareã®Time Travelæ©Ÿèƒ½ã«ã¤ã„ã¦"}),e("p",{class:"mt-1 text-sm text-blue-700",children:["Cloudflareã®ç®¡ç†ç”»é¢ã‹ã‚‰ã€D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’éŽåŽ»ã®ä»»æ„ã®æ™‚ç‚¹ï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ã§7æ—¥é–“ã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ã§30æ—¥é–“ï¼‰ã«å¾©å…ƒã§ãã‚‹Time Travelæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚ è©³ã—ãã¯",e("a",{href:"https://developers.cloudflare.com/d1/reference/time-travel/",target:"_blank",rel:"noopener noreferrer",class:"font-medium underline hover:no-underline",children:"Cloudflare D1 Time Travelãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"}),"ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"]})]})]})}),e("div",{class:"flex-1 overflow-auto p-6",children:o?e("div",{class:"text-center py-8",children:e("div",{class:"text-gray-500",children:"Loading..."})}):e("div",{children:[!b&&e("div",{class:"mb-6",children:e("button",{type:"button",onClick:()=>c(!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Plus",children:[e("title",{children:"Plus"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]}),"Create Snapshot"]})}),b&&e("div",{class:"mb-6 bg-gray-50 rounded-lg p-4",children:[e("h3",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Snapshot"}),e("form",{onSubmit:T,children:e("div",{class:"space-y-3",children:[e("div",{children:[e("label",{htmlFor:"snapshot_name",class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{id:"snapshot_name",type:"text",value:x.name,onInput:A=>p({...x,name:A.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., Before major refactoring"})]}),e("div",{children:[e("label",{htmlFor:"snapshot_description",class:"block text-sm font-medium text-gray-700",children:"Description"}),e("textarea",{id:"snapshot_description",value:x.description,onInput:A=>p({...x,description:A.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",rows:2,placeholder:"Optional description of current state"})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",disabled:_,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${_?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:[_&&e(be,{size:"sm"}),e("span",{children:_?"Creating...":"Create"})]}),e("button",{type:"button",onClick:()=>{c(!1),p({name:"",description:""})},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})})]}),e("div",{class:"space-y-3",children:n.length===0?e("div",{class:"text-center py-8 text-gray-500",children:"No snapshots yet. Create your first snapshot to start tracking schema changes."}):n.map(A=>e("button",{type:"button",class:`text-left w-full border rounded-lg p-4 hover:shadow-md transition-shadow ${(i==null?void 0:i.id)===A.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>s(A),children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-3",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:A.name||`Snapshot v${A.version}`}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${A.snapshotType==="manual"?"bg-blue-100 text-blue-800":A.snapshotType==="auto"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:A.snapshotType})]}),A.description&&e("p",{class:"mt-1 text-sm text-gray-600",children:A.description}),e("div",{class:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e("span",{children:["Version ",A.version]}),e("span",{children:D(A.createdAt)}),e("span",{children:j(A.createdAt)})]})]}),e("div",{class:"ml-4 flex items-center space-x-2",children:[e("button",{type:"button",onClick:z=>{z.stopPropagation(),h(A.id)},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Restore"}),e("div",{class:"relative",children:[e("button",{type:"button",onClick:z=>{z.stopPropagation(),v(y===A.id?null:A.id)},"data-menu-button":"true",class:"inline-flex items-center p-1.5 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-md",children:e("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20","aria-label":"More options",children:[e("title",{children:"More options"}),e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})]})}),y===A.id&&e("div",{class:"absolute right-0 top-full mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10","data-menu-container":"true",children:e("div",{class:"py-1",children:e("button",{type:"button",onClick:z=>{z.preventDefault(),z.stopPropagation(),v(null),w(A.id)},class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 focus:outline-none",children:e("div",{class:"flex items-center space-x-2",children:[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Delete",children:[e("title",{children:"Delete"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})]}),e("span",{children:"Delete"})]})})})})]})]})]})},A.id))})]})}),u&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Warning",children:[e("title",{children:"Warning"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})]})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Confirm Restore"})})]}),e("div",{class:"mb-6",children:[e("p",{class:"text-sm text-gray-700",children:"This will restore your database schema to the selected snapshot. All current tables and data will be replaced."}),e("p",{class:"text-sm text-red-600 mt-2 font-medium",children:"This action cannot be undone. Make sure you have a backup of your current data."})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"button",onClick:P,disabled:N,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${N?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[N&&e(be,{size:"sm"}),e("span",{children:N?"Restoring...":"Restore"})]}),e("button",{type:"button",onClick:()=>h(null),disabled:N,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${N?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})}),g&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Warning",children:[e("title",{children:"Warning"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})]})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Delete Snapshot"})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:"Are you sure you want to delete this snapshot? This action cannot be undone."})}),e("div",{class:"flex space-x-3",children:[e("button",{type:"button",onClick:E,disabled:f,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${f?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[f&&e(be,{size:"sm"}),e("span",{children:f?"Deleting...":"Delete"})]}),e("button",{type:"button",onClick:()=>w(null),disabled:f,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${f?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})})]})})}function yr({tableName:t,tableColumns:r,tableForeignKeys:n,tables:a,onSchemaChange:i,loading:s}){const[o,d]=k(!1),[l,m]=k(!1),[b,c]=k({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),[x,p]=k({name:"",columns:[""],unique:!1}),[u]=k([]),{addColumn:h,validateColumnName:g,loading:w,error:y,clearError:v}=Pe(),_=async f=>{if(f.preventDefault(),!t)return;v(),await h(t,b)&&(c({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),d(!1),i())},S=async f=>{if(f.preventDefault(),!!t)try{const C=x.columns.filter(U=>U.trim()!=="");if(C.length===0){alert("At least one column is required for the index");return}console.log("Create index:",{tableName:t,name:x.name,columns:C,unique:x.unique}),p({name:"",columns:[""],unique:!1}),m(!1),i()}catch(C){console.error("Failed to create index:",C)}},N=async f=>{if(t&&confirm(`Are you sure you want to drop the index "${f}"? This action cannot be undone.`))try{console.log("Drop index:",f),i()}catch(C){console.error("Failed to drop index:",C)}};if(!t)return e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table to view its schema"})})});const $=bt(a);return e("div",{className:"space-y-6",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:[t," Schema"]}),e("div",{className:"flex gap-2",children:[e("button",{type:"button",onClick:()=>d(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",disabled:s||w,children:"Add Column"}),e("button",{type:"button",onClick:()=>m(!0),className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors",disabled:s||w,children:"Manage Indexes"})]})]}),y&&e("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:y}),e("button",{type:"button",onClick:v,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]}),s?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e("div",{className:"space-y-6",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Columns"}),e("div",{className:"overflow-x-auto",children:e("table",{className:"w-full border border-gray-200 rounded-md",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:[e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Name"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Type"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Constraints"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Default"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:r.map(f=>e("tr",{className:"hover:bg-gray-50",children:[e("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:[f.name,f.pk===1&&e("span",{className:"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"PK"})]}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.type}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.notnull===1&&e("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded mr-1",children:"NOT NULL"})}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.dflt_value||"-"})]},f.name))})]})})]}),n.length>0&&e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Foreign Keys"}),e("div",{className:"space-y-2",children:n.map((f,C)=>e("div",{className:"p-3 bg-gray-50 rounded-md",children:[e("span",{className:"font-medium",children:f.from}),e("span",{className:"text-gray-500 mx-2",children:"â†’"}),e("span",{className:"text-blue-600",children:[f.table,".",f.to]})]},`${f.from}-${f.table}-${f.to}-${C}`))})]}),e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Indexes"}),u.length===0?e("p",{className:"text-gray-500 italic",children:"No custom indexes created."}):e("div",{className:"space-y-2",children:u.map(f=>{var C;return e("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{children:[e("span",{className:"font-medium",children:f.name}),e("span",{className:"text-gray-500 ml-2",children:["(",(C=f.columns)==null?void 0:C.join(", "),")"]}),f.unique&&e("span",{className:"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded",children:"UNIQUE"})]}),e("button",{type:"button",onClick:()=>N(f.name),className:"text-red-600 hover:text-red-800 text-sm",disabled:w,children:"Drop"})]},f.name)})})]})]})]}),e(br,{onClose:()=>{}}),o&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Add New Column"}),e("form",{onSubmit:_,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"column-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Column Name"}),e("input",{id:"column-name",type:"text",value:b.name,onChange:f=>c(C=>({...C,name:f.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter column name",required:!0}),b.name&&g(b.name)&&e("p",{className:"text-red-600 text-sm mt-1",children:g(b.name)})]}),e("div",{children:[e("label",{htmlFor:"column-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Type"}),e("select",{id:"column-type",value:b.type,onChange:f=>c(C=>({...C,type:f.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:yt().map(f=>e("option",{value:f,children:f},f))})]}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:b.notNull,onChange:f=>c(C=>({...C,notNull:f.currentTarget.checked})),className:"mr-2"}),"NOT NULL"]})}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:b.foreignKey.enabled,onChange:f=>c(C=>({...C,foreignKey:{...C.foreignKey,enabled:f.currentTarget.checked}})),className:"mr-2"}),"Foreign Key Reference"]})}),b.foreignKey.enabled&&e("div",{className:"space-y-3 ml-6",children:[e("div",{children:[e("label",{htmlFor:"reference-table",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Table"}),e("select",{id:"reference-table",value:b.foreignKey.table,onChange:f=>c(C=>({...C,foreignKey:{...C.foreignKey,table:f.currentTarget.value,column:""}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"Select table"}),$.map(f=>e("option",{value:f.name,children:f.name},f.name))]})]}),e("div",{children:[e("label",{htmlFor:"reference-column",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Column"}),e("input",{id:"reference-column",type:"text",value:b.foreignKey.column,onChange:f=>c(C=>({...C,foreignKey:{...C.foreignKey,column:f.currentTarget.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Usually 'id'"})]})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{d(!1),v()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:w,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",disabled:w,children:w?"Adding...":"Add Column"})]})]})]})}),l&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create Index"}),e("form",{onSubmit:S,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"index-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Index Name"}),e("input",{id:"index-name",type:"text",value:x.name,onChange:f=>p(C=>({...C,name:f.currentTarget.value})),onFocus:()=>{if(!x.name&&t){const f=x.columns.filter(C=>C.trim()!=="");f.length>0&&p(C=>({...C,name:ur(t,f)}))}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter index name",required:!0})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{className:"space-y-2",children:x.columns.map((f,C)=>e("div",{className:"flex gap-2",children:[e("select",{value:f,onChange:U=>{const T=[...x.columns];T[C]=U.currentTarget.value,p(P=>({...P,columns:T}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"Select column"}),r.map(U=>e("option",{value:U.name,children:U.name},U.name))]}),x.columns.length>1&&e("button",{type:"button",onClick:()=>{const U=x.columns.filter((T,P)=>P!==C);p(T=>({...T,columns:U}))},className:"p-2 text-red-600 hover:text-red-800",children:e("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Remove column from index"}),e("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]},`column-${C}-${f||"empty"}`))}),e("button",{type:"button",onClick:()=>p(f=>({...f,columns:[...f.columns,""]})),className:"mt-2 text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Column"})]}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:x.unique,onChange:f=>p(C=>({...C,unique:f.currentTarget.checked})),className:"mr-2"}),"Unique Index"]})}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600",children:"Create Index"})]})]})]})})]})}function xr({tables:t,selectedTable:r,onTableSelect:n,onTablesChange:a,loading:i}){const[s,o]=k(!1),[d,l]=k({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),[m,b]=k(null),{createTable:c,dropTable:x,changeAccessPolicy:p,validateTableName:u,validateColumnName:h,loading:g,error:w,clearError:y}=Pe(),v=async T=>{T.preventDefault(),y(),await c(d)&&(l({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),o(!1),a())},_=async T=>{if(!confirm(`Are you sure you want to drop table "${T}"? This action cannot be undone.`))return;await x(T)&&(r===T&&n(null),a()),b(null)},S=async(T,P)=>{await p(T,P)&&a(),b(null)},N=()=>{l(T=>({...T,columns:[...T.columns,{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}]}))},$=T=>{l(P=>({...P,columns:P.columns.filter((E,D)=>D!==T)}))},f=(T,P,E)=>{l(D=>({...D,columns:D.columns.map((j,A)=>A===T?{...j,[P]:E}:j)}))},C=bt(t),U=t.filter(T=>je.includes(T.name));return e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:"Tables"}),e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",disabled:i||g,children:"Create Table"})]}),w&&e("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:w}),e("button",{type:"button",onClick:y,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]}),i?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e("div",{className:"space-y-6",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"User Tables"}),C.length===0?e("p",{className:"text-gray-500 italic",children:"No user tables created yet."}):e("div",{className:"grid gap-2",children:C.map(T=>e("div",{className:`p-3 border rounded-md cursor-pointer transition-colors relative ${r===T.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e("div",{className:"flex items-center justify-between",children:[e("button",{type:"button",onClick:()=>n(T.name),className:"flex-1 text-left",children:[e("div",{className:"flex items-center gap-2",children:[e("span",{className:"font-medium",children:T.name}),e("span",{className:`px-2 py-1 text-xs rounded-full ${T.access_policy==="public"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:T.access_policy||"public"})]}),e("p",{className:"text-sm text-gray-500",children:[T.rowCount," rows"]})]}),e("div",{className:"relative",children:[e("button",{type:"button",onClick:P=>{P.stopPropagation(),b(m===T.name?null:T.name)},className:"p-1 hover:bg-gray-100 rounded",children:e("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Table options menu"}),e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})]})}),m===T.name&&e("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[e("button",{type:"button",onClick:()=>S(T.name,T.access_policy==="public"?"private":"public"),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50",disabled:g,children:["Make ",T.access_policy==="public"?"Private":"Public"]}),e("button",{type:"button",onClick:()=>_(T.name),className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50",disabled:g,children:"Drop Table"})]})]})]})},T.name))})]}),e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-500 mb-3",children:"System Tables"}),e("div",{className:"grid gap-2",children:U.map(T=>e("button",{type:"button",onClick:()=>n(T.name),className:`p-3 border rounded-md cursor-pointer transition-colors text-left w-full ${r===T.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e("div",{className:"flex items-center justify-between",children:[e("span",{className:"font-medium text-gray-700",children:T.name}),e("span",{className:"text-sm text-gray-500",children:[T.rowCount," rows"]})]})},T.name))})]})]}),s&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create New Table"}),e("form",{onSubmit:v,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"table-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Name"}),e("input",{id:"table-name",type:"text",value:d.name,onChange:T=>l(P=>({...P,name:T.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter table name",required:!0}),d.name&&u(d.name)&&e("p",{className:"text-red-600 text-sm mt-1",children:u(d.name)})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{className:"space-y-3",children:d.columns.map((T,P)=>e("div",{className:"border border-gray-200 rounded-md p-3",children:e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e("div",{children:[e("input",{type:"text",placeholder:"Column name",value:T.name,onChange:E=>f(P,"name",E.currentTarget.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),T.name&&h(T.name)&&e("p",{className:"text-red-600 text-xs mt-1",children:h(T.name)})]}),e("div",{children:e("select",{value:T.type,onChange:E=>f(P,"type",E.currentTarget.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:yt().map(E=>e("option",{value:E,children:E},E))})}),e("div",{className:"flex items-center gap-2",children:[e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:T.notNull,onChange:E=>f(P,"notNull",E.currentTarget.checked),className:"mr-1"}),"NOT NULL"]}),d.columns.length>1&&e("button",{type:"button",onClick:()=>$(P),className:"p-1 text-red-600 hover:text-red-800",children:e("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Remove column"}),e("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]})]})},`column-${T.name||P}`))}),e("button",{type:"button",onClick:N,className:"mt-3 px-3 py-2 text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Column"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{o(!1),y()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:g,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",disabled:g,children:g?"Creating...":"Create Table"})]})]})]})})]})}const vr=()=>{const[t,r]=k({tables:[],selectedTable:null,tableData:[],tableColumns:[],tableForeignKeys:[],loading:!1,error:null}),n=async()=>{r(b=>({...b,loading:!0,error:null}));try{const b=await M.getTables();r(c=>({...c,tables:b.tables||[],loading:!1}))}catch(b){const c=b instanceof Error?b.message:"Failed to load tables";r(x=>({...x,error:c,loading:!1}))}},a=async b=>{const c=b||t.selectedTable;if(c){r(x=>({...x,loading:!0,error:null}));try{const x=await M.getTableSchema(c);r(p=>({...p,tableColumns:x.columns||[],tableForeignKeys:x.foreignKeys||[],loading:!1}))}catch(x){const p=x instanceof Error?x.message:"Failed to load table schema";r(u=>({...u,error:p,loading:!1}))}}},i=async b=>{const c=b||t.selectedTable;if(c){r(x=>({...x,loading:!0,error:null}));try{const x=await M.getTableData(c);r(p=>({...p,tableData:x.data||[],loading:!1}))}catch(x){const p=x instanceof Error?x.message:"Failed to load table data";r(u=>({...u,error:p,loading:!1}))}}},s=b=>{r(c=>({...c,selectedTable:b,tableData:[],tableColumns:[],tableForeignKeys:[]})),b&&(a(b),i(b))},o=s,d=b=>{r(c=>({...c,error:b}))},l=()=>{r(b=>({...b,error:null}))},m=async()=>{await n(),t.selectedTable&&await Promise.all([a(t.selectedTable),i(t.selectedTable)])};return R(()=>{n()},[]),{...t,loadTables:n,loadTableSchema:a,loadTableData:i,selectTable:s,setSelectedTable:o,setError:d,clearError:l,refreshData:m}};function wr(){const{tables:t,selectedTable:r,tableData:n,tableColumns:a,tableForeignKeys:i,loading:s,error:o,setSelectedTable:d,loadTables:l,loadTableData:m,loadTableSchema:b}=vr();return e("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Database"}),e("p",{className:"mt-2 text-gray-600",children:"Manage your application's database tables and data"})]}),o&&e("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{className:"text-red-700",children:o})}),e("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e("div",{className:"lg:col-span-1",children:e(xr,{tables:t,selectedTable:r,onTableSelect:h=>{d(h)},onTablesChange:()=>{l()},loading:s})}),e("div",{className:"lg:col-span-2 space-y-6",children:r?e(ee,{children:[e(gr,{tableName:r,tableData:n,tableColumns:a,onDataChange:()=>{m()},loading:s}),e(yr,{tableName:r,tableColumns:a,tableForeignKeys:i,tables:t,onSchemaChange:()=>{b(),m()},loading:s})]}):e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table from the left to view and manage its data and schema"})})})})]})]})})}function _r(){const[t,r]=k({userTables:0,systemTables:0,dbStatus:"checking..."});R(()=>{n()},[]);const n=async()=>{try{const a=await M.health(),i=await M.getTables(),s=i.tables.filter(d=>d.type==="user").length,o=i.tables.filter(d=>d.type==="system").length;r({userTables:s,systemTables:o,dbStatus:a.database==="connected"?"connected":"disconnected"})}catch(a){console.error("Failed to load stats:",a),r(i=>({...i,dbStatus:"error"}))}};return e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Dashboard"}),e("div",{class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e(ye,{title:"Database Tables",description:"User-defined tables in D1",href:"/database",stats:`${t.userTables} tables`,status:t.dbStatus}),e(ye,{title:"System Tables",description:"Protected system tables",href:"/database",stats:`${t.systemTables} tables`}),e(ye,{title:"Storage",description:"R2 object storage for files",href:"/storage",stats:"Ready",status:"connected"})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-3",children:[e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Create new table â†’"}),e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Browse database â†’"}),e("a",{href:"/storage",class:"text-indigo-600 hover:text-indigo-500 block",children:"Upload files â†’"}),e("a",{href:"/api/health",target:"_blank",class:"text-indigo-600 hover:text-indigo-500 block",rel:"noopener",children:"View API health â†’"})]})})})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"API Endpoints"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-2 text-sm",children:[e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/health"}),e("span",{class:"text-green-600",children:"Health check"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables"}),e("span",{class:"text-green-600",children:"List tables"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/tables"}),e("span",{class:"text-green-600",children:"Create table"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables/:name/data"}),e("span",{class:"text-green-600",children:"Get table data"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/storage"}),e("span",{class:"text-green-600",children:"List files"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/storage/upload"}),e("span",{class:"text-green-600",children:"Upload file"})]})]})})})]})]})}function ye({title:t,description:r,href:n,stats:a,status:i}){return e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between",children:[e("dt",{class:"text-sm font-medium text-gray-500 truncate",children:t}),i&&e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i==="connected"?"bg-green-100 text-green-800":i==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:i})]}),e("dd",{class:"mt-1 text-3xl font-semibold text-gray-900",children:a}),e("p",{class:"mt-2 text-sm text-gray-600",children:r}),e("a",{href:n,class:"mt-3 text-indigo-600 hover:text-indigo-500 text-sm font-medium inline-block",children:"Manage â†’"})]})})}function Nr({logs:t}){return e("div",{className:"space-y-6",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Logs"}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:t.map(r=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-start justify-between",children:e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-sm font-medium text-gray-900",children:r.title}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="sent"?"bg-green-100 text-green-800":r.status==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})]}),e("p",{className:"text-sm text-gray-600 mt-1",children:r.body}),r.errorMessage&&e("p",{className:"text-sm text-red-600 mt-1",children:r.errorMessage}),e("div",{className:"mt-2 text-xs text-gray-500",children:["User: ",r.userId," | Provider: ",r.provider," |"," ",new Date(r.createdAt).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})]})]})})},r.id))}),t.length===0&&e("output",{className:"text-center py-8 text-gray-500","aria-live":"polite",children:"No notification logs available"})]})]})}function kr({rules:t,onCreateRule:r,onEditRule:n,onToggleRule:a,onDeleteRule:i}){return e("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Rules"}),e("button",{type:"button",onClick:r,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Create Rule"})]}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:t.map(s=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-center justify-between",children:[e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-lg font-medium text-gray-900",children:s.name}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.enabled?"Enabled":"Disabled"})]}),s.description&&e("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e("div",{className:"mt-2 text-sm text-gray-500",children:[e("span",{className:"bg-gray-100 px-2 py-1 rounded mr-2",children:s.triggerType}),s.tableName&&e("span",{className:"bg-blue-100 px-2 py-1 rounded mr-2",children:s.tableName}),s.eventType&&e("span",{className:"bg-purple-100 px-2 py-1 rounded mr-2",children:s.eventType}),e("span",{className:"bg-yellow-100 px-2 py-1 rounded",children:s.recipientType})]})]}),e("div",{className:"flex space-x-2",children:[e("button",{type:"button",onClick:()=>a(s),className:`px-3 py-1 text-sm rounded-md ${s.enabled?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:s.enabled?"Disable":"Enable"}),e("button",{type:"button",onClick:()=>n(s),className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:"Edit"}),e("button",{type:"button",onClick:()=>i(s.id),className:"px-3 py-1 text-sm bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"Delete"})]})]})},s.id))}),t.length===0&&e("output",{className:"text-center py-8 text-gray-500","aria-live":"polite",children:"No notification rules configured yet"})]})]})}function Cr({vapidPublicKey:t}){return e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"VAPID Configuration"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"vapid-public-key",className:"block text-sm font-medium text-gray-700 mb-2",children:"Public Key"}),e("div",{id:"vapid-public-key",className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800 break-all",children:t||"Loading..."})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use this public key in your client application for Web Push subscriptions"})]}),e("div",{children:[e("label",{htmlFor:"vapid-subject",className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),e("div",{id:"vapid-subject",className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800",children:"mailto:support@vibebase.app"})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"VAPID subject for push notification identification"})]}),e("div",{children:[e("label",{htmlFor:"api-endpoints",className:"block text-sm font-medium text-gray-700 mb-2",children:"API Endpoints"}),e("section",{id:"api-endpoints",className:"bg-gray-50 p-3 rounded-md space-y-2","aria-label":"API endpoints information",children:[e("div",{children:[e("strong",{children:"Subscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/subscribe"})]}),e("div",{children:[e("strong",{children:"Unsubscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/unsubscribe"})]}),e("div",{children:[e("strong",{children:"Send Notification:"})," ",e("code",{className:"text-sm",children:"POST /api/push/send"})]})]}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use these endpoints in your application for end-user push notification management"})]})]})]})})}function Tr({isAdminSubscribed:t,permission:r,loading:n,onAdminSubscribe:a,onAdminUnsubscribe:i,onAdminTestNotification:s}){return e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Admin Test Notifications"}),e("p",{className:"text-sm text-gray-600 mb-6",children:"Test push notifications by subscribing your browser and sending test messages"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"browser-permission",className:"block text-sm font-medium text-gray-700",children:"Browser Permission"}),e("output",{id:"browser-permission",className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r==="granted"?"bg-green-100 text-green-800":r==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,"aria-label":`Browser notification permission status: ${r||"Unknown"}`,children:r||"Unknown"})]}),e("div",{children:[e("label",{htmlFor:"admin-subscription-status",className:"block text-sm font-medium text-gray-700",children:"Admin Subscription Status"}),e("output",{id:"admin-subscription-status",className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,"aria-label":`Admin subscription status: ${t?"Subscribed":"Not Subscribed"}`,children:t?"Subscribed":"Not Subscribed"})]}),e("div",{className:"flex space-x-3",children:t?e(ee,{children:[e("button",{type:"button",onClick:i,disabled:n,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50",children:n?"Unsubscribing...":"Unsubscribe"}),e("button",{type:"button",onClick:s,disabled:n,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:n?"Sending...":"Send Test Notification"})]}):e("button",{type:"button",onClick:a,disabled:n||r==="denied",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50",children:n?"Subscribing...":"Subscribe for Testing"})}),r==="denied"&&e("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",role:"alert","aria-live":"polite",children:e("div",{className:"flex",children:e("div",{className:"ml-3",children:[e("h3",{className:"text-sm font-medium text-yellow-800",children:"Notifications Blocked"}),e("div",{className:"mt-2 text-sm text-yellow-700",children:[e("p",{children:"Browser notifications are blocked. To test push notifications, please:"}),e("ol",{className:"list-decimal list-inside mt-1",children:[e("li",{children:"Click the lock icon in your browser's address bar"}),e("li",{children:'Set notifications to "Allow"'}),e("li",{children:"Refresh this page"})]})]})]})})})]})]})})}function Sr({editingRule:t,loading:r,onSubmit:n,onClose:a,setLoading:i}){const[s,o]=k({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",triggerType:(t==null?void 0:t.triggerType)||"db_change",tableName:(t==null?void 0:t.tableName)||"",eventType:(t==null?void 0:t.eventType)||"insert",recipientType:(t==null?void 0:t.recipientType)||"all_users",recipientValue:(t==null?void 0:t.recipientValue)||"",titleTemplate:(t==null?void 0:t.titleTemplate)||"",bodyTemplate:(t==null?void 0:t.bodyTemplate)||"",iconUrl:(t==null?void 0:t.iconUrl)||"",imageUrl:(t==null?void 0:t.imageUrl)||"",clickAction:(t==null?void 0:t.clickAction)||"",priority:(t==null?void 0:t.priority)||"normal",ttl:(t==null?void 0:t.ttl)||86400,enabled:(t==null?void 0:t.enabled)??!0});return e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",role:"dialog","aria-modal":"true","aria-labelledby":"rule-form-title",children:e("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:e("div",{className:"mt-3",children:[e("h3",{id:"rule-form-title",className:"text-lg font-medium text-gray-900 mb-4",children:t?"Edit Notification Rule":"Create Notification Rule"}),e("form",{onSubmit:async l=>{l.preventDefault(),i(!0);try{const m=t?`/api/push/rules/${t.id}`:"/api/push/rules",b=t?"PUT":"POST",c={...s,iconUrl:s.iconUrl.trim()||void 0,imageUrl:s.imageUrl.trim()||void 0,clickAction:s.clickAction.trim()||void 0,description:s.description.trim()||void 0,tableName:s.triggerType==="db_change"?s.tableName:void 0,eventType:s.triggerType==="db_change"?s.eventType:void 0,recipientValue:s.recipientType!=="all_users"?s.recipientValue:void 0},x=await fetch(m,{method:b,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)});if(x.ok)alert(t?"Rule updated successfully":"Rule created successfully"),await n(s);else{const p=await x.json();console.error("API Error:",p),p.details&&console.error("Validation errors:",p.details),alert(`Failed to ${t?"update":"create"} rule: ${p.error}${p.details?`

Validation errors: ${JSON.stringify(p.details,null,2)}`:""}`)}}catch(m){alert(`Error ${t?"updating":"creating"} rule: ${m}`)}finally{i(!1)}},className:"space-y-4",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{children:[e("label",{htmlFor:"rule-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e("input",{id:"rule-name",type:"text",required:!0,value:s.name,onChange:l=>o({...s,name:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e("input",{id:"rule-description",type:"text",value:s.description,onChange:l=>o({...s,description:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-trigger-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Trigger Type *"}),e("select",{id:"rule-trigger-type",value:s.triggerType,onChange:l=>o({...s,triggerType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"db_change",children:"Database Change"}),e("option",{value:"api",children:"API Trigger"})]})]}),s.triggerType==="db_change"&&e(ee,{children:[e("div",{children:[e("label",{htmlFor:"rule-table-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Name *"}),e("input",{id:"rule-table-name",type:"text",required:!0,value:s.tableName,onChange:l=>o({...s,tableName:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-event-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Event Type *"}),e("select",{id:"rule-event-type",value:s.eventType,onChange:l=>o({...s,eventType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"insert",children:"Insert"}),e("option",{value:"update",children:"Update"}),e("option",{value:"delete",children:"Delete"})]})]})]}),e("div",{children:[e("label",{htmlFor:"rule-recipient-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recipient Type *"}),e("select",{id:"rule-recipient-type",value:s.recipientType,onChange:l=>o({...s,recipientType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all_users",children:"All Users"}),e("option",{value:"specific_user",children:"Specific User"}),e("option",{value:"column_reference",children:"Column Reference"})]})]}),s.recipientType!=="all_users"&&e("div",{children:[e("label",{htmlFor:"rule-recipient-value",className:"block text-sm font-medium text-gray-700 mb-1",children:[s.recipientType==="specific_user"?"User ID":"Column Name"," *"]}),e("input",{id:"rule-recipient-value",type:"text",required:!0,value:s.recipientValue,onChange:l=>o({...s,recipientValue:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-title-template",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title Template *"}),e("input",{id:"rule-title-template",type:"text",required:!0,value:s.titleTemplate,onChange:l=>o({...s,titleTemplate:l.target.value}),placeholder:"e.g., New message from {{user_name}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-body-template",className:"block text-sm font-medium text-gray-700 mb-1",children:"Body Template *"}),e("input",{id:"rule-body-template",type:"text",required:!0,value:s.bodyTemplate,onChange:l=>o({...s,bodyTemplate:l.target.value}),placeholder:"e.g., {{message}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-icon-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Icon URL"}),e("input",{id:"rule-icon-url",type:"url",value:s.iconUrl,onChange:l=>o({...s,iconUrl:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-image-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),e("input",{id:"rule-image-url",type:"url",value:s.imageUrl,onChange:l=>o({...s,imageUrl:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-click-action",className:"block text-sm font-medium text-gray-700 mb-1",children:"Click Action URL"}),e("input",{id:"rule-click-action",type:"text",value:s.clickAction,onChange:l=>o({...s,clickAction:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e("select",{id:"rule-priority",value:s.priority,onChange:l=>o({...s,priority:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"high",children:"High"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"low",children:"Low"})]})]}),e("div",{children:[e("label",{htmlFor:"rule-ttl",className:"block text-sm font-medium text-gray-700 mb-1",children:"TTL (seconds)"}),e("input",{id:"rule-ttl",type:"number",value:s.ttl,onChange:l=>o({...s,ttl:parseInt(l.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:"enabled",checked:s.enabled,onChange:l=>o({...s,enabled:l.target.checked}),className:"mr-2"}),e("label",{htmlFor:"enabled",className:"text-sm font-medium text-gray-700",children:"Enabled"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e("button",{type:"submit",disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:r?"Saving...":t?"Update Rule":"Create Rule"})]})]})]})})})}class Er{constructor(r="/api"){ce(this,"apiBaseUrl");ce(this,"vapidPublicKey",null);ce(this,"registration",null);this.apiBaseUrl=r}async initialize(){try{return"serviceWorker"in navigator?"PushManager"in window?(this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered:",this.registration),await navigator.serviceWorker.ready,await this.fetchVapidPublicKey(),!0):(console.warn("Push messaging not supported"),!1):(console.warn("Service Workers not supported"),!1)}catch(r){return console.error("Failed to initialize push notifications:",r),!1}}async requestPermission(){try{return"Notification"in window?{granted:await Notification.requestPermission()==="granted"}:{granted:!1,error:"Notifications not supported"}}catch(r){return{granted:!1,error:r instanceof Error?r.message:"Permission request failed"}}}getPermissionStatus(){return"Notification"in window?Notification.permission:null}async subscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const s=await this.requestPermission();if(!s.granted)throw new Error(s.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),a={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")||new ArrayBuffer(0)),auth:this.arrayBufferToBase64(n.getKey("auth")||new ArrayBuffer(0))}},deviceInfo:this.getDeviceInfo()},i=await fetch(`${this.apiBaseUrl}/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!i.ok){const s=await i.json();throw new Error(s.error||"Subscription failed")}return console.log("Successfully subscribed to push notifications"),{success:!0}}catch(r){return console.error("Failed to subscribe to push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async unsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const r=await this.registration.pushManager.getSubscription();return r?(await r.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:r.endpoint})})).ok||console.warn("Failed to notify server of unsubscription"),console.log("Successfully unsubscribed from push notifications"),{success:!0}):{success:!0}}catch(r){return console.error("Failed to unsubscribe from push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async isSubscribed(){try{return this.registration?await this.registration.pushManager.getSubscription()!==null:!1}catch(r){return console.error("Failed to check subscription status:",r),!1}}async getSubscription(){try{return this.registration?await this.registration.pushManager.getSubscription():null}catch(r){return console.error("Failed to get subscription:",r),null}}async adminSubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const s=await this.requestPermission();if(!s.granted)throw new Error(s.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),a={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")||new ArrayBuffer(0)),auth:this.arrayBufferToBase64(n.getKey("auth")||new ArrayBuffer(0))}},deviceInfo:this.getDeviceInfo()},i=await fetch(`${this.apiBaseUrl}/push/admin/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!i.ok){const s=await i.json();throw new Error(s.error||"Admin subscription failed")}return console.log("Successfully subscribed admin to push notifications"),{success:!0}}catch(r){return console.error("Failed to subscribe admin to push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async adminUnsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const r=await this.registration.pushManager.getSubscription();return r?(await r.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/admin/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:r.endpoint})})).ok||console.warn("Failed to notify server of admin unsubscription"),console.log("Successfully unsubscribed admin from push notifications"),{success:!0}):{success:!0}}catch(r){return console.error("Failed to unsubscribe admin from push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async sendAdminTestNotification(){try{const r=await fetch(`${this.apiBaseUrl}/push/admin/test`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok){const n=await r.json();throw new Error(n.error||"Admin test notification failed")}return{success:!0}}catch(r){return console.error("Failed to send admin test notification:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async sendTestNotification(){try{const r=await fetch(`${this.apiBaseUrl}/push/send`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:"Test Notification",body:"This is a test notification from Vibebase",icon:"/favicon.svg",tag:"test-notification"})});if(!r.ok){const n=await r.json();throw new Error(n.error||"Test notification failed")}return{success:!0}}catch(r){return console.error("Failed to send test notification:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async fetchVapidPublicKey(){try{const r=await fetch(`${this.apiBaseUrl}/push/vapid-public-key`);if(!r.ok)throw new Error("Failed to fetch VAPID public key");const n=await r.json();this.vapidPublicKey=n.publicKey}catch(r){throw console.error("Failed to fetch VAPID public key:",r),r}}urlBase64ToUint8Array(r){const n="=".repeat((4-r.length%4)%4),a=(r+n).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(a),s=new Uint8Array(i.length);for(let o=0;o<i.length;++o)s[o]=i.charCodeAt(o);return s}arrayBufferToBase64(r){const n=new Uint8Array(r);let a="";for(let i=0;i<n.byteLength;i++)a+=String.fromCharCode(n[i]);return window.btoa(a)}getDeviceInfo(){const n=window.navigator.userAgent;let a="Unknown",i="Unknown",s="web";if(n.includes("Chrome")){a="Chrome";const o=n.match(/Chrome\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Firefox")){a="Firefox";const o=n.match(/Firefox\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Safari")&&!n.includes("Chrome")){a="Safari";const o=n.match(/Version\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Edge")){a="Edge";const o=n.match(/Edge\/(\d+)/);i=o?o[1]:"Unknown"}return n.includes("Mobile")||n.includes("Android")?s="android":(n.includes("iPhone")||n.includes("iPad"))&&(s="ios"),{userAgent:n,browser:a,version:i,platform:s}}}const re=new Er;function Ar(){const[t,r]=k(!1),[n,a]=k(null),[i,s]=k(!1),[o,d]=k([]),[l,m]=k([]),[b,c]=k(""),[x,p]=k("settings");R(()=>{u(),w(),y(),h(),g()},[]);const u=async()=>{await re.initialize(),a(re.getPermissionStatus())},h=async()=>{try{const f=await fetch("/api/push/vapid-public-key");if(f.ok){const C=await f.json();c(C.publicKey)}}catch(f){console.error("Failed to fetch VAPID public key:",f)}},g=async()=>{try{const f=await fetch("/api/push/admin/subscription",{credentials:"include"});if(f.ok){const C=await f.json();r(C.isSubscribed)}}catch(f){console.error("Failed to check admin subscription:",f)}},w=async()=>{try{const f=await fetch("/api/push/rules",{credentials:"include"});if(f.ok){const C=await f.json();d(C.rules||[])}}catch(f){console.error("Failed to fetch rules:",f)}},y=async()=>{try{const f=await fetch("/api/push/logs?limit=50",{credentials:"include"});if(f.ok){const C=await f.json();m(C.logs||[])}}catch(f){console.error("Failed to fetch logs:",f)}};return{isAdminSubscribed:t,permission:n,loading:i,rules:o,logs:l,vapidPublicKey:b,activeTab:x,setActiveTab:p,setLoading:s,handleAdminSubscribe:async()=>{s(!0);try{const f=await re.adminSubscribe();f.success?(r(!0),a("granted"),alert("Successfully subscribed to push notifications for testing!")):alert(`Failed to subscribe: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{s(!1)}},handleAdminUnsubscribe:async()=>{s(!0);try{const f=await re.adminUnsubscribe();f.success?(r(!1),alert("Successfully unsubscribed from push notifications!")):alert(`Failed to unsubscribe: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{s(!1)}},handleAdminTestNotification:async()=>{s(!0);try{const f=await re.sendAdminTestNotification();f.success?(alert("Test notification sent! Check your notifications."),y()):alert(`Failed to send test notification: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{s(!1)}},handleDeleteRule:async f=>{if(confirm("Are you sure you want to delete this rule?"))try{(await fetch(`/api/push/rules/${f}`,{method:"DELETE",credentials:"include"})).ok?(w(),alert("Rule deleted successfully")):alert("Failed to delete rule")}catch(C){console.error("Failed to delete rule:",C),alert("Error deleting rule")}},handleToggleRule:async f=>{try{(await fetch(`/api/push/rules/${f.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...f,enabled:!f.enabled})})).ok?w():alert("Failed to toggle rule")}catch(C){console.error("Failed to toggle rule:",C),alert("Error toggling rule")}},fetchRules:w,fetchLogs:y}}function $r(){const{isAdminSubscribed:t,permission:r,loading:n,rules:a,logs:i,vapidPublicKey:s,activeTab:o,setActiveTab:d,setLoading:l,handleAdminSubscribe:m,handleAdminUnsubscribe:b,handleAdminTestNotification:c,handleDeleteRule:x,handleToggleRule:p,fetchRules:u}=Ar(),[h,g]=k(!1),[w,y]=k(null),v=()=>{y(null),g(!0)},_=$=>{y($),g(!0)},S=()=>{g(!1),y(null)},N=async $=>{await u(),S()};return e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Push Notifications"}),e("p",{className:"mt-2 text-gray-600",children:"Manage push notification settings, rules, and view delivery logs"})]}),e("div",{className:"border-b border-gray-200 mb-8",children:e("div",{className:"-mb-px flex space-x-8",role:"tablist","aria-label":"Push notifications navigation",children:[{id:"settings",name:"Settings"},{id:"test",name:"Test"},{id:"rules",name:"Rules"},{id:"logs",name:"Logs"}].map($=>e("button",{type:"button",role:"tab","aria-selected":o===$.id,"aria-controls":`${$.id}-panel`,onClick:()=>d($.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${o===$.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:$.name},$.id))})}),e("div",{role:"tabpanel",id:"settings-panel","aria-labelledby":"settings-tab",children:o==="settings"&&e(Cr,{vapidPublicKey:s})}),e("div",{role:"tabpanel",id:"test-panel","aria-labelledby":"test-tab",children:o==="test"&&e(Tr,{isAdminSubscribed:t,permission:r,loading:n,onAdminSubscribe:m,onAdminUnsubscribe:b,onAdminTestNotification:c})}),e("div",{role:"tabpanel",id:"rules-panel","aria-labelledby":"rules-tab",children:o==="rules"&&e(kr,{rules:a,onCreateRule:v,onEditRule:_,onToggleRule:p,onDeleteRule:x})}),e("div",{role:"tabpanel",id:"logs-panel","aria-labelledby":"logs-tab",children:o==="logs"&&e(Nr,{logs:i})}),h&&e(Sr,{editingRule:w,loading:n,onSubmit:N,onClose:S,setLoading:l})]})}function Fr({onError:t}){const[r,n]=k([]),[a,i]=k(!1),[s,o]=k(""),[d,l]=k(!1),[m,b]=k(null),c=async()=>{try{i(!0),t(null);const u=await fetch("/api/admin",{credentials:"include"});if(!u.ok)throw new Error("Failed to load admins");const h=await u.json();n(h.admins)}catch(u){console.error("Failed to load admins:",u),t(u instanceof Error?u.message:"Failed to load admins")}finally{i(!1)}},x=async u=>{if(u.preventDefault(),!s.trim()){t("GitHub username is required");return}try{l(!0),t(null);const h=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({github_username:s.trim()})});if(!h.ok){const g=await h.json();throw new Error(g.error||"Failed to add admin")}o(""),await c()}catch(h){console.error("Failed to add admin:",h),t(h instanceof Error?h.message:"Failed to add admin")}finally{l(!1)}},p=async u=>{try{t(null);const h=await fetch(`/api/admin/${u}`,{method:"DELETE",credentials:"include"});if(!h.ok){const g=await h.json();throw new Error(g.error||"Failed to remove admin")}b(null),await c()}catch(h){console.error("Failed to remove admin:",h),t(h instanceof Error?h.message:"Failed to remove admin")}};return R(()=>{c()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Admin Management"}),e("form",{onSubmit:x,className:"mb-6",children:e("div",{className:"flex space-x-3",children:[e("div",{className:"flex-1",children:e("input",{type:"text",value:s,onChange:u=>o(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"GitHub username",disabled:d})}),e("button",{type:"submit",disabled:d||!s.trim(),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50",children:d?"Adding...":"Add Admin"})]})}),a?e("div",{className:"text-center py-4",children:e("p",{className:"text-gray-500",children:"Loading admins..."})}):e("div",{children:r.length===0?e("p",{className:"text-sm text-gray-500",children:"No admins found"}):e("div",{className:"space-y-2",children:r.map(u=>e("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e("div",{className:"flex items-center space-x-3",children:e("div",{children:[e("p",{className:"text-sm font-medium text-gray-900",children:[u.github_username,u.is_root&&e("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Root Admin"})]}),e("p",{className:"text-xs text-gray-500",children:["Added ",new Date(u.created_at).toLocaleDateString()]})]})}),!u.is_root&&e("button",{type:"button",onClick:()=>b({id:u.id,username:u.github_username}),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]},u.id))})}),m&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Remove Admin"}),e("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to remove"," ",e("span",{className:"font-medium",children:m.username})," as an admin? This action cannot be undone."]}),e("div",{className:"flex justify-end space-x-3",children:[e("button",{type:"button",onClick:()=>b(null),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"button",onClick:()=>p(m.id),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700",children:"Remove Admin"})]})]})})]})})}function jr({onError:t}){const[r,n]=k([]),[a,i]=k(!1),[s,o]=k(!1),[d,l]=k({name:"",scopes:[],expires_in_days:30}),[m,b]=k(null),[c]=k(["data:read","data:write","data:delete","tables:read","tables:write","tables:delete","storage:read","storage:write","storage:delete"]),[x,p]=k(null),u=async()=>{try{i(!0),t(null);const y=await fetch("/api/api-keys/init",{method:"POST",credentials:"include"});if(!y.ok){const S=await y.json().catch(()=>({}))}const v=await fetch("/api/api-keys",{credentials:"include"});if(!v.ok){const S=await v.json().catch(()=>({}));throw new Error(`Failed to load API keys: ${v.status} - ${S.error||"Unknown error"}`)}const _=await v.json();n(_.data||[])}catch(y){console.error("Failed to load API keys:",y);let v="Failed to load API keys";y instanceof Error&&(v=y.message),typeof y=="object"&&y!==null&&"status"in y&&(v+=` (Status: ${y.status})`),t(v)}finally{i(!1)}},h=async y=>{if(y.preventDefault(),!d.name.trim()||d.scopes.length===0){t("Name and at least one scope are required");return}try{t(null);const v=await fetch("/api/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});if(!v.ok){const S=await v.json().catch(()=>({})),N=`Failed to create API key: ${v.status} - ${S.error||"Unknown error"}`;throw S.details?new Error(`${N}. Details: ${JSON.stringify(S.details)}`):new Error(N)}const _=await v.json();b(_.data),o(!1),l({name:"",scopes:[],expires_in_days:30}),await u()}catch(v){console.error("Failed to create API key:",v),t(v instanceof Error?v.message:"Failed to create API key")}},g=async y=>{try{t(null);const v=await fetch(`/api/api-keys/${y}`,{method:"DELETE",credentials:"include"});if(!v.ok){const _=await v.json().catch(()=>({}));throw new Error(_.error||"Failed to revoke API key")}p(null),await u()}catch(v){console.error("Failed to revoke API key:",v),t(v instanceof Error?v.message:"Failed to revoke API key")}},w=y=>{l(v=>({...v,scopes:v.scopes.includes(y)?v.scopes.filter(_=>_!==y):[...v.scopes,y]}))};return R(()=>{u()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"API Keys"}),e("div",{className:"flex items-center space-x-2",children:e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Create API Key"})})]}),a?e("div",{className:"text-center py-4",children:e("p",{className:"text-gray-500",children:"Loading API keys..."})}):e("div",{className:"space-y-2",children:r.length===0?e("p",{className:"text-sm text-gray-500",children:"No API keys found. Create one to get started."}):e("div",{className:"space-y-3",children:r.map(y=>e("div",{className:"border border-gray-200 rounded-lg p-4",children:e("div",{className:"flex items-start justify-between",children:[e("div",{className:"flex-1",children:[e("div",{className:"flex items-center space-x-2 mb-2",children:[e("h4",{className:"text-sm font-medium text-gray-900",children:y.name}),e("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:y.is_active?"Active":"Revoked"})]}),e("div",{className:"space-y-1 text-sm text-gray-600",children:[e("p",{children:[e("span",{className:"font-medium",children:"Key:"})," ",y.key_prefix,"..."]}),e("p",{children:[e("span",{className:"font-medium",children:"Scopes:"})," ",y.scopes.join(", ")]}),e("p",{children:[e("span",{className:"font-medium",children:"Created:"})," ",new Date(y.created_at).toLocaleDateString()]}),y.expires_at&&e("p",{children:[e("span",{className:"font-medium",children:"Expires:"})," ",new Date(y.expires_at).toLocaleDateString()]}),y.last_used_at&&e("p",{children:[e("span",{className:"font-medium",children:"Last used:"})," ",new Date(y.last_used_at).toLocaleDateString()]})]})]}),y.is_active&&e("button",{type:"button",onClick:()=>p({id:y.id,name:y.name}),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Revoke"})]})},y.id))})}),s&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create API Key"}),e("form",{onSubmit:h,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"api-key-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e("input",{id:"api-key-name",type:"text",value:d.name,onChange:y=>l(v=>({...v,name:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"My API Key",required:!0})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{className:"space-y-2",children:c.map(y=>e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:d.scopes.includes(y),onChange:()=>w(y),className:"mr-2"}),e("span",{className:"text-sm",children:y})]},y))})]}),e("div",{children:[e("label",{htmlFor:"expires-in-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires in (days)"}),e("input",{id:"expires-in-days",type:"number",value:d.expires_in_days||"",onChange:y=>l(v=>({...v,expires_in_days:parseInt(y.target.value)||void 0})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"30",min:"1",max:"365"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for no expiration"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700",children:"Create Key"})]})]})]})}),x&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Revoke API Key"}),e("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to revoke the API key"," ",e("span",{className:"font-medium",children:['"',x.name,'"']}),"? This action cannot be undone and will immediately disable the key."]}),e("div",{className:"flex justify-end space-x-3",children:[e("button",{type:"button",onClick:()=>p(null),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"button",onClick:()=>g(x.id),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700",children:"Revoke Key"})]})]})}),m&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"API Key Created"}),e("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:e("p",{className:"text-sm text-yellow-800 mb-2",children:[e("strong",{children:"Important:"})," This is the only time you'll see the full API key. Copy it now and store it securely."]})}),e("div",{className:"space-y-3",children:[e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Name"}),e("p",{className:"text-sm text-gray-900",children:m.name})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"API Key"}),e("div",{className:"flex items-center space-x-2",children:[e("code",{className:"flex-1 px-2 py-1 bg-gray-100 rounded text-sm font-mono break-all",children:m.key}),e("button",{type:"button",onClick:()=>navigator.clipboard.writeText(m.key),className:"px-2 py-1 text-blue-600 hover:text-blue-800 text-sm",children:"Copy"})]})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Scopes"}),e("p",{className:"text-sm text-gray-900",children:m.scopes.join(", ")})]}),m.expires_at&&e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Expires"}),e("p",{className:"text-sm text-gray-900",children:new Date(m.expires_at).toLocaleDateString()})]})]}),e("div",{className:"flex justify-end pt-4",children:e("button",{type:"button",onClick:()=>b(null),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700",children:"I've saved the key"})})]})})]})})}function Ge({onError:t}){const[r,n]=k([]),[a,i]=k(!1),[s,o]=k(!1),[d,l]=k({}),[m,b]=k(!1),c=async()=>{try{i(!0),t(null);const u=await fetch("/api/app-settings",{credentials:"include"});if(!u.ok)throw new Error("Failed to load app settings");const h=await u.json();n(h.settings);const g={};h.settings.forEach(w=>{g[w.key]=w.value}),l(g)}catch(u){console.error("Failed to load app settings:",u),t(u instanceof Error?u.message:"Failed to load app settings")}finally{i(!1)}},x=async()=>{try{b(!0),t(null);const u=await fetch("/api/app-settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});if(!u.ok){const h=await u.json();throw new Error(h.error||"Failed to save app settings")}o(!1),await c()}catch(u){console.error("Failed to save app settings:",u),t(u instanceof Error?u.message:"Failed to save app settings")}finally{b(!1)}},p=()=>{o(!1);const u={};r.forEach(h=>{u[h.key]=h.value}),l(u)};return R(()=>{c()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Application Settings"}),!s&&e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Edit Settings"})]}),a?e("p",{className:"text-gray-500",children:"Loading app settings..."}):e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"app-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Application Name"}),e("input",{id:"app-name",type:"text",value:d.app_name||"",onChange:u=>l(h=>({...h,app_name:u.target.value})),disabled:!s,className:`w-full px-3 py-2 border ${s?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"My Vibebase App"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"Used as User-Agent for OAuth providers"})]}),e("div",{children:[e("label",{htmlFor:"app-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Application URL (optional)"}),e("input",{id:"app-url",type:"url",value:d.app_url||"",onChange:u=>l(h=>({...h,app_url:u.target.value})),disabled:!s,className:`w-full px-3 py-2 border ${s?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"https://myapp.com"})]}),e("div",{children:[e("label",{htmlFor:"support-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Support Email (optional)"}),e("input",{id:"support-email",type:"email",value:d.support_email||"",onChange:u=>l(h=>({...h,support_email:u.target.value})),disabled:!s,className:`w-full px-3 py-2 border ${s?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"support@myapp.com"})]}),s&&e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300",disabled:m,children:"Cancel"}),e("button",{type:"button",onClick:x,className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-300 disabled:opacity-50",disabled:m,children:m?"Saving...":"Save Changes"})]})]})]})})}function Pr({activeSection:t,onSectionChange:r}){return e("div",{className:"w-64 bg-gray-50 p-4",children:[e("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Settings"}),e("nav",{className:"space-y-2",children:[{id:"app-settings",label:"App Settings",icon:"âš™ï¸"},{id:"admins",label:"Admins",icon:"ðŸ‘¥"},{id:"api-keys",label:"API Keys",icon:"ðŸ”‘"}].map(a=>e("button",{type:"button",onClick:()=>r(a.id),className:`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${t===a.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e("span",{className:"mr-2",children:a.icon}),a.label]},a.id))})]})}const Ur=()=>{const[t,r]=k({activeSection:"app-settings",error:null});return{...t,setActiveSection:s=>{r(o=>({...o,activeSection:s,error:null}))},setError:s=>{r(o=>({...o,error:s}))},clearError:()=>{r(s=>({...s,error:null}))}}};function Dr(){const{activeSection:t,error:r,setActiveSection:n,setError:a}=Ur();return e("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),e("p",{className:"mt-2 text-gray-600",children:"Manage your application settings, administrators, and API keys"})]}),r&&e("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("div",{className:"flex justify-between items-center",children:[e("p",{className:"text-red-700",children:r}),e("button",{type:"button",onClick:()=>a(null),className:"text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]})}),e("div",{className:"flex gap-6",children:[e(Pr,{activeSection:t,onSectionChange:n}),e("div",{className:"flex-1",children:(()=>{switch(t){case"app-settings":return e(Ge,{onError:a});case"admins":return e(Fr,{onError:a});case"api-keys":return e(jr,{onError:a});default:return e(Ge,{onError:a})}})()})]})]})})}function Ir(){const[t,r]=k([]),[n,a]=k(!0),[i,s]=k(null),[o,d]=k(!1),[l,m]=k(new Set);R(()=>{b()},[]);const b=async(g,w)=>{try{a(!0);const y=new URLSearchParams,v=await fetch(`/api/storage?${y}`);if(!v.ok)throw new Error("Failed to load files");const _=await v.json();r(w?[...t,..._.objects]:_.objects)}catch(y){s(y instanceof Error?y.message:"Unknown error")}finally{a(!1)}},c=async g=>{const w=g.target,y=w.files;if(y!=null&&y.length){d(!0);try{for(const v of Array.from(y)){const _=new FormData;if(_.append("file",v),!(await fetch("/api/storage/upload",{method:"POST",body:_})).ok)throw new Error(`Failed to upload ${v.name}`)}await b(),w.value=""}catch(v){s(v instanceof Error?v.message:"Upload failed")}finally{d(!1)}}},x=async g=>{if(confirm(`Delete ${g}?`))try{if(!(await fetch(`/api/storage/${encodeURIComponent(g)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete file");r(t.filter(y=>y.key!==g))}catch(w){s(w instanceof Error?w.message:"Delete failed")}},p=async()=>{if(l.size!==0&&confirm(`Delete ${l.size} files?`))try{if(!(await fetch("/api/storage",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:Array.from(l)})})).ok)throw new Error("Failed to delete files");r(t.filter(w=>!l.has(w.key))),m(new Set)}catch(g){s(g instanceof Error?g.message:"Bulk delete failed")}},u=g=>{if(g===0)return"0 B";const w=1024,y=["B","KB","MB","GB"],v=Math.floor(Math.log(g)/Math.log(w));return`${parseFloat((g/w**v).toFixed(2))} ${y[v]}`},h=g=>{const w=new Set(l);w.has(g)?w.delete(g):w.add(g),m(w)};return n&&t.length===0?e("div",{class:"flex items-center justify-center h-64",children:e("div",{class:"text-gray-500",children:"Loading files..."})}):e("div",{children:[e("div",{class:"flex justify-between items-center mb-6",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Storage"}),e("div",{class:"flex gap-2",children:[l.size>0&&e("button",{type:"button",onClick:p,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:["Delete Selected (",l.size,")"]}),e("label",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer",children:[o?"Uploading...":"Upload Files",e("input",{type:"file",multiple:!0,onChange:c,disabled:o,class:"hidden"})]})]})]}),i&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-red-600",children:i}),e("button",{type:"button",onClick:()=>s(null),class:"mt-2 text-sm text-red-500 hover:text-red-700",children:"Dismiss"})]}),e("div",{class:"bg-white shadow rounded-lg overflow-hidden",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[e("th",{class:"w-12 px-6 py-3",children:e("input",{type:"checkbox",checked:l.size===t.length&&t.length>0,onChange:g=>{g.target.checked?m(new Set(t.map(y=>y.key))):m(new Set)}})}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:t.length===0?e("tr",{children:e("td",{colSpan:6,class:"px-6 py-4 text-center text-gray-500",children:"No files uploaded yet"})}):t.map(g=>e("tr",{class:"hover:bg-gray-50",children:[e("td",{class:"px-6 py-4",children:e("input",{type:"checkbox",checked:l.has(g.key),onChange:()=>h(g.key)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm font-medium text-gray-900",children:g.key})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:u(g.size)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:g.contentType||"Unknown"})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:new Date(g.uploaded).toLocaleString()})}),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e("a",{href:`/api/storage/download/${encodeURIComponent(g.key)}`,class:"text-blue-600 hover:text-blue-900 mr-4",download:!0,children:"Download"}),e("button",{type:"button",onClick:()=>x(g.key),class:"text-red-600 hover:text-red-900",children:"Delete"})]})]},g.key))})]})})]})}function Lr(){return e(Jt,{children:e(ft,{children:[e(G,{path:"/",component:_r}),e(G,{path:"/database",component:wr}),e(G,{path:"/custom-sql",component:cr}),e(G,{path:"/storage",component:Ir}),e(G,{path:"/push",component:$r}),e(G,{path:"/auth",component:er}),e(G,{path:"/settings",component:Dr})]})})}const xt=document.getElementById("app");if(!xt)throw new Error("App container not found");St(e(Lr,{}),xt);
//# sourceMappingURL=index-D990F1VL.js.map
