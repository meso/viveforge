var _t=Object.defineProperty;var Nt=(t,r,n)=>r in t?_t(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var re=(t,r,n)=>Nt(t,typeof r!="symbol"?r+"":r,n);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var oe,I,Ye,Z,je,et,tt,rt,Te,ve,we,nt,ie={},st=[],kt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ce=Array.isArray;function V(t,r){for(var n in r)t[n]=r[n];return t}function Ee(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Se(t,r,n){var s,i,a,o={};for(a in r)a=="key"?s=r[a]:a=="ref"?i=r[a]:o[a]=r[a];if(arguments.length>2&&(o.children=arguments.length>3?oe.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)o[a]===void 0&&(o[a]=t.defaultProps[a]);return se(t,o,s,i,null)}function se(t,r,n,s,i){var a={type:t,props:r,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Ye,__i:-1,__u:0};return i==null&&I.vnode!=null&&I.vnode(a),a}function Y(t){return t.children}function ae(t,r){this.props=t,this.context=r}function ee(t,r){if(r==null)return t.__?ee(t.__,t.__i+1):null;for(var n;r<t.__k.length;r++)if((n=t.__k[r])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?ee(t):null}function at(t){var r,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,r=0;r<t.__k.length;r++)if((n=t.__k[r])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return at(t)}}function _e(t){(!t.__d&&(t.__d=!0)&&Z.push(t)&&!pe.__r++||je!=I.debounceRendering)&&((je=I.debounceRendering)||et)(pe)}function pe(){for(var t,r,n,s,i,a,o,c=1;Z.length;)Z.length>c&&Z.sort(tt),t=Z.shift(),c=Z.length,t.__d&&(n=void 0,i=(s=(r=t).__v).__e,a=[],o=[],r.__P&&((n=V({},s)).__v=s.__v+1,I.vnode&&I.vnode(n),Ae(r.__P,n,s,r.__n,r.__P.namespaceURI,32&s.__u?[i]:null,a,i??ee(s),!!(32&s.__u),o),n.__v=s.__v,n.__.__k[n.__i]=n,ot(a,n,o),n.__e!=i&&at(n)));pe.__r=0}function it(t,r,n,s,i,a,o,c,l,m,b){var d,g,x,u,h,p,v=s&&s.__k||st,y=r.length;for(l=Ct(n,r,v,l,y),d=0;d<y;d++)(x=n.__k[d])!=null&&(g=x.__i==-1?ie:v[x.__i]||ie,x.__i=d,p=Ae(t,x,g,i,a,o,c,l,m,b),u=x.__e,x.ref&&g.ref!=x.ref&&(g.ref&&$e(g.ref,null,x),b.push(x.ref,x.__c||u,x)),h==null&&u!=null&&(h=u),4&x.__u||g.__k===x.__k?l=lt(x,l,t):typeof x.type=="function"&&p!==void 0?l=p:u&&(l=u.nextSibling),x.__u&=-7);return n.__e=h,l}function Ct(t,r,n,s,i){var a,o,c,l,m,b=n.length,d=b,g=0;for(t.__k=new Array(i),a=0;a<i;a++)(o=r[a])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=a+g,(o=t.__k[a]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?se(null,o,null,null,null):ce(o)?se(Y,{children:o},null,null,null):o.constructor==null&&o.__b>0?se(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,c=null,(m=o.__i=Tt(o,n,l,d))!=-1&&(d--,(c=n[m])&&(c.__u|=2)),c==null||c.__v==null?(m==-1&&(i>b?g--:i<b&&g++),typeof o.type!="function"&&(o.__u|=4)):m!=l&&(m==l-1?g--:m==l+1?g++:(m>l?g--:g++,o.__u|=4))):t.__k[a]=null;if(d)for(a=0;a<b;a++)(c=n[a])!=null&&!(2&c.__u)&&(c.__e==s&&(s=ee(c)),dt(c,c));return s}function lt(t,r,n){var s,i;if(typeof t.type=="function"){for(s=t.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=t,r=lt(s[i],r,n));return r}t.__e!=r&&(r&&t.type&&!n.contains(r)&&(r=ee(t)),n.insertBefore(t.__e,r||null),r=t.__e);do r=r&&r.nextSibling;while(r!=null&&r.nodeType==8);return r}function Ne(t,r){return r=r||[],t==null||typeof t=="boolean"||(ce(t)?t.some(function(n){Ne(n,r)}):r.push(t)),r}function Tt(t,r,n,s){var i,a,o=t.key,c=t.type,l=r[n];if(l===null&&t.key==null||l&&o==l.key&&c==l.type&&!(2&l.__u))return n;if(s>(l!=null&&!(2&l.__u)?1:0))for(i=n-1,a=n+1;i>=0||a<r.length;){if(i>=0){if((l=r[i])&&!(2&l.__u)&&o==l.key&&c==l.type)return i;i--}if(a<r.length){if((l=r[a])&&!(2&l.__u)&&o==l.key&&c==l.type)return a;a++}}return-1}function Oe(t,r,n){r[0]=="-"?t.setProperty(r,n??""):t[r]=n==null?"":typeof n!="number"||kt.test(r)?n:n+"px"}function ue(t,r,n,s,i){var a,o;e:if(r=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(r in s)n&&r in n||Oe(t.style,r,"");if(n)for(r in n)s&&n[r]==s[r]||Oe(t.style,r,n[r])}else if(r[0]=="o"&&r[1]=="n")a=r!=(r=r.replace(rt,"$1")),o=r.toLowerCase(),r=o in t||r=="onFocusOut"||r=="onFocusIn"?o.slice(2):r.slice(2),t.l||(t.l={}),t.l[r+a]=n,n?s?n.u=s.u:(n.u=Te,t.addEventListener(r,a?we:ve,a)):t.removeEventListener(r,a?we:ve,a);else{if(i=="http://www.w3.org/2000/svg")r=r.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(r!="width"&&r!="height"&&r!="href"&&r!="list"&&r!="form"&&r!="tabIndex"&&r!="download"&&r!="rowSpan"&&r!="colSpan"&&r!="role"&&r!="popover"&&r in t)try{t[r]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&r[4]!="-"?t.removeAttribute(r):t.setAttribute(r,r=="popover"&&n==1?"":n))}}function Me(t){return function(r){if(this.l){var n=this.l[r.type+t];if(r.t==null)r.t=Te++;else if(r.t<n.u)return;return n(I.event?I.event(r):r)}}}function Ae(t,r,n,s,i,a,o,c,l,m){var b,d,g,x,u,h,p,v,y,w,_,C,N,$,f,T,U,E=r.type;if(r.constructor!=null)return null;128&n.__u&&(l=!!(32&n.__u),a=[c=r.__e=n.__e]),(b=I.__b)&&b(r);e:if(typeof E=="function")try{if(v=r.props,y="prototype"in E&&E.prototype.render,w=(b=E.contextType)&&s[b.__c],_=b?w?w.props.value:b.__:s,n.__c?p=(d=r.__c=n.__c).__=d.__E:(y?r.__c=d=new E(v,_):(r.__c=d=new ae(v,_),d.constructor=E,d.render=St),w&&w.sub(d),d.props=v,d.state||(d.state={}),d.context=_,d.__n=s,g=d.__d=!0,d.__h=[],d._sb=[]),y&&d.__s==null&&(d.__s=d.state),y&&E.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=V({},d.__s)),V(d.__s,E.getDerivedStateFromProps(v,d.__s))),x=d.props,u=d.state,d.__v=r,g)y&&E.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),y&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(y&&E.getDerivedStateFromProps==null&&v!==x&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(v,_),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(v,d.__s,_)===!1||r.__v==n.__v){for(r.__v!=n.__v&&(d.props=v,d.state=d.__s,d.__d=!1),r.__e=n.__e,r.__k=n.__k,r.__k.some(function(P){P&&(P.__=r)}),C=0;C<d._sb.length;C++)d.__h.push(d._sb[C]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(v,d.__s,_),y&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(x,u,h)})}if(d.context=_,d.props=v,d.__P=t,d.__e=!1,N=I.__r,$=0,y){for(d.state=d.__s,d.__d=!1,N&&N(r),b=d.render(d.props,d.state,d.context),f=0;f<d._sb.length;f++)d.__h.push(d._sb[f]);d._sb=[]}else do d.__d=!1,N&&N(r),b=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++$<25);d.state=d.__s,d.getChildContext!=null&&(s=V(V({},s),d.getChildContext())),y&&!g&&d.getSnapshotBeforeUpdate!=null&&(h=d.getSnapshotBeforeUpdate(x,u)),T=b,b!=null&&b.type===Y&&b.key==null&&(T=ct(b.props.children)),c=it(t,ce(T)?T:[T],r,n,s,i,a,o,c,l,m),d.base=r.__e,r.__u&=-161,d.__h.length&&o.push(d),p&&(d.__E=d.__=null)}catch(P){if(r.__v=null,l||a!=null)if(P.then){for(r.__u|=l?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;a[a.indexOf(c)]=null,r.__e=c}else for(U=a.length;U--;)Ee(a[U]);else r.__e=n.__e,r.__k=n.__k;I.__e(P,r,n)}else a==null&&r.__v==n.__v?(r.__k=n.__k,r.__e=n.__e):c=r.__e=Et(n.__e,r,n,s,i,a,o,l,m);return(b=I.diffed)&&b(r),128&r.__u?void 0:c}function ot(t,r,n){for(var s=0;s<n.length;s++)$e(n[s],n[++s],n[++s]);I.__c&&I.__c(r,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(a){a.call(i)})}catch(a){I.__e(a,i.__v)}})}function ct(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ce(t)?t.map(ct):V({},t)}function Et(t,r,n,s,i,a,o,c,l){var m,b,d,g,x,u,h,p=n.props,v=r.props,y=r.type;if(y=="svg"?i="http://www.w3.org/2000/svg":y=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),a!=null){for(m=0;m<a.length;m++)if((x=a[m])&&"setAttribute"in x==!!y&&(y?x.localName==y:x.nodeType==3)){t=x,a[m]=null;break}}if(t==null){if(y==null)return document.createTextNode(v);t=document.createElementNS(i,y,v.is&&v),c&&(I.__m&&I.__m(r,a),c=!1),a=null}if(y==null)p===v||c&&t.data==v||(t.data=v);else{if(a=a&&oe.call(t.childNodes),p=n.props||ie,!c&&a!=null)for(p={},m=0;m<t.attributes.length;m++)p[(x=t.attributes[m]).name]=x.value;for(m in p)if(x=p[m],m!="children"){if(m=="dangerouslySetInnerHTML")d=x;else if(!(m in v)){if(m=="value"&&"defaultValue"in v||m=="checked"&&"defaultChecked"in v)continue;ue(t,m,null,x,i)}}for(m in v)x=v[m],m=="children"?g=x:m=="dangerouslySetInnerHTML"?b=x:m=="value"?u=x:m=="checked"?h=x:c&&typeof x!="function"||p[m]===x||ue(t,m,x,p[m],i);if(b)c||d&&(b.__html==d.__html||b.__html==t.innerHTML)||(t.innerHTML=b.__html),r.__k=[];else if(d&&(t.innerHTML=""),it(r.type=="template"?t.content:t,ce(g)?g:[g],r,n,s,y=="foreignObject"?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:n.__k&&ee(n,0),c,l),a!=null)for(m=a.length;m--;)Ee(a[m]);c||(m="value",y=="progress"&&u==null?t.removeAttribute("value"):u!=null&&(u!==t[m]||y=="progress"&&!u||y=="option"&&u!=p[m])&&ue(t,m,u,p[m],i),m="checked",h!=null&&h!=t[m]&&ue(t,m,h,p[m],i))}return t}function $e(t,r,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&r==null||(t.__u=t(r))}else t.current=r}catch(i){I.__e(i,n)}}function dt(t,r,n){var s,i;if(I.unmount&&I.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||$e(s,null,r)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(a){I.__e(a,r)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&dt(s[i],r,n||typeof t.type!="function");n||Ee(t.__e),t.__c=t.__=t.__e=void 0}function St(t,r,n){return this.constructor(t,n)}function At(t,r,n){var s,i,a,o;r==document&&(r=document.documentElement),I.__&&I.__(t,r),i=(s=!1)?null:r.__k,a=[],o=[],Ae(r,t=r.__k=Se(Y,null,[t]),i||ie,ie,r.namespaceURI,i?null:r.firstChild?oe.call(r.childNodes):null,a,i?i.__e:r.firstChild,s,o),ot(a,t,o)}function $t(t,r,n){var s,i,a,o,c=V({},t.props);for(a in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),r)a=="key"?s=r[a]:a=="ref"?i=r[a]:c[a]=r[a]===void 0&&o!=null?o[a]:r[a];return arguments.length>2&&(c.children=arguments.length>3?oe.call(arguments,2):n),se(t.type,c,s||t.key,i||t.ref,null)}function Ft(t){function r(n){var s,i;return this.getChildContext||(s=new Set,(i={})[r.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(a){this.props.value!=a.value&&s.forEach(function(o){o.__e=!0,_e(o)})},this.sub=function(a){s.add(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){s&&s.delete(a),o&&o.call(a)}}),n.children}return r.__c="__cC"+nt++,r.__=t,r.Provider=r.__l=(r.Consumer=function(n,s){return n.children(s)}).contextType=r,r}oe=st.slice,I={__e:function(t,r,n,s){for(var i,a,o;r=r.__;)if((i=r.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),o=i.__d),o)return i.__E=i}catch(c){t=c}throw t}},Ye=0,ae.prototype.setState=function(t,r){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=V({},this.state),typeof t=="function"&&(t=t(V({},n),this.props)),t&&V(n,t),t!=null&&this.__v&&(r&&this._sb.push(r),_e(this))},ae.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_e(this))},ae.prototype.render=Y,Z=[],et=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,tt=function(t,r){return t.__v.__b-r.__v.__b},pe.__r=0,rt=/(PointerCapture)$|Capture$/i,Te=0,ve=Me(!1),we=Me(!0),nt=0;var Pt=0;function e(t,r,n,s,i,a){r||(r={});var o,c,l=r;if("ref"in l)for(c in l={},r)c=="ref"?o=r[c]:l[c]=r[c];var m={type:t,props:l,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Pt,__i:-1,__u:0,__source:i,__self:a};if(typeof t=="function"&&(o=t.defaultProps))for(c in o)l[c]===void 0&&(l[c]=o[c]);return I.vnode&&I.vnode(m),m}var le,j,ge,qe,fe=0,ut=[],O=I,ze=O.__b,Ke=O.__r,Re=O.diffed,Be=O.__c,He=O.unmount,Ve=O.__;function Fe(t,r){O.__h&&O.__h(j,t,fe||r),fe=0;var n=j.__H||(j.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function k(t){return fe=1,Ut(ht,t)}function Ut(t,r,n){var s=Fe(le++,2);if(s.t=t,!s.__c&&(s.__=[ht(void 0,r),function(c){var l=s.__N?s.__N[0]:s.__[0],m=s.t(l,c);l!==m&&(s.__N=[m,s.__[1]],s.__c.setState({}))}],s.__c=j,!j.__f)){var i=function(c,l,m){if(!s.__c.__H)return!0;var b=s.__c.__H.__.filter(function(g){return!!g.__c});if(b.every(function(g){return!g.__N}))return!a||a.call(this,c,l,m);var d=s.__c.props!==c;return b.forEach(function(g){if(g.__N){var x=g.__[0];g.__=g.__N,g.__N=void 0,x!==g.__[0]&&(d=!0)}}),a&&a.call(this,c,l,m)||d};j.__f=!0;var a=j.shouldComponentUpdate,o=j.componentWillUpdate;j.componentWillUpdate=function(c,l,m){if(this.__e){var b=a;a=void 0,i(c,l,m),a=b}o&&o.call(this,c,l,m)},j.shouldComponentUpdate=i}return s.__N||s.__}function K(t,r){var n=Fe(le++,3);!O.__s&&mt(n.__H,r)&&(n.__=t,n.u=r,j.__H.__h.push(n))}function It(t){return fe=5,Dt(function(){return{current:t}},[])}function Dt(t,r){var n=Fe(le++,7);return mt(n.__H,r)&&(n.__=t(),n.__H=r,n.__h=t),n.__}function Lt(){for(var t;t=ut.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(he),t.__H.__h.forEach(ke),t.__H.__h=[]}catch(r){t.__H.__h=[],O.__e(r,t.__v)}}O.__b=function(t){j=null,ze&&ze(t)},O.__=function(t,r){t&&r.__k&&r.__k.__m&&(t.__m=r.__k.__m),Ve&&Ve(t,r)},O.__r=function(t){Ke&&Ke(t),le=0;var r=(j=t.__c).__H;r&&(ge===j?(r.__h=[],j.__h=[],r.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(r.__h.forEach(he),r.__h.forEach(ke),r.__h=[],le=0)),ge=j},O.diffed=function(t){Re&&Re(t);var r=t.__c;r&&r.__H&&(r.__H.__h.length&&(ut.push(r)!==1&&qe===O.requestAnimationFrame||((qe=O.requestAnimationFrame)||jt)(Lt)),r.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ge=j=null},O.__c=function(t,r){r.some(function(n){try{n.__h.forEach(he),n.__h=n.__h.filter(function(s){return!s.__||ke(s)})}catch(s){r.some(function(i){i.__h&&(i.__h=[])}),r=[],O.__e(s,n.__v)}}),Be&&Be(t,r)},O.unmount=function(t){He&&He(t);var r,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{he(s)}catch(i){r=i}}),n.__H=void 0,r&&O.__e(r,n.__v))};var We=typeof requestAnimationFrame=="function";function jt(t){var r,n=function(){clearTimeout(s),We&&cancelAnimationFrame(r),setTimeout(t)},s=setTimeout(n,35);We&&(r=requestAnimationFrame(n))}function he(t){var r=j,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),j=r}function ke(t){var r=j;t.__c=t.__(),j=r}function mt(t,r){return!t||t.length!==r.length||r.some(function(n,s){return n!==t[s]})}function ht(t,r){return typeof r=="function"?r(t):r}var Ot={};function me(t,r){for(var n in r)t[n]=r[n];return t}function Mt(t,r,n){var s,i=/(?:\?([^#]*))?(#.*)?$/,a=t.match(i),o={};if(a&&a[1])for(var c=a[1].split("&"),l=0;l<c.length;l++){var m=c[l].split("=");o[decodeURIComponent(m[0])]=decodeURIComponent(m.slice(1).join("="))}t=Ce(t.replace(i,"")),r=Ce(r||"");for(var b=Math.max(t.length,r.length),d=0;d<b;d++)if(r[d]&&r[d].charAt(0)===":"){var g=r[d].replace(/(^:|[+*?]+$)/g,""),x=(r[d].match(/[+*?]+$/)||Ot)[0]||"",u=~x.indexOf("+"),h=~x.indexOf("*"),p=t[d]||"";if(!p&&!h&&(x.indexOf("?")<0||u)){s=!1;break}if(o[g]=decodeURIComponent(p),u||h){o[g]=t.slice(d).map(decodeURIComponent).join("/");break}}else if(r[d]!==t[d]){s=!1;break}return(n.default===!0||s!==!1)&&o}function qt(t,r){return t.rank<r.rank?1:t.rank>r.rank?-1:t.index-r.index}function zt(t,r){return t.index=r,t.rank=function(n){return n.props.default?0:Ce(n.props.path).map(Kt).join("")}(t),t.props}function Ce(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Kt(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Rt={},X=[],Je=[],z=null,pt={url:Pe()},Bt=Ft(pt);function Pe(){var t;return""+((t=z&&z.location?z.location:z&&z.getCurrentLocation?z.getCurrentLocation():typeof location<"u"?location:Rt).pathname||"")+(t.search||"")}function ft(t,r){return r===void 0&&(r=!1),typeof t!="string"&&t.url&&(r=t.replace,t=t.url),function(n){for(var s=X.length;s--;)if(X[s].canRoute(n))return!0;return!1}(t)&&function(n,s){s===void 0&&(s="push"),z&&z[s]?z[s](n):typeof history<"u"&&history[s+"State"]&&history[s+"State"](null,null,n)}(t,r?"replace":"push"),gt(t)}function gt(t){for(var r=!1,n=0;n<X.length;n++)X[n].routeTo(t)&&(r=!0);return r}function Ht(t){if(t&&t.getAttribute){var r=t.getAttribute("href"),n=t.getAttribute("target");if(r&&r.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return ft(r)}}function Vt(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Wt(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var r=t.target;do if(r.localName==="a"&&r.getAttribute("href")){if(r.hasAttribute("data-native")||r.hasAttribute("native"))return;if(Ht(r))return Vt(t)}while(r=r.parentNode)}}var Qe=!1;function bt(t){t.history&&(z=t.history),this.state={url:t.url||Pe()}}me(bt.prototype=new ae,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var r=Ne(this.props.children);return this.g(r,t)!==void 0},routeTo:function(t){this.setState({url:t});var r=this.canRoute(t);return this.p||this.forceUpdate(),r},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;Qe||(Qe=!0,z||addEventListener("popstate",function(){gt(Pe())}),addEventListener("click",Wt)),X.push(this),z&&(this.u=z.listen(function(r){var n=r.location||r;t.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),X.splice(X.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,r){t=t.filter(zt).sort(qt);for(var n=0;n<t.length;n++){var s=t[n],i=Mt(r,s.props.path,s.props);if(i)return[s,i]}},render:function(t,r){var n,s,i=t.onChange,a=r.url,o=this.c,c=this.g(Ne(t.children),a);if(c&&(s=$t(c[0],me(me({url:a,matches:n=c[1]},n),{key:void 0,ref:void 0}))),a!==(o&&o.url)){me(pt,o=this.c={url:a,previous:o&&o.url,current:s,path:s?s.props.path:null,matches:n}),o.router=this,o.active=s?[s]:[];for(var l=Je.length;l--;)Je[l]({});typeof i=="function"&&i(o)}return Se(Bt.Provider,{value:o},s)}});var Q=function(t){return Se(t.component,t)};function yt(t){var r,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(n=yt(t[r]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function Jt(){for(var t,r,n=0,s="",i=arguments.length;n<i;n++)(t=arguments[n])&&(r=yt(t))&&(s&&(s+=" "),s+=r);return s}function Qt(){K(()=>{const t=async()=>{try{(await fetch(`${window.location.origin}/auth/status`)).status===401&&window.location.pathname!=="/auth/login"&&(console.warn("Session expired, redirecting to login..."),window.location.href="/auth/login")}catch(r){console.debug("Auth check failed on focus:",r)}};return window.addEventListener("focus",t),t(),()=>{window.removeEventListener("focus",t)}},[])}function Gt({children:t}){return Qt(),e("div",{class:"min-h-screen bg-gray-50",children:[e("nav",{class:"bg-white shadow-sm border-b",children:e("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e("div",{class:"flex justify-between h-16",children:[e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0 flex items-center",children:e("h1",{class:"text-xl font-bold text-gray-900",children:"Vibebase"})}),e("div",{class:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[e(G,{href:"/",children:"Dashboard"}),e(G,{href:"/database",children:"Database"}),e(G,{href:"/custom-sql",children:"Custom SQL"}),e(G,{href:"/storage",children:"Storage"}),e(G,{href:"/push",children:"Push"}),e(G,{href:"/auth",children:"Auth"}),e(G,{href:"/settings",children:"Settings"})]})]}),e("div",{class:"flex items-center space-x-4",children:e("a",{href:"/api/docs/swagger",target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"📚 API Docs"})})]})})}),e("main",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t})]})}function G({href:t,children:r}){return e("a",{href:t,onClick:n=>{n.preventDefault(),ft(t)},class:Jt("inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium","hover:border-gray-300 hover:text-gray-700","border-transparent text-gray-500 cursor-pointer"),children:r})}class Zt{constructor(r){re(this,"config");this.config=r}async request(r,n={}){const s=r.startsWith("http")?r:`${this.config.baseUrl}${r}`,i={credentials:this.config.credentials,...n,headers:{...this.config.defaultHeaders,...n.headers}},a=new AbortController;let o;this.config.timeout&&(o=setTimeout(()=>a.abort(),this.config.timeout),i.signal=a.signal);try{const c=await fetch(s,i);if(o&&clearTimeout(o),c.status===401){const g={message:"Authentication required",status:401,code:"UNAUTHORIZED"};return this.config.onAuthError&&this.config.onAuthError(),{success:!1,error:g.message,status:c.status}}let l,m;const b=c.headers.get("content-type");if(b!=null&&b.includes("application/json"))try{const g=await c.json();c.ok?l=g:m=g.error||g.message||`HTTP ${c.status}: ${c.statusText}`}catch(g){m=`Failed to parse JSON response: ${g instanceof Error?g.message:"Unknown error"}`}else c.ok||(m=`HTTP ${c.status}: ${c.statusText}`);const d={success:c.ok,status:c.status,data:l,error:m};if(!c.ok&&this.config.onError){const g={message:m||"Unknown error",status:c.status,details:l};this.config.onError(g)}return d}catch(c){o&&clearTimeout(o);const l=c instanceof Error?c.message:"Network error",m={message:l,details:c};return this.config.onError&&this.config.onError(m),{success:!1,error:l,status:0}}}async get(r,n){return this.request(r,{...n,method:"GET"})}async post(r,n,s){const i={...s,method:"POST"};return n!==void 0&&(i.body=JSON.stringify(n)),this.request(r,i)}async put(r,n,s){const i={...s,method:"PUT"};return n!==void 0&&(i.body=JSON.stringify(n)),this.request(r,i)}async patch(r,n,s){const i={...s,method:"PATCH"};return n!==void 0&&(i.body=JSON.stringify(n)),this.request(r,i)}async delete(r,n){return this.request(r,{...n,method:"DELETE"})}}function Ue(t={}){const r={baseUrl:window.location.origin,credentials:"include",defaultHeaders:{"Content-Type":"application/json"},timeout:3e4,onAuthError:()=>{window.location.pathname!=="/auth/login"&&(window.location.href="/auth/login")}};return new Zt({...r,...t})}Ue();const H=Ue(),Xt={async health(){const t=await H.get("/api/health");if(!t.success)throw new Error(t.error||"Failed to fetch health status");return t.data},async getItems(){const t=await H.get("/api/items");if(!t.success)throw new Error(t.error||"Failed to fetch items");return t.data},async createItem(t){const r=await H.post("/api/items",t);if(!r.success)throw new Error(r.error||"Failed to create item");return r.data},async updateItem(t,r){const n=await H.put(`/api/items/${t}`,r);if(!n.success)throw new Error(n.error||"Failed to update item");return n.data},async deleteItem(t){const r=await H.delete(`/api/items/${t}`);if(!r.success)throw new Error(r.error||"Failed to delete item");return r.data},async getOAuthProviders(){const t=await H.get("/api/admin/oauth/providers");if(!t.success){let r=t.error||"Failed to fetch OAuth providers";throw t.status===401&&(r="Admin authentication required. Please log in to access OAuth settings."),new Error(r)}return t.data},async getOAuthProvider(t){const r=await H.get(`/api/admin/oauth/providers/${t}`);if(!r.success)throw new Error(r.error||"Failed to fetch OAuth provider");return r.data},async updateOAuthProvider(t,r){const n=await H.put(`/api/admin/oauth/providers/${t}`,r);if(!n.success)throw new Error(n.error||"Failed to update OAuth provider");return n.data},async toggleOAuthProvider(t,r){const n=await H.patch(`/api/admin/oauth/providers/${t}/toggle`,{is_enabled:r});if(!n.success)throw new Error(n.error||"Failed to toggle OAuth provider");return n.data},async deleteOAuthProvider(t){const r=await H.delete(`/api/admin/oauth/providers/${t}`);if(!r.success)throw new Error(r.error||"Failed to delete OAuth provider");return r.data},async getSupportedProviders(){const t=await H.get("/api/admin/oauth/supported-providers");if(!t.success){let r=t.error||"Failed to fetch supported providers";throw t.status===401&&(r="Admin authentication required. Please log in to access OAuth settings."),new Error(r)}return t.data}},D=Ue(),Yt={async getTables(){const t=await D.get("/api/tables");if(!t.success)throw new Error(t.error||"Failed to fetch tables");return t.data},async getTableSchema(t){const r=await D.get(`/api/tables/${t}/schema`);if(!r.success)throw new Error(r.error||"Failed to fetch table schema");return r.data},async getTableData(t,r=100,n=0){const s=await D.get(`/api/tables/${t}/data?limit=${r}&offset=${n}`);if(!s.success)throw new Error(s.error||"Failed to fetch table data");return s.data},async createTable(t,r){const n=await D.post("/api/tables",{name:t,columns:r});if(!n.success)throw new Error(n.error||"Failed to create table");return n.data},async dropTable(t){const r=await D.delete(`/api/tables/${t}`);if(!r.success)throw new Error(r.error||"Failed to drop table");return r.data},async executeSQL(t,r=[]){const n=await D.post("/api/tables/query",{sql:t,params:r});if(!n.success)throw new Error(n.error||"Failed to execute SQL");return n.data},async addColumn(t,r){const n=await D.post(`/api/tables/${t}/columns`,r);if(!n.success)throw new Error(n.error||"Failed to add column");return n.data},async renameColumn(t,r,n){const s=await D.put(`/api/tables/${t}/columns/${r}`,{oldName:r,newName:n});if(!s.success)throw new Error(s.error||"Failed to rename column");return s.data},async dropColumn(t,r){const n=await D.delete(`/api/tables/${t}/columns/${r}`);if(!n.success)throw new Error(n.error||"Failed to drop column");return n.data},async modifyColumn(t,r,n){const s=await D.patch(`/api/tables/${t}/columns/${r}`,n);if(!s.success)throw new Error(s.error||"Failed to modify column");return s.data},async validateColumnChanges(t,r,n){const s=await D.post(`/api/tables/${t}/columns/${r}/validate`,n);if(!s.success)throw new Error(s.error||"Failed to validate column changes");return s.data},async insertRecord(t,r){const n=await D.post(`/api/tables/${t}/data`,r);if(!n.success)throw new Error(n.error||"Failed to create record");return n.data},async updateRecord(t,r,n){const s=await D.put(`/api/data/${t}/${r}`,n);if(!s.success)throw new Error(s.error||"Failed to update record");return s.data},async deleteRecord(t,r){const n=await D.delete(`/api/tables/${t}/data/${r.id}`);if(!n.success)throw new Error(n.error||"Failed to delete record");return n.data},async getSnapshots(t=20,r=0){const n=await D.get(`/api/snapshots?limit=${t}&offset=${r}`);if(!n.success)throw new Error(n.error||"Failed to fetch snapshots");return n.data},async getSnapshot(t){const r=await D.get(`/api/snapshots/${t}`);if(!r.success)throw new Error(r.error||"Failed to fetch snapshot");return r.data},async createSnapshot(t){const r=await D.post("/api/snapshots",t);if(!r.success)throw new Error(r.error||"Failed to create snapshot");return r.data},async restoreSnapshot(t){const r=await D.post(`/api/snapshots/${t}/restore`);if(!r.success)throw new Error(r.error||"Failed to restore snapshot");return r.data},async deleteSnapshot(t){const r=await D.delete(`/api/snapshots/${t}`);if(!r.success)throw new Error(r.error||"Failed to delete snapshot");return r.data},async compareSnapshots(t,r){const n=await D.get(`/api/snapshots/compare/${t}/${r}`);if(!n.success)throw new Error(n.error||"Failed to compare snapshots");return n.data},async getTableIndexes(t){const r=await D.get(`/api/tables/${t}/indexes`);if(!r.success)throw new Error(r.error||"Failed to fetch table indexes");return r.data},async getAllIndexes(){const t=await D.get("/api/tables/indexes");if(!t.success)throw new Error(t.error||"Failed to fetch all indexes");return t.data},async createIndex(t,r){const n=await D.post(`/api/tables/${t}/indexes`,r);if(!n.success)throw new Error(n.error||"Failed to create index");return n.data},async dropIndex(t,r){const n=await D.delete(`/api/tables/${t}/indexes/${r}`);if(!n.success)throw new Error(n.error||"Failed to drop index");return n.data},async getTablePolicy(t){const r=await D.get(`/api/tables/${t}/policy`);if(!r.success)throw new Error(r.error||"Failed to get table policy");return r.data},async updateTablePolicy(t,r){const n=await D.put(`/api/tables/${t}/policy`,{access_policy:r});if(!n.success)throw new Error(n.error||"Failed to update table policy");return n.data}},L={...Xt,...Yt},Ie=["admins","sessions","schema_snapshots","schema_snapshot_counter","d1_migrations","api_keys","user_sessions","oauth_providers","app_settings","table_policies","hooks","event_queue","realtime_subscriptions","custom_queries","custom_query_logs","push_subscriptions","notification_rules","notification_templates","notification_logs"],er=t=>t?t.length>8?`${t.substring(0,4)}...`:t:"-",xt=t=>t.filter(r=>!Ie.includes(r.name)),tr=(t,r)=>{const n=r.filter(s=>s.trim()!=="").join("_");return`idx_${t}_${n}`.toLowerCase()},rr=async t=>{try{return await navigator.clipboard.writeText(t),!0}catch{try{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.focus(),n.select();const s=document.execCommand("copy");return document.body.removeChild(n),s}catch(n){return console.error("Failed to copy to clipboard:",n),!1}}},nr=t=>{try{if(t.endsWith("Z")||/[+-]\d{2}:\d{2}$/.test(t)){const n=new Date(t);if(!Number.isNaN(n.getTime()))return n.toISOString()}if(/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}$/.test(t)){const n=`${t.replace(" ","T")}Z`,s=new Date(n);if(!Number.isNaN(s.getTime()))return s.toISOString()}const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toISOString()}catch{return t}},W=t=>{try{const r=nr(t),n=new Date(r);return Number.isNaN(n.getTime())?t:new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}).format(n)}catch{return t}},Ge=t=>typeof t!="string"?!1:/^[a-f0-9]{8}[a-f0-9]{4}[a-f0-9]{4}[a-f0-9]{4}[a-f0-9]{12}$/i.test(t)||/^[a-f0-9]{8,}$/i.test(t)||t.length>=6&&/^[a-zA-Z0-9_-]+$/.test(t),sr=t=>!t||typeof t!="string"||t.length>63||Ie.includes(t)?!1:/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t),ar=t=>!t||typeof t!="string"||t.length>63?!1:/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t),vt=()=>["TEXT","INTEGER","REAL","BLOB","NUMERIC","DATE","DATETIME","TIMESTAMP","BOOLEAN","VARCHAR(255)","CHAR(50)"];function ir({supportedProvider:t,configuredProvider:r,onUpdate:n}){const[s,i]=k(!1),[a,o]=k(!1),[c,l]=k({client_id:(r==null?void 0:r.client_id)||"",client_secret:(r==null?void 0:r.client_secret)||"",is_enabled:(r==null?void 0:r.is_enabled)||!1,scopes:(r==null?void 0:r.scopes)||t.default_scopes}),[m,b]=k(!1),[d,g]=k(null),x=!!r,u=(r==null?void 0:r.is_enabled)||!1,h=async()=>{if(!c.client_id||!c.client_secret){g("Client ID and Client Secret are required");return}o(!0),g(null);try{await L.updateOAuthProvider(t.provider,c),i(!1),n()}catch(w){g(w instanceof Error?w.message:"Failed to save provider")}finally{o(!1)}},p=async()=>{if(x){o(!0),g(null);try{await L.toggleOAuthProvider(t.provider,!u),n()}catch(w){g(w instanceof Error?w.message:"Failed to toggle provider")}finally{o(!1)}}},v=async()=>{if(!(!x||!confirm(`Are you sure you want to delete the ${t.name} OAuth configuration?`))){o(!0),g(null);try{await L.deleteOAuthProvider(t.provider),n()}catch(w){g(w instanceof Error?w.message:"Failed to delete provider")}finally{o(!1)}}};return e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("div",{class:"flex items-start justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("div",{class:"w-8 h-8 flex items-center justify-center",children:(w=>({google:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Google logo",children:[e("title",{children:"Google logo"}),e("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),github:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"GitHub logo",children:[e("title",{children:"GitHub logo"}),e("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})]}),facebook:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#1877F2","aria-label":"Facebook logo",children:[e("title",{children:"Facebook logo"}),e("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})]}),linkedin:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#0A66C2","aria-label":"LinkedIn logo",children:[e("title",{children:"LinkedIn logo"}),e("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})]}),twitter:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Twitter/X logo",children:[e("title",{children:"Twitter/X logo"}),e("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})]}),apple:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Apple logo",children:[e("title",{children:"Apple logo"}),e("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})]}),microsoft:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Microsoft logo",children:[e("title",{children:"Microsoft logo"}),e("path",{d:"M0 0h11.377v11.372H0z",fill:"#F25022"}),e("path",{d:"M12.623 0H24v11.372H12.623z",fill:"#7FBA00"}),e("path",{d:"M0 12.628h11.377V24H0z",fill:"#00A4EF"}),e("path",{d:"M12.623 12.628H24V24H12.623z",fill:"#FFB900"})]}),discord:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#5865F2","aria-label":"Discord logo",children:[e("title",{children:"Discord logo"}),e("path",{d:"M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419-.0190 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9460 2.4189-2.1568 2.4189Z"})]}),slack:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-label":"Slack logo",children:[e("title",{children:"Slack logo"}),e("path",{d:"M5.042 15.165a2.528 2.528 0 01-2.52 2.523A2.528 2.528 0 010 15.165a2.527 2.527 0 012.522-2.52h2.52v2.52z",fill:"#E01E5A"}),e("path",{d:"M6.313 15.165a2.527 2.527 0 012.521-2.52 2.527 2.527 0 012.521 2.52v6.313A2.528 2.528 0 018.834 24a2.528 2.528 0 01-2.521-2.522v-6.313z",fill:"#E01E5A"}),e("path",{d:"M8.834 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 018.834 0a2.528 2.528 0 012.521 2.522v2.52H8.834z",fill:"#36C5F0"}),e("path",{d:"M8.834 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521H2.522A2.528 2.528 0 010 8.834a2.528 2.528 0 012.522-2.521h6.312z",fill:"#36C5F0"}),e("path",{d:"M18.956 8.834a2.528 2.528 0 012.521-2.521A2.528 2.528 0 0124 8.834a2.528 2.528 0 01-2.523 2.521h-2.521V8.834z",fill:"#2EB67D"}),e("path",{d:"M17.688 8.834a2.528 2.528 0 01-2.523 2.521 2.527 2.527 0 01-2.52-2.521V2.522A2.527 2.527 0 0115.165 0a2.528 2.528 0 012.523 2.522v6.312z",fill:"#2EB67D"}),e("path",{d:"M15.165 18.956a2.528 2.528 0 012.523 2.521A2.528 2.528 0 0115.165 24a2.527 2.527 0 01-2.52-2.523v-2.521h2.52z",fill:"#ECB22E"}),e("path",{d:"M15.165 17.688a2.527 2.527 0 01-2.52-2.523 2.526 2.526 0 012.52-2.52h6.313A2.527 2.527 0 0124 15.165a2.528 2.528 0 01-2.522 2.523h-6.313z",fill:"#ECB22E"})]})})[w]||e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor","aria-label":"Default provider logo",children:[e("title",{children:"Default provider logo"}),e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})]}))(t.provider)}),e("div",{children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:t.name}),e("div",{class:"flex items-center gap-2 mt-1",children:[e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x?u?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:x?u?"Enabled":"Disabled":"Not Configured"}),t.note&&e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.note})]})]})]}),e("div",{class:"flex items-center gap-2",children:[x&&e("button",{type:"button",onClick:p,disabled:a,class:`px-3 py-1 text-sm rounded-md font-medium transition-colors ${u?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"} disabled:opacity-50`,children:u?"Disable":"Enable"}),e("button",{type:"button",onClick:()=>i(!s),disabled:a,class:"px-3 py-1 text-sm rounded-md font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors disabled:opacity-50",children:s?"Cancel":x?"Edit":"Configure"})]})]}),d&&e("div",{class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:d})}),s?e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"client_id",class:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),e("input",{id:"client_id",type:"text",value:c.client_id,onInput:w=>l({...c,client_id:w.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client ID"})]}),e("div",{children:[e("label",{htmlFor:"client_secret",class:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),e("div",{class:"relative",children:[e("input",{id:"client_secret",type:m?"text":"password",value:c.client_secret,onInput:w=>l({...c,client_secret:w.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client Secret"}),e("button",{type:"button",onClick:()=>b(!m),class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:m?"👁️":"👁️‍🗨️"})]})]}),e("div",{children:[e("div",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{class:"flex flex-wrap gap-2",children:c.scopes.map(w=>e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:w},w))})]}),e("div",{class:"flex items-center gap-3 pt-4",children:[e("button",{type:"button",onClick:h,disabled:a,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Saving...":"Save Configuration"}),x&&e("button",{type:"button",onClick:v,disabled:a,class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]}):e("div",{class:"space-y-3",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Setup Instructions:"}),e("p",{class:"mt-1",children:t.setup_instructions})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"OAuth Callback URL for Provider:"}),e("br",{}),e("code",{class:"px-2 py-1 bg-gray-100 rounded text-xs",children:[window.location.origin,"/api/auth/callback/",t.provider]}),e("p",{class:"mt-1 text-xs text-gray-500",children:"Use this URL when configuring your OAuth application with the provider. After authentication, users will be redirected to your app based on the callback URLs you configure in your application settings."})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Default Scopes:"}),e("div",{class:"flex flex-wrap gap-1 mt-1",children:t.default_scopes.map(w=>e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:w},w))})]}),x&&e("div",{class:"pt-2 border-t border-gray-100",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Status:"})," Configured and ",u?"enabled":"disabled"]}),r&&e("div",{class:"text-sm text-gray-600 mt-1",children:[e("strong",{children:"Last updated:"})," ",W(r.updated_at)]})]})]})]})}function lr(){const[t,r]=k([]),[n,s]=k(""),[i,a]=k(!0),[o,c]=k(!1),[l,m]=k(null),b=async()=>{try{a(!0),m(null);const h=await fetch("/api/app-settings",{credentials:"include"});if(!h.ok)throw new Error("Failed to load app settings");const v=(await h.json()).settings.find(y=>y.key==="callback_urls");r(v?JSON.parse(v.value):[])}catch(h){console.error("Failed to load callback URLs:",h),m(h instanceof Error?h.message:"Failed to load callback URLs")}finally{a(!1)}},d=async h=>{try{if(c(!0),m(null),!(await fetch("/api/app-settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({callback_urls:JSON.stringify(h)})})).ok)throw new Error("Failed to save callback URLs");r(h)}catch(p){console.error("Failed to save callback URLs:",p),m(p instanceof Error?p.message:"Failed to save callback URLs")}finally{c(!1)}},g=async()=>{if(!n.trim())return;const h=[...t,n.trim()];await d(h),s("")},x=async h=>{const p=t.filter((v,y)=>y!==h);await d(p)},u=h=>{h.key==="Enter"&&(h.preventDefault(),g())};return K(()=>{b()},[]),i?e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading callback URLs..."})}):e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"Allowed Callback URLs"}),e("p",{class:"text-gray-600 mt-2",children:"Configure URLs where users can be redirected after OAuth authentication. Supports web URLs (https://), mobile deep links (myapp://), and localhost for development."})]}),l&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:l})}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:"Add Callback URL"}),e("div",{class:"flex gap-3",children:[e("input",{type:"text",value:n,onInput:h=>{const p=h.target;s(p.value)},onKeyPress:u,placeholder:"https://myapp.com/auth/callback or myapp://auth/callback",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e("button",{type:"button",onClick:g,disabled:!n.trim()||o,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Adding...":"Add URL"})]})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:["Configured URLs (",t.length,")"]}),t.length===0?e("div",{class:"text-center py-8 text-gray-500",children:[e("p",{class:"mb-2",children:"No callback URLs configured"}),e("p",{class:"text-sm",children:"When no URLs are configured, any callback URL will be allowed (for backward compatibility)"})]}):e("div",{class:"space-y-3",children:t.map((h,p)=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex-1",children:[e("code",{class:"text-sm text-gray-800",children:h}),e("div",{class:"text-xs text-gray-500 mt-1",children:h.startsWith("https://")?"🌐 Web App":h.startsWith("http://localhost")||h.startsWith("http://127.0.0.1")?"🔧 Development":h.includes("://")?"📱 Mobile/Desktop App":"❓ Unknown"})]}),e("button",{type:"button",onClick:()=>x(p),disabled:o,class:"ml-3 text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50",children:"Remove"})]},`callback-url-${p}-${h}`))})]}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-blue-900 mb-3",children:"URL Format Examples"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:[e("strong",{children:"Web Applications:"})," ",e("code",{children:"https://myapp.com/auth/callback"})]}),e("p",{children:[e("strong",{children:"Mobile Apps:"})," ",e("code",{children:"myapp://auth/callback"})," or"," ",e("code",{children:"com.example.myapp://callback"})]}),e("p",{children:[e("strong",{children:"Desktop Apps:"})," ",e("code",{children:"myapp://localhost/callback"})]}),e("p",{children:[e("strong",{children:"Development:"})," ",e("code",{children:"http://localhost:3000/callback"})," or"," ",e("code",{children:"http://127.0.0.1:8080/auth"})]})]})]}),e("div",{class:"mt-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-gray-900 mb-3",children:"API Usage"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("p",{children:e("strong",{children:"Login with callback:"})}),e("code",{class:"block bg-white p-2 rounded border",children:"GET /api/auth/login/google?callback_url=https://myapp.com/auth/callback"}),e("p",{class:"mt-3",children:e("strong",{children:"The callback response includes:"})}),e("code",{class:"block bg-white p-2 rounded border text-xs",children:JSON.stringify({success:!0,access_token:"...",refresh_token:"...",user:{id:"...",email:"...",name:"..."},return_url:"https://myapp.com/auth/callback"},null,2)})]})]})]})}function or(){const[t,r]=k("providers"),[n,s]=k([]),[i,a]=k([]),[o,c]=k(!0),[l,m]=k(null),b=async()=>{c(!0),m(null);try{const[u,h]=await Promise.all([L.getSupportedProviders(),L.getOAuthProviders()]);s(u.supported_providers),a(h.providers)}catch(u){m(u instanceof Error?u.message:"Failed to load OAuth providers"),console.error("Error loading OAuth providers:",u)}finally{c(!1)}};K(()=>{b()},[]);const d=u=>i.find(h=>h.provider===u),g=i.filter(u=>u.is_enabled).length,x=i.length;return o?e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading OAuth providers..."})})]}):e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{type:"button",onClick:()=>r("providers"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="providers"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"OAuth Providers"}),e("button",{type:"button",onClick:()=>r("callback-urls"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="callback-urls"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Callback URLs"})]})}),e("div",{class:"flex-1 min-w-0",children:[t==="providers"&&e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"OAuth Providers"}),e("p",{class:"text-gray-600 mt-2",children:"Configure OAuth providers to enable user authentication in your applications"})]}),l&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-sm text-red-600",children:l}),l.includes("authentication required")?e("div",{class:"mt-3",children:[e("p",{class:"text-sm text-red-700 mb-2",children:"You need to log in as an administrator to manage OAuth settings."}),e("a",{href:"/",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Go to Dashboard"})]}):e("button",{type:"button",onClick:b,class:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]}),e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-gray-900",children:n.length}),e("div",{class:"text-sm text-gray-600",children:"Supported Providers"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-blue-600",children:x}),e("div",{class:"text-sm text-gray-600",children:"Configured"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-green-600",children:g}),e("div",{class:"text-sm text-gray-600",children:"Enabled"})]})]}),e("div",{class:"space-y-6",children:n.map(u=>e(ir,{supportedProvider:u,configuredProvider:d(u.provider),onUpdate:b},u.provider))}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-blue-900 mb-3",children:"Getting Started"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:["1. ",e("strong",{children:"Choose a provider:"}),' Click "Configure" on any OAuth provider you want to enable']}),e("p",{children:["2. ",e("strong",{children:"Create OAuth app:"})," Follow the setup instructions to create an OAuth application"]}),e("p",{children:["3. ",e("strong",{children:"Configure credentials:"})," Enter your Client ID and Client Secret"]}),e("p",{children:["4. ",e("strong",{children:"Enable provider:"}),' Toggle the provider to "Enabled" status']}),e("p",{children:["5. ",e("strong",{children:"Test authentication:"})," Users can now authenticate with this provider"]})]})]}),e("div",{class:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900 mb-3",children:"Authentication Endpoints"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("div",{children:[e("strong",{children:"Available providers:"})," ",e("code",{children:"GET /api/auth/providers"})]}),e("div",{children:[e("strong",{children:"Start authentication:"})," ",e("code",{children:["GET /api/auth/login/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"OAuth callback:"})," ",e("code",{children:["GET /api/auth/callback/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"Get user info:"})," ",e("code",{children:"GET /api/auth/me"})]}),e("div",{children:[e("strong",{children:"Refresh token:"})," ",e("code",{children:"POST /api/auth/refresh"})]}),e("div",{children:[e("strong",{children:"Logout:"})," ",e("code",{children:"POST /api/auth/logout"})]})]})]})]}),t==="callback-urls"&&e(lr,{})]})]})]})}const Ze=t=>{if(!t.trim())return Date.now().toString(36).slice(-8).padStart(8,"0");let r=t.length+1e3;for(let i=0;i<t.length;i++){const a=t.charCodeAt(i);r=r*31+a,r=r&2147483647}let n="",s=r;for(let i=0;i<8;i++){s=s*1664525+1013904223&2147483647;const a=s%36;n+=a.toString(36)}return n},cr=t=>{const r=/:(\w+)/g,n=new Set;let s;for(s=r.exec(t);s!==null;)n.add(s[1]),s=r.exec(t);return Array.from(n).map(i=>({name:i,type:"string",required:!0,description:""}))},be=t=>{const r=t.trim().toLowerCase(),n=r.startsWith("select"),s=r.includes("pragma");return{method:n?"GET":"POST",readonly:n||s}},dr=t=>{const r={};if(t.name.trim()||(r.name="クエリ名は必須です"),t.slug.trim()?/^[a-z0-9_-]+$/.test(t.slug)||(r.slug="スラッグは小文字の英数字、ハイフン、アンダースコアのみ使用できます"):r.slug="スラッグは必須です",!t.sql_query.trim())r.sql_query="SQLクエリは必須です";else{const n=/:(\w+)/g,s=new Set;let i;for(i=n.exec(t.sql_query);i!==null;)s.add(i[1]),i=n.exec(t.sql_query);const a=new Set(t.parameters.map(c=>c.name)),o=Array.from(s).filter(c=>!a.has(c));o.length>0&&(r.sql_query=`SQLに未定義のパラメーターが含まれています: ${o.join(", ")}`)}return t.parameters.forEach((n,s)=>{n.name.trim()?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n.name)||(r[`parameter_${s}_name`]="パラメーター名は英文字またはアンダースコアで始まり、英数字とアンダースコアのみ使用できます"):r[`parameter_${s}_name`]="パラメーター名は必須です"}),r};function ur({isCreating:t,isEditing:r,formData:n,validationErrors:s,error:i,onFormDataChange:a,onValidationErrorsChange:o,onCreate:c,onUpdate:l,onClose:m}){if(!t&&!r)return null;const b=()=>{a({...n,parameters:[...n.parameters,{name:"",type:"string",required:!1}]})},d=u=>{a({...n,parameters:n.parameters.filter((h,p)=>p!==u)})},g=(u,h)=>{if(a({...n,parameters:n.parameters.map((p,v)=>v===u?{...p,...h}:p)}),h.name!==void 0){const p=`parameter_${u}_name`;if(s[p]){const v={...s};delete v[p],o(v)}}},x=u=>{if(s[u]){const h={...s};delete h[u],o(h)}};return e("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:t?"Create Custom Query":"Edit Custom Query"}),i&&e("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:i}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"query-name",className:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{id:"query-name",type:"text",value:n.name,onChange:u=>{const h=u.target.value;a({...n,name:h,slug:t?Ze(h):n.slug}),x("name"),t&&x("slug")},className:`mt-1 w-full px-3 py-2 border rounded-md ${s.name?"border-red-500 bg-red-50":"border-gray-300"}`}),s.name&&e("p",{className:"mt-1 text-sm text-red-600",children:s.name})]}),e("div",{children:[e("div",{className:"flex justify-between items-center",children:[e("label",{htmlFor:"query-slug",className:"block text-sm font-medium text-gray-700",children:["Slug",e("span",{className:"text-xs text-gray-500",children:"(auto-generated, but editable)"})]}),e("button",{type:"button",onClick:()=>{a({...n,slug:Ze(n.name)}),x("slug")},className:"text-xs text-indigo-600 hover:text-indigo-800",children:"Re-generate from name"})]}),e("input",{id:"query-slug",type:"text",value:n.slug,onChange:u=>{a({...n,slug:u.target.value}),x("slug")},placeholder:"lowercase-with-hyphens",className:`mt-1 w-full px-3 py-2 border rounded-md ${s.slug?"border-red-500 bg-red-50":"border-gray-300"}`}),s.slug&&e("p",{className:"mt-1 text-sm text-red-600",children:s.slug}),e("p",{className:"mt-1 text-sm text-gray-500",children:["This will be the API endpoint: /api/custom/",n.slug||"a1b2c3d4"]})]}),e("div",{children:[e("label",{htmlFor:"query-description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e("input",{id:"query-description",type:"text",value:n.description,onChange:u=>a({...n,description:u.target.value}),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:[e("label",{htmlFor:"query-sql",className:"block text-sm font-medium text-gray-700",children:"SQL Query"}),e("textarea",{id:"query-sql",value:n.sql_query,onChange:u=>{const h=u.target.value,p=cr(h),v=new Set(n.parameters.map(w=>w.name)),y=[...n.parameters.filter(w=>h.includes(`:${w.name}`)),...p.filter(w=>!v.has(w.name))];a({...n,sql_query:h,parameters:y}),x("sql_query")},rows:6,placeholder:"SELECT * FROM users WHERE created_at > :start_date",className:`mt-1 w-full px-3 py-2 border rounded-md font-mono text-sm ${s.sql_query?"border-red-500 bg-red-50":"border-gray-300"}`}),s.sql_query&&e("p",{className:"mt-1 text-sm text-red-600",children:s.sql_query}),e("div",{className:"mt-2 flex justify-between items-center",children:[e("p",{className:"text-sm text-gray-500",children:"Use :parameter_name for parameters (will be auto-detected)"}),n.sql_query&&e("div",{className:"flex gap-2",children:[e("span",{className:`px-2 py-1 rounded text-xs ${be(n.sql_query).method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:be(n.sql_query).method}),be(n.sql_query).readonly&&e("span",{className:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-800",children:"Read-only"})]})]})]}),e("div",{children:[e("div",{className:"flex justify-between items-center mb-2",children:[e("div",{className:"block text-sm font-medium text-gray-700",children:["Parameters",n.parameters.length>0&&e("span",{className:"text-xs text-gray-500 ml-1",children:["(",n.parameters.length," detected)"]})]}),e("button",{type:"button",onClick:b,className:"text-sm text-indigo-600 hover:text-indigo-800",children:"Add Parameter"})]}),n.parameters.length===0?e("div",{className:"text-sm text-gray-500 bg-gray-50 p-3 rounded border-2 border-dashed border-gray-200",children:"No parameters detected. Use :param_name in your SQL query to automatically add parameters here."}):n.parameters.map((u,h)=>e("div",{className:"mb-3",children:[e("div",{className:"flex gap-2 mb-1",children:[e("input",{id:`param-name-${h}`,type:"text",value:u.name,onChange:p=>g(h,{name:p.target.value}),placeholder:"param_name",className:`flex-1 px-3 py-1 border rounded-md text-sm ${s[`parameter_${h}_name`]?"border-red-500 bg-red-50":"border-gray-300"}`}),e("select",{id:`param-type-${h}`,value:u.type,onChange:p=>g(h,{type:p.target.value}),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e("option",{value:"string",children:"String"}),e("option",{value:"number",children:"Number"}),e("option",{value:"boolean",children:"Boolean"}),e("option",{value:"date",children:"Date"})]}),e("label",{htmlFor:`param-required-${h}`,className:"flex items-center",children:[e("input",{id:`param-required-${h}`,type:"checkbox",checked:u.required,onChange:p=>g(h,{required:p.target.checked}),className:"mr-1"}),e("span",{className:"text-sm",children:"Required"})]}),e("button",{type:"button",onClick:()=>d(h),className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),s[`parameter_${h}_name`]&&e("p",{className:"text-xs text-red-600 ml-1",children:s[`parameter_${h}_name`]})]},`param-${u.name}-${h}`))]}),e("div",{children:[e("label",{htmlFor:"query-cache-ttl",className:"block text-sm font-medium text-gray-700",children:"Cache TTL (seconds)"}),e("input",{id:"query-cache-ttl",type:"number",value:n.cache_ttl,onChange:u=>a({...n,cache_ttl:parseInt(u.target.value)||0}),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:e("label",{htmlFor:"query-enabled",className:"flex items-center",children:[e("input",{id:"query-enabled",type:"checkbox",checked:n.enabled,onChange:u=>a({...n,enabled:u.target.checked}),className:"mr-2"}),e("span",{className:"text-sm font-medium text-gray-700",children:"Enabled"})]})})]}),e("div",{className:"flex justify-end gap-2 mt-6",children:[e("button",{type:"button",onClick:m,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"button",onClick:t?c:l,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:t?"Create":"Update"})]})]})})}function mr({queries:t,selectedQuery:r,onSelectQuery:n,onEditClick:s,onDeleteClick:i,onToggleEnabled:a,onCreateClick:o}){return e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Queries"}),e("button",{type:"button",onClick:o,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Create Query"})]}),e("div",{className:"space-y-2",children:t.length===0?e("p",{className:"text-gray-500",children:"No custom queries yet"}):t.map(c=>e("button",{type:"button",className:`text-left w-full p-3 border rounded hover:bg-gray-50 ${(r==null?void 0:r.id)===c.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>{const l={...c,parameters:typeof c.parameters=="string"?JSON.parse(c.parameters||"[]"):c.parameters||[]};n(l)},children:e("div",{className:"flex justify-between items-start",children:[e("div",{children:[e("h4",{className:"font-medium text-gray-900",children:c.name}),e("p",{className:"text-sm text-gray-500",children:["/",c.slug]}),e("div",{className:"flex gap-2 mt-1",children:[e("span",{className:`text-xs px-2 py-1 rounded ${c.method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:c.method}),e("span",{className:`text-xs px-2 py-1 rounded ${c.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.enabled?"Enabled":"Disabled"}),c.is_readonly&&e("span",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-800",children:"Read-only"})]})]}),e("div",{className:"flex gap-2",children:[e("button",{type:"button",onClick:l=>{l.stopPropagation(),a(c.id,!c.enabled)},className:c.enabled?"text-orange-600 hover:text-orange-800":"text-green-600 hover:text-green-800",children:c.enabled?"Disable":"Enable"}),e("button",{type:"button",onClick:l=>{l.stopPropagation(),s(c)},className:"text-indigo-600 hover:text-indigo-800",children:"Edit"}),e("button",{type:"button",onClick:l=>{l.stopPropagation(),i(c.id)},className:"text-red-600 hover:text-red-800",children:"Delete"})]})]})},c.id))})]})}function hr({selectedQuery:t,testParams:r,testResult:n,testError:s,testing:i,onTestParamsChange:a,onTest:o}){if(!t)return e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Query Details"}),e("p",{className:"text-gray-500 mt-4",children:"Select a query to view details and test"})]});const c=(l,m,b)=>{let d=m;b==="number"?d=m===""?void 0:Number(m):b==="boolean"?d=m==="true":b==="date"&&(d=m===""?void 0:m),a({...r,[l]:d})};return e("div",{className:"bg-white shadow rounded-lg p-6",children:e("div",{className:"space-y-4",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),t.description&&e("p",{className:"text-gray-600 mt-1",children:t.description}),e("p",{className:"text-sm text-gray-500 mt-2",children:["Endpoint:"," ",e("code",{className:"bg-gray-100 px-1 py-0.5 rounded",children:[t.method," /api/custom/",t.slug]})]})]}),e("div",{children:[e("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"SQL Query"}),e("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-x-auto",children:t.sql_query})]}),t.parameters&&t.parameters.length>0&&e("div",{children:[e("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Test Parameters"}),e("div",{className:"space-y-3",children:t.parameters.map(l=>e("div",{children:[e("label",{htmlFor:`param-${l.name}`,className:"block text-sm font-medium text-gray-700",children:[l.name,l.required&&e("span",{className:"text-red-500 ml-1",children:"*"}),e("span",{className:"text-gray-500 ml-1",children:["(",l.type,")"]})]}),l.description&&e("p",{className:"text-xs text-gray-500 mt-1",children:l.description}),l.type==="boolean"?e("select",{id:`param-${l.name}`,value:String(r[l.name]??""),onChange:m=>c(l.name,m.target.value,l.type),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",children:[e("option",{value:"",children:"Select..."}),e("option",{value:"true",children:"true"}),e("option",{value:"false",children:"false"})]}):e("input",{id:`param-${l.name}`,type:l.type==="number"?"number":l.type==="date"?"date":"text",value:String(r[l.name]??""),onChange:m=>c(l.name,m.target.value,l.type),placeholder:l.default?`Default: ${l.default}`:"",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"})]},l.name))})]}),e("button",{type:"button",onClick:o,disabled:i,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:i?"Testing...":"Test Query"}),s&&e("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:[e("h4",{className:"font-medium",children:"Test Error"}),e("p",{className:"mt-1",children:s})]}),n&&e("div",{className:"bg-green-50 border border-green-200 rounded p-4",children:[e("h4",{className:"font-medium text-green-800 mb-2",children:"Test Results"}),e("div",{className:"text-sm text-green-700 space-y-1",children:[e("p",{children:["Rows returned: ",n.row_count]}),e("p",{children:["Execution time: ",n.execution_time,"ms"]})]}),n.data&&n.data.length>0&&e("div",{className:"mt-3",children:[e("h5",{className:"font-medium text-green-800 mb-2",children:"Sample Data (first 5 rows)"}),e("div",{className:"bg-white rounded border overflow-x-auto",children:e("table",{className:"min-w-full text-sm",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:Object.keys(n.data[0]).map(l=>e("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:l},l))})}),e("tbody",{className:"divide-y divide-gray-200",children:n.data.slice(0,5).map((l,m)=>{const b=l,d=Object.values(b).join("-")||`row-${m}`;return e("tr",{children:Object.entries(b).map(([g,x])=>e("td",{className:"px-3 py-2 text-gray-900",children:String(x)},g))},d)})})]})})]})]})]})})}function pr(t){const{apiConfig:r,initialData:n=[],autoFetch:s=!0,validateFn:i,transformResponse:a=_=>_.data||[],transformItem:o=_=>_.data||_}=t,[c,l]=k({items:n,selectedItem:null,loading:!1,creating:!1,updating:!1,deleting:!1,error:null,validationErrors:{}});K(()=>{s&&b()},[s]);const m=async(_,C={})=>{const N={credentials:"include",headers:{"Content-Type":"application/json",...C.headers},...C},$=await fetch(_,N);if(!$.ok){const f=await $.json().catch(()=>({}));throw new Error(f.error||f.message||`HTTP ${$.status}`)}return $},b=async()=>{l(_=>({..._,loading:!0,error:null}));try{const C=await(await m(r.listEndpoint)).json(),N=a(C);l($=>({...$,items:N,loading:!1}))}catch(_){const C=_ instanceof Error?_.message:"Failed to fetch items";l(N=>({...N,error:C,loading:!1}))}};return{...c,fetchItems:b,createItem:async _=>{if(l(C=>({...C,error:null,validationErrors:{}})),i){const C=i(_);if(Object.keys(C).length>0)return l(N=>({...N,validationErrors:C})),null}l(C=>({...C,creating:!0}));try{const N=await(await m(r.createEndpoint,{method:"POST",body:JSON.stringify(_)})).json(),$=o(N);return l(f=>({...f,items:[...f.items,$],creating:!1})),$}catch(C){const N=C instanceof Error?C.message:"Failed to create item";return l($=>({...$,error:N,creating:!1})),null}},updateItem:async(_,C)=>{if(l(N=>({...N,error:null,validationErrors:{}})),i){const N=i(C);if(Object.keys(N).length>0)return l($=>({...$,validationErrors:N})),null}l(N=>({...N,updating:!0}));try{const $=await(await m(r.updateEndpoint(_),{method:"PUT",body:JSON.stringify(C)})).json(),f=o($);return l(T=>{var U;return{...T,items:T.items.map(E=>E.id===_?f:E),selectedItem:((U=T.selectedItem)==null?void 0:U.id)===_?f:T.selectedItem,updating:!1}}),f}catch(N){const $=N instanceof Error?N.message:"Failed to update item";return l(f=>({...f,error:$,updating:!1})),null}},deleteItem:async _=>{l(C=>({...C,deleting:!0,error:null}));try{return await m(r.deleteEndpoint(_),{method:"DELETE"}),l(C=>{var N;return{...C,items:C.items.filter($=>$.id!==_),selectedItem:((N=C.selectedItem)==null?void 0:N.id)===_?null:C.selectedItem,deleting:!1}}),!0}catch(C){const N=C instanceof Error?C.message:"Failed to delete item";return l($=>({...$,error:N,deleting:!1})),!1}},setSelectedItem:_=>{l(C=>({...C,selectedItem:_}))},setError:_=>{l(C=>({...C,error:_}))},clearValidationErrors:()=>{l(_=>({..._,validationErrors:{}}))},setValidationErrors:_=>{l(C=>({...C,validationErrors:_}))},refreshData:async()=>{await b()},getItemById:_=>c.items.find(C=>C.id===_)}}const fr={baseUrl:window.location.origin,listEndpoint:"/api/custom-queries",getEndpoint:t=>`/api/custom-queries/${t}`,createEndpoint:"/api/custom-queries",updateEndpoint:t=>`/api/custom-queries/${t}`,deleteEndpoint:t=>`/api/custom-queries/${t}`};function gr(){const t=pr({apiConfig:fr,validateFn:N=>{const $={slug:N.slug||"",name:N.name||"",description:N.description||"",sql_query:N.sql_query||"",parameters:N.parameters||[],cache_ttl:N.cache_ttl||0,enabled:N.enabled??!0};return dr($)},transformResponse:N=>N.queries||[]}),[r,n]=k(!1),[s,i]=k(!1),[a,o]=k({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),[c,l]=k({}),[m,b]=k(null),[d,g]=k(null),[x,u]=k(!1),h=async()=>{try{await t.createItem(a)&&_()}finally{n(!1)}},p=async()=>{if(t.selectedItem)try{await t.updateItem(t.selectedItem.id,a)&&(t.setSelectedItem(null),_())}finally{i(!1)}},v=async N=>{var f;if(!confirm("Are you sure you want to delete this query?"))return;await t.deleteItem(N)&&((f=t.selectedItem)==null?void 0:f.id)===N&&t.setSelectedItem(null)},y=async()=>{if(t.selectedItem){u(!0),b(null),g(null);try{const N=await fetch(`/api/custom-queries/${t.selectedItem.id}/test`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({parameters:c})});if(!N.ok){const f=await N.json().catch(()=>({error:"Failed to test query"}));throw new Error(f.error||"Failed to test query")}const $=await N.json();b($)}catch(N){g(N instanceof Error?N.message:"Failed to test query")}finally{u(!1)}}},w=async(N,$)=>{try{if(!(await fetch(`/api/custom-queries/${N}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({enabled:$})})).ok)throw new Error("Failed to toggle query");await t.refreshData()}catch(f){t.setError(f instanceof Error?f.message:"Failed to toggle query")}},_=()=>{o({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),t.clearValidationErrors()},C=N=>{o({slug:N.slug,name:N.name,description:N.description||"",sql_query:N.sql_query,parameters:N.parameters,cache_ttl:N.cache_ttl,enabled:N.enabled}),t.clearValidationErrors()};return{queries:t.items,selectedQuery:t.selectedItem,loading:t.loading,error:t.error,validationErrors:t.validationErrors,isCreating:r,isEditing:s,formData:a,testParams:c,testResult:m,testError:d,testing:x,setSelectedQuery:t.setSelectedItem,setError:t.setError,setValidationErrors:t.setValidationErrors,setIsCreating:n,setIsEditing:i,setFormData:o,setTestParams:l,setTestResult:b,setTestError:g,fetchQueries:t.refreshData,handleCreate:h,handleUpdate:p,handleDelete:v,handleTest:y,handleToggleEnabled:w,resetForm:_,loadQueryToForm:C}}function br(){const{queries:t,selectedQuery:r,isCreating:n,isEditing:s,loading:i,error:a,validationErrors:o,formData:c,testParams:l,testResult:m,testError:b,testing:d,setSelectedQuery:g,setIsCreating:x,setIsEditing:u,setError:h,setFormData:p,setTestParams:v,setTestResult:y,setTestError:w,setValidationErrors:_,handleCreate:C,handleUpdate:N,handleDelete:$,handleTest:f,handleToggleEnabled:T,resetForm:U,loadQueryToForm:E}=gr(),P=F=>{g(F),v({}),y(null),w(null)},M=F=>{g(F),E(F),u(!0)},A=()=>{U(),x(!0)},S=()=>{x(!1),u(!1),U(),h(null)};return i?e("div",{className:"flex items-center justify-center h-screen",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):e("div",{className:"min-h-screen bg-gray-50 py-6",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e("div",{className:"mb-6",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Custom SQL Queries"}),e("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage custom SQL queries with secure parameter handling and caching"})]}),a&&!n&&!s&&e("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:a}),e("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e(mr,{queries:t,selectedQuery:r,onSelectQuery:P,onEditClick:M,onDeleteClick:$,onToggleEnabled:T,onCreateClick:A}),e(hr,{selectedQuery:r,testParams:l,testResult:m,testError:b,testing:d,onTestParamsChange:v,onTest:f})]}),e(ur,{isCreating:n,isEditing:s,formData:c,validationErrors:o,error:a,onFormDataChange:p,onValidationErrorsChange:_,onCreate:C,onUpdate:N,onClose:S})]})})}const De=()=>{const[t,r]=k({loading:!1,error:null}),n=u=>{r(h=>({...h,loading:u}))},s=u=>{r(h=>({...h,error:u}))},i=()=>{r(u=>({...u,error:null}))},a=u=>u.trim()?sr(u)?null:"Invalid table name format. Use letters, numbers, and underscores only.":"Table name is required",o=u=>u.trim()?ar(u)?null:"Invalid column name format. Use letters, numbers, and underscores only.":"Column name is required";return{...t,createTable:async u=>{n(!0),s(null);try{const h=a(u.name);if(h)return s(h),n(!1),!1;const p=u.columns.filter(_=>_.name.trim()!=="");if(p.length===0)return s("At least one column is required"),n(!1),!1;const v=p.map(_=>_.name.toLowerCase()),y=v.filter((_,C)=>v.indexOf(_)!==C);if(y.length>0)return s(`Duplicate column names: ${y.join(", ")}`),n(!1),!1;for(const _ of p){const C=o(_.name);if(C)return s(`Column "${_.name}": ${C}`),n(!1),!1}const w=p.map(_=>({name:_.name,type:_.type,constraints:_.notNull?"NOT NULL":void 0,foreignKey:_.foreignKey.enabled?{table:_.foreignKey.table,column:_.foreignKey.column}:void 0}));await L.createTable(u.name,w);for(const _ of u.indexes)if(_.columns.length>0&&_.name.trim()!=="")try{await L.createIndex(u.name,{name:_.name,columns:_.columns,unique:_.unique})}catch(C){console.warn(`Failed to create index ${_.name}:`,C)}return n(!1),!0}catch(h){const p=h instanceof Error?h.message:"Failed to create table";return s(p),n(!1),!1}},dropTable:async u=>{n(!0),s(null);try{return await L.dropTable(u),n(!1),!0}catch(h){const p=h instanceof Error?h.message:"Failed to drop table";return s(p),n(!1),!1}},changeAccessPolicy:async(u,h)=>{n(!0),s(null);try{return await L.updateTablePolicy(u,h),n(!1),!0}catch(p){const v=p instanceof Error?p.message:"Failed to change access policy";return s(v),n(!1),!1}},createRecord:async(u,h)=>{n(!0),s(null);try{const p=Object.entries(h).reduce((v,[y,w])=>(w!==""&&w!==null&&w!==void 0&&(v[y]=w),v),{});return await L.insertRecord(u,p),n(!1),!0}catch(p){const v=p instanceof Error?p.message:"Failed to create record";return s(v),n(!1),!1}},updateRecord:async(u,h,p)=>{n(!0),s(null);try{return await L.updateRecord(u,h,p),n(!1),!0}catch(v){const y=v instanceof Error?v.message:"Failed to update record";return s(y),n(!1),!1}},deleteRecord:async(u,h)=>{n(!0),s(null);try{return await L.deleteRecord(u,{id:h}),n(!1),!0}catch(p){const v=p instanceof Error?p.message:"Failed to delete record";return s(v),n(!1),!1}},addColumn:async(u,h)=>{n(!0),s(null);try{const p=o(h.name);if(p)return s(p),n(!1),!1;const v={name:h.name,type:h.type,constraints:h.notNull?"NOT NULL":void 0,foreignKey:h.foreignKey.enabled?{table:h.foreignKey.table,column:h.foreignKey.column}:void 0};return await L.addColumn(u,v),n(!1),!0}catch(p){const v=p instanceof Error?p.message:"Failed to add column";return s(v),n(!1),!1}},validateTableName:a,validateColumnName:o,clearError:i}};function yr({tableName:t,tableData:r,tableColumns:n,onDataChange:s,loading:i}){const[a,o]=k(!1),[c,l]=k({}),[m,b]=k(null),[d,g]=k(null),[x,u]=k(null),h=It(!1),{createRecord:p,updateRecord:v,deleteRecord:y,loading:w,error:_,clearError:C}=De(),N=async A=>{A.preventDefault(),C(),await p(t,c)&&(l({}),o(!1),s())},$=async A=>{if(!confirm("Are you sure you want to delete this record? This action cannot be undone."))return;await y(t,A)&&s()},f=(A,S,F)=>{if(["id","created_at","updated_at"].includes(S))return;const q=n.find(R=>R.name===S);if(q&&Ge(F)||!q){const R=r.find(J=>J.id===A);R&&g({id:A,data:{...R}})}else h.current=!1,b({rowId:A,columnName:S,value:F})},T=async(A,S,F)=>{console.log("Cell save:",{rowId:A,columnName:S,newValue:F}),C(),await v(t,A,{[S]:F})&&(b(null),s())},U=()=>{b(null)},E=async()=>{if(!d)return;console.log("Record save:",d),C();const A={...d.data};delete A.id,delete A.created_at,delete A.updated_at,await v(t,d.id,A)&&(g(null),s())},P=async(A,S,F)=>{await rr(A)&&(u(`${S}-${F}`),setTimeout(()=>u(null),2e3))},M=async(A,S)=>{console.log("Jump to record:",{id:A,columnName:S})};return t?e("div",{className:"bg-white rounded-lg shadow-sm border",children:[e("div",{className:"p-6 border-b",children:[e("div",{className:"flex justify-between items-center",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:[t," Data"]}),e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors",disabled:i||w,children:"Add Record"})]}),_&&e("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:_}),e("button",{type:"button",onClick:C,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]})]}),i?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):r.length===0?e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"No records found"})}):e("div",{className:"overflow-x-auto",children:e("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:[n.map(A=>e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:A.name},A.name)),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:r.map((A,S)=>e("tr",{className:"hover:bg-gray-50",children:[n.map(F=>{const q=A[F.name],te=`${S}-${F.name}`,R=(m==null?void 0:m.rowId)===A.id&&(m==null?void 0:m.columnName)===F.name,J=x===te,de=["id","created_at","updated_at"].includes(F.name);return e("td",{className:`px-4 py-3 text-sm relative ${de?"text-gray-500":"text-gray-900"} ${de?"":"cursor-pointer hover:bg-blue-50"}`,onClick:()=>!R&&f(A.id,F.name,q),onKeyDown:B=>{(B.key==="Enter"||B.key===" ")&&!R&&f(A.id,F.name,q)},tabIndex:de?-1:0,role:de?void 0:"button",children:R?e("input",{type:"text",value:m.value,onChange:B=>b(Le=>Le?{...Le,value:B.currentTarget.value}:null),onKeyDown:B=>{B.key==="Enter"?T(A.id,F.name,m.value):B.key==="Escape"&&U()},onBlur:()=>T(A.id,F.name,m.value),className:"w-full px-2 py-1 border border-blue-500 rounded focus:outline-none"}):e("div",{className:"flex items-center gap-2",children:[e("span",{children:F.name==="id"?er(q):["created_at","updated_at"].includes(F.name)?W(q):q===null?"NULL":q===""?"(empty)":String(q)}),(F.name==="id"||Ge(q))&&e("div",{className:"flex gap-1",children:[e("button",{type:"button",onClick:B=>{B.stopPropagation(),P(q,S,F.name)},className:`p-1 rounded text-xs ${J?"bg-green-100 text-green-600":"hover:bg-gray-100 text-gray-400"}`,title:"Copy to clipboard",children:J?"✓":"📋"}),F.name!=="id"&&e("button",{type:"button",onClick:B=>{B.stopPropagation(),M(q,F.name)},className:"p-1 hover:bg-gray-100 text-gray-400 rounded text-xs",title:"Jump to related record",children:"🔗"})]})]})},F.name)}),e("td",{className:"px-4 py-3 text-sm",children:e("button",{type:"button",onClick:()=>$(A.id),className:"text-red-600 hover:text-red-800 text-sm",disabled:w,children:"Delete"})})]},A.id))})]})}),a&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Add New Record"}),e("form",{onSubmit:N,className:"space-y-4",children:[n.filter(A=>!["id","created_at","updated_at"].includes(A.name)).map(A=>e("div",{children:[e("label",{htmlFor:`new-${A.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:[A.name,A.notnull===1&&e("span",{className:"text-red-500",children:"*"})]}),e("input",{id:`new-${A.name}`,type:"text",value:c[A.name]||"",onChange:S=>l(F=>({...F,[A.name]:S.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`Enter ${A.name}`,required:A.notnull===1})]},A.name)),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{o(!1),l({}),C()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:w,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50",disabled:w,children:w?"Creating...":"Create Record"})]})]})]})}),d&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Edit Record"}),e("div",{className:"space-y-4",children:[n.map(A=>e("div",{children:[e("label",{htmlFor:`edit-${A.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:[A.name,["id","created_at","updated_at"].includes(A.name)&&e("span",{className:"text-gray-500 text-xs ml-1",children:"(read-only)"})]}),e("input",{id:`edit-${A.name}`,type:"text",value:d.data[A.name]||"",onChange:S=>g(F=>F?{...F,data:{...F.data,[A.name]:S.currentTarget.value}}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:["id","created_at","updated_at"].includes(A.name)})]},A.name)),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>g(null),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"button",onClick:E,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Save Changes"})]})]})]})})]}):e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table to view its data"})})})}function xr({tableName:t,tableColumns:r,tableForeignKeys:n,tables:s,onSchemaChange:i,loading:a}){const[o,c]=k(!1),[l,m]=k(!1),[b,d]=k({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),[g,x]=k({name:"",columns:[""],unique:!1}),[u]=k([]),{addColumn:h,validateColumnName:p,loading:v,error:y,clearError:w}=De(),_=async f=>{if(f.preventDefault(),!t)return;w(),await h(t,b)&&(d({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),c(!1),i())},C=async f=>{if(f.preventDefault(),!!t)try{const T=g.columns.filter(U=>U.trim()!=="");if(T.length===0){alert("At least one column is required for the index");return}console.log("Create index:",{tableName:t,name:g.name,columns:T,unique:g.unique}),x({name:"",columns:[""],unique:!1}),m(!1),i()}catch(T){console.error("Failed to create index:",T)}},N=async f=>{if(t&&confirm(`Are you sure you want to drop the index "${f}"? This action cannot be undone.`))try{console.log("Drop index:",f),i()}catch(T){console.error("Failed to drop index:",T)}};if(!t)return e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table to view its schema"})})});const $=xt(s);return e("div",{className:"space-y-6",children:[e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:[t," Schema"]}),e("div",{className:"flex gap-2",children:[e("button",{type:"button",onClick:()=>c(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",disabled:a||v,children:"Add Column"}),e("button",{type:"button",onClick:()=>m(!0),className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition-colors",disabled:a||v,children:"Manage Indexes"})]})]}),y&&e("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:y}),e("button",{type:"button",onClick:w,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]}),a?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e("div",{className:"space-y-6",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Columns"}),e("div",{className:"overflow-x-auto",children:e("table",{className:"w-full border border-gray-200 rounded-md",children:[e("thead",{className:"bg-gray-50",children:e("tr",{children:[e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Name"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Type"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Constraints"}),e("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Default"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:r.map(f=>e("tr",{className:"hover:bg-gray-50",children:[e("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:[f.name,f.pk===1&&e("span",{className:"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"PK"})]}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.type}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.notnull===1&&e("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded mr-1",children:"NOT NULL"})}),e("td",{className:"px-4 py-2 text-sm text-gray-600",children:f.dflt_value||"-"})]},f.name))})]})})]}),n.length>0&&e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Foreign Keys"}),e("div",{className:"space-y-2",children:n.map((f,T)=>e("div",{className:"p-3 bg-gray-50 rounded-md",children:[e("span",{className:"font-medium",children:f.from}),e("span",{className:"text-gray-500 mx-2",children:"→"}),e("span",{className:"text-blue-600",children:[f.table,".",f.to]})]},`${f.from}-${f.table}-${f.to}-${T}`))})]}),e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Indexes"}),u.length===0?e("p",{className:"text-gray-500 italic",children:"No custom indexes created."}):e("div",{className:"space-y-2",children:u.map(f=>{var T;return e("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{children:[e("span",{className:"font-medium",children:f.name}),e("span",{className:"text-gray-500 ml-2",children:["(",(T=f.columns)==null?void 0:T.join(", "),")"]}),f.unique&&e("span",{className:"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded",children:"UNIQUE"})]}),e("button",{type:"button",onClick:()=>N(f.name),className:"text-red-600 hover:text-red-800 text-sm",disabled:v,children:"Drop"})]},f.name)})})]})]})]}),o&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Add New Column"}),e("form",{onSubmit:_,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"column-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Column Name"}),e("input",{id:"column-name",type:"text",value:b.name,onChange:f=>d(T=>({...T,name:f.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter column name",required:!0}),b.name&&p(b.name)&&e("p",{className:"text-red-600 text-sm mt-1",children:p(b.name)})]}),e("div",{children:[e("label",{htmlFor:"column-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Type"}),e("select",{id:"column-type",value:b.type,onChange:f=>d(T=>({...T,type:f.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:vt().map(f=>e("option",{value:f,children:f},f))})]}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:b.notNull,onChange:f=>d(T=>({...T,notNull:f.currentTarget.checked})),className:"mr-2"}),"NOT NULL"]})}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:b.foreignKey.enabled,onChange:f=>d(T=>({...T,foreignKey:{...T.foreignKey,enabled:f.currentTarget.checked}})),className:"mr-2"}),"Foreign Key Reference"]})}),b.foreignKey.enabled&&e("div",{className:"space-y-3 ml-6",children:[e("div",{children:[e("label",{htmlFor:"reference-table",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Table"}),e("select",{id:"reference-table",value:b.foreignKey.table,onChange:f=>d(T=>({...T,foreignKey:{...T.foreignKey,table:f.currentTarget.value,column:""}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"Select table"}),$.map(f=>e("option",{value:f.name,children:f.name},f.name))]})]}),e("div",{children:[e("label",{htmlFor:"reference-column",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference Column"}),e("input",{id:"reference-column",type:"text",value:b.foreignKey.column,onChange:f=>d(T=>({...T,foreignKey:{...T.foreignKey,column:f.currentTarget.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Usually 'id'"})]})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{c(!1),w()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:v,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",disabled:v,children:v?"Adding...":"Add Column"})]})]})]})}),l&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create Index"}),e("form",{onSubmit:C,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"index-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Index Name"}),e("input",{id:"index-name",type:"text",value:g.name,onChange:f=>x(T=>({...T,name:f.currentTarget.value})),onFocus:()=>{if(!g.name&&t){const f=g.columns.filter(T=>T.trim()!=="");f.length>0&&x(T=>({...T,name:tr(t,f)}))}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter index name",required:!0})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{className:"space-y-2",children:g.columns.map((f,T)=>e("div",{className:"flex gap-2",children:[e("select",{value:f,onChange:U=>{const E=[...g.columns];E[T]=U.currentTarget.value,x(P=>({...P,columns:E}))},className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"Select column"}),r.map(U=>e("option",{value:U.name,children:U.name},U.name))]}),g.columns.length>1&&e("button",{type:"button",onClick:()=>{const U=g.columns.filter((E,P)=>P!==T);x(E=>({...E,columns:U}))},className:"p-2 text-red-600 hover:text-red-800",children:e("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Remove column from index"}),e("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]},`column-${T}-${f||"empty"}`))}),e("button",{type:"button",onClick:()=>x(f=>({...f,columns:[...f.columns,""]})),className:"mt-2 text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Column"})]}),e("div",{children:e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:g.unique,onChange:f=>x(T=>({...T,unique:f.currentTarget.checked})),className:"mr-2"}),"Unique Index"]})}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600",children:"Create Index"})]})]})]})})]})}function vr({tables:t,selectedTable:r,onTableSelect:n,onTablesChange:s,loading:i}){const[a,o]=k(!1),[c,l]=k({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),[m,b]=k(null),{createTable:d,dropTable:g,changeAccessPolicy:x,validateTableName:u,validateColumnName:h,loading:p,error:v,clearError:y}=De(),w=async E=>{E.preventDefault(),y(),await d(c)&&(l({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),o(!1),s())},_=async E=>{if(!confirm(`Are you sure you want to drop table "${E}"? This action cannot be undone.`))return;await g(E)&&(r===E&&n(null),s()),b(null)},C=async(E,P)=>{await x(E,P)&&s(),b(null)},N=()=>{l(E=>({...E,columns:[...E.columns,{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}]}))},$=E=>{l(P=>({...P,columns:P.columns.filter((M,A)=>A!==E)}))},f=(E,P,M)=>{l(A=>({...A,columns:A.columns.map((S,F)=>F===E?{...S,[P]:M}:S)}))},T=xt(t),U=t.filter(E=>Ie.includes(E.name));return e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h2",{className:"text-xl font-semibold text-gray-900",children:"Tables"}),e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",disabled:i||p,children:"Create Table"})]}),v&&e("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e("p",{className:"text-red-700 text-sm",children:v}),e("button",{type:"button",onClick:y,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]}),i?e("div",{className:"flex items-center justify-center py-8",children:e("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e("div",{className:"space-y-6",children:[e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"User Tables"}),T.length===0?e("p",{className:"text-gray-500 italic",children:"No user tables created yet."}):e("div",{className:"grid gap-2",children:T.map(E=>e("div",{className:`p-3 border rounded-md cursor-pointer transition-colors relative ${r===E.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e("div",{className:"flex items-center justify-between",children:[e("button",{type:"button",onClick:()=>n(E.name),className:"flex-1 text-left",children:[e("div",{className:"flex items-center gap-2",children:[e("span",{className:"font-medium",children:E.name}),e("span",{className:`px-2 py-1 text-xs rounded-full ${E.access_policy==="public"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:E.access_policy||"public"})]}),e("p",{className:"text-sm text-gray-500",children:[E.rowCount," rows"]})]}),e("div",{className:"relative",children:[e("button",{type:"button",onClick:P=>{P.stopPropagation(),b(m===E.name?null:E.name)},className:"p-1 hover:bg-gray-100 rounded",children:e("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Table options menu"}),e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})]})}),m===E.name&&e("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:[e("button",{type:"button",onClick:()=>C(E.name,E.access_policy==="public"?"private":"public"),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50",disabled:p,children:["Make ",E.access_policy==="public"?"Private":"Public"]}),e("button",{type:"button",onClick:()=>_(E.name),className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-50",disabled:p,children:"Drop Table"})]})]})]})},E.name))})]}),e("div",{children:[e("h3",{className:"text-lg font-medium text-gray-500 mb-3",children:"System Tables"}),e("div",{className:"grid gap-2",children:U.map(E=>e("button",{type:"button",onClick:()=>n(E.name),className:`p-3 border rounded-md cursor-pointer transition-colors text-left w-full ${r===E.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e("div",{className:"flex items-center justify-between",children:[e("span",{className:"font-medium text-gray-700",children:E.name}),e("span",{className:"text-sm text-gray-500",children:[E.rowCount," rows"]})]})},E.name))})]})]}),a&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create New Table"}),e("form",{onSubmit:w,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"table-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Name"}),e("input",{id:"table-name",type:"text",value:c.name,onChange:E=>l(P=>({...P,name:E.currentTarget.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter table name",required:!0}),c.name&&u(c.name)&&e("p",{className:"text-red-600 text-sm mt-1",children:u(c.name)})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{className:"space-y-3",children:c.columns.map((E,P)=>e("div",{className:"border border-gray-200 rounded-md p-3",children:e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e("div",{children:[e("input",{type:"text",placeholder:"Column name",value:E.name,onChange:M=>f(P,"name",M.currentTarget.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),E.name&&h(E.name)&&e("p",{className:"text-red-600 text-xs mt-1",children:h(E.name)})]}),e("div",{children:e("select",{value:E.type,onChange:M=>f(P,"type",M.currentTarget.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:vt().map(M=>e("option",{value:M,children:M},M))})}),e("div",{className:"flex items-center gap-2",children:[e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:E.notNull,onChange:M=>f(P,"notNull",M.currentTarget.checked),className:"mr-1"}),"NOT NULL"]}),c.columns.length>1&&e("button",{type:"button",onClick:()=>$(P),className:"p-1 text-red-600 hover:text-red-800",children:e("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e("title",{children:"Remove column"}),e("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})]})})]})]})},`column-${E.name||P}`))}),e("button",{type:"button",onClick:N,className:"mt-3 px-3 py-2 text-blue-600 hover:text-blue-800 text-sm",children:"+ Add Column"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{o(!1),y()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50",disabled:p,children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",disabled:p,children:p?"Creating...":"Create Table"})]})]})]})})]})}function ye({size:t="sm"}){return e("svg",{class:`animate-spin ${t==="sm"?"h-4 w-4":"h-6 w-6"} text-white`,fill:"none",viewBox:"0 0 24 24","aria-label":"Loading spinner",children:[e("title",{children:"Loading spinner"}),e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}function wr({onClose:t,onRestore:r}){const[n,s]=k([]),[i,a]=k(null),[o,c]=k(!0),[l,m]=k(null),[b,d]=k(!1),[g,x]=k({name:"",description:""}),[u,h]=k(null),[p,v]=k(null),[y,w]=k(null),[_,C]=k(!1),[N,$]=k(!1),[f,T]=k(!1);K(()=>{U()},[]),K(()=>{const S=F=>{if(y){const q=F.target;!q.closest("[data-menu-container]")&&!q.closest("[data-menu-button]")&&w(null)}};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[y]);const U=async()=>{try{c(!0),m(null);const S=await L.getSnapshots();s(S.snapshots)}catch(S){m(S instanceof Error?S.message:"Failed to load data")}finally{c(!1)}},E=async S=>{S.preventDefault();try{m(null),C(!0),await L.createSnapshot(g),d(!1),x({name:"",description:""}),await U()}catch(F){m(F instanceof Error?F.message:"Failed to create snapshot")}finally{C(!1)}},P=async()=>{if(u)try{m(null),$(!0),await L.restoreSnapshot(u),h(null),r&&r(),t()}catch(S){m(S instanceof Error?S.message:"Failed to restore"),h(null)}finally{$(!1)}},M=async()=>{if(p)try{m(null),T(!0),await L.deleteSnapshot(p),v(null),w(null),await U()}catch(S){m(S instanceof Error?S.message:"Failed to delete snapshot"),v(null)}finally{T(!1)}},A=S=>{const F=new Date(S),te=new Date().getTime()-F.getTime(),R=Math.floor(te/(1e3*60*60*24)),J=Math.floor(te%(1e3*60*60*24)/(1e3*60*60));return R>0?`${R} day${R>1?"s":""} ago`:J>0?`${J} hour${J>1?"s":""} ago`:"Just now"};return e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e("div",{class:"px-6 py-4 border-b flex items-center justify-between",children:[e("h2",{class:"text-xl font-semibold text-gray-900",children:"Schema Snapshots"}),e("button",{type:"button",onClick:t,class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Close",children:[e("title",{children:"Close"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})]})})]}),l&&e("div",{class:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:e("div",{class:"text-sm text-red-700",children:l})}),e("div",{class:"mx-6 mt-4 bg-blue-50 border border-blue-200 rounded-md p-4",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20","aria-label":"Information",children:[e("title",{children:"Information"}),e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]})}),e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-blue-800",children:"💡 CloudflareのTime Travel機能について"}),e("p",{class:"mt-1 text-sm text-blue-700",children:["Cloudflareの管理画面から、D1データベースを過去の任意の時点（無料プランで7日間、有料プランで30日間）に復元できるTime Travel機能が利用可能です。 詳しくは",e("a",{href:"https://developers.cloudflare.com/d1/reference/time-travel/",target:"_blank",rel:"noopener noreferrer",class:"font-medium underline hover:no-underline",children:"Cloudflare D1 Time Travelドキュメント"}),"をご確認ください。"]})]})]})}),e("div",{class:"flex-1 overflow-auto p-6",children:o?e("div",{class:"text-center py-8",children:e("div",{class:"text-gray-500",children:"Loading..."})}):e("div",{children:[!b&&e("div",{class:"mb-6",children:e("button",{type:"button",onClick:()=>d(!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Plus",children:[e("title",{children:"Plus"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})]}),"Create Snapshot"]})}),b&&e("div",{class:"mb-6 bg-gray-50 rounded-lg p-4",children:[e("h3",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Snapshot"}),e("form",{onSubmit:E,children:e("div",{class:"space-y-3",children:[e("div",{children:[e("label",{htmlFor:"snapshot_name",class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{id:"snapshot_name",type:"text",value:g.name,onInput:S=>x({...g,name:S.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., Before major refactoring"})]}),e("div",{children:[e("label",{htmlFor:"snapshot_description",class:"block text-sm font-medium text-gray-700",children:"Description"}),e("textarea",{id:"snapshot_description",value:g.description,onInput:S=>x({...g,description:S.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",rows:2,placeholder:"Optional description of current state"})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",disabled:_,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${_?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:[_&&e(ye,{size:"sm"}),e("span",{children:_?"Creating...":"Create"})]}),e("button",{type:"button",onClick:()=>{d(!1),x({name:"",description:""})},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})})]}),e("div",{class:"space-y-3",children:n.length===0?e("div",{class:"text-center py-8 text-gray-500",children:"No snapshots yet. Create your first snapshot to start tracking schema changes."}):n.map(S=>e("button",{type:"button",class:`text-left w-full border rounded-lg p-4 hover:shadow-md transition-shadow ${(i==null?void 0:i.id)===S.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>a(S),children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-3",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:S.name||`Snapshot v${S.version}`}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S.snapshotType==="manual"?"bg-blue-100 text-blue-800":S.snapshotType==="auto"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:S.snapshotType})]}),S.description&&e("p",{class:"mt-1 text-sm text-gray-600",children:S.description}),e("div",{class:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e("span",{children:["Version ",S.version]}),e("span",{children:W(S.createdAt)}),e("span",{children:A(S.createdAt)})]})]}),e("div",{class:"ml-4 flex items-center space-x-2",children:[e("button",{type:"button",onClick:F=>{F.stopPropagation(),h(S.id)},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Restore"}),e("div",{class:"relative",children:[e("button",{type:"button",onClick:F=>{F.stopPropagation(),w(y===S.id?null:S.id)},"data-menu-button":"true",class:"inline-flex items-center p-1.5 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-md",children:e("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20","aria-label":"More options",children:[e("title",{children:"More options"}),e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})]})}),y===S.id&&e("div",{class:"absolute right-0 top-full mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10","data-menu-container":"true",children:e("div",{class:"py-1",children:e("button",{type:"button",onClick:F=>{F.preventDefault(),F.stopPropagation(),w(null),v(S.id)},class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 focus:outline-none",children:e("div",{class:"flex items-center space-x-2",children:[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Delete",children:[e("title",{children:"Delete"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})]}),e("span",{children:"Delete"})]})})})})]})]})]})},S.id))})]})}),u&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Warning",children:[e("title",{children:"Warning"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})]})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Confirm Restore"})})]}),e("div",{class:"mb-6",children:[e("p",{class:"text-sm text-gray-700",children:"This will restore your database schema to the selected snapshot. All current tables and data will be replaced."}),e("p",{class:"text-sm text-red-600 mt-2 font-medium",children:"This action cannot be undone. Make sure you have a backup of your current data."})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"button",onClick:P,disabled:N,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${N?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[N&&e(ye,{size:"sm"}),e("span",{children:N?"Restoring...":"Restore"})]}),e("button",{type:"button",onClick:()=>h(null),disabled:N,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${N?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})}),p&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-label":"Warning",children:[e("title",{children:"Warning"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})]})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Delete Snapshot"})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:"Are you sure you want to delete this snapshot? This action cannot be undone."})}),e("div",{class:"flex space-x-3",children:[e("button",{type:"button",onClick:M,disabled:f,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${f?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[f&&e(ye,{size:"sm"}),e("span",{children:f?"Deleting...":"Delete"})]}),e("button",{type:"button",onClick:()=>v(null),disabled:f,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${f?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})})]})})}const _r=()=>{const[t,r]=k({tables:[],selectedTable:null,tableData:[],tableColumns:[],tableForeignKeys:[],loading:!1,error:null}),n=async()=>{r(b=>({...b,loading:!0,error:null}));try{const b=await L.getTables();r(d=>({...d,tables:b.tables||[],loading:!1}))}catch(b){const d=b instanceof Error?b.message:"Failed to load tables";r(g=>({...g,error:d,loading:!1}))}},s=async b=>{const d=b||t.selectedTable;if(d){r(g=>({...g,loading:!0,error:null}));try{const g=await L.getTableSchema(d);r(x=>({...x,tableColumns:g.columns||[],tableForeignKeys:g.foreignKeys||[],loading:!1}))}catch(g){const x=g instanceof Error?g.message:"Failed to load table schema";r(u=>({...u,error:x,loading:!1}))}}},i=async b=>{const d=b||t.selectedTable;if(d){r(g=>({...g,loading:!0,error:null}));try{const g=await L.getTableData(d);r(x=>({...x,tableData:g.data||[],loading:!1}))}catch(g){const x=g instanceof Error?g.message:"Failed to load table data";r(u=>({...u,error:x,loading:!1}))}}},a=b=>{r(d=>({...d,selectedTable:b,tableData:[],tableColumns:[],tableForeignKeys:[]})),b&&(s(b),i(b))},o=a,c=b=>{r(d=>({...d,error:b}))},l=()=>{r(b=>({...b,error:null}))},m=async()=>{await n(),t.selectedTable&&await Promise.all([s(t.selectedTable),i(t.selectedTable)])};return K(()=>{n()},[]),{...t,loadTables:n,loadTableSchema:s,loadTableData:i,selectTable:a,setSelectedTable:o,setError:c,clearError:l,refreshData:m}};function Nr(){const[t,r]=k(!1),{tables:n,selectedTable:s,tableData:i,tableColumns:a,tableForeignKeys:o,loading:c,error:l,setSelectedTable:m,loadTables:b,loadTableData:d,loadTableSchema:g}=_r();return e("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:e("div",{className:"flex items-center justify-between",children:[e("div",{children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Database"}),e("p",{className:"mt-2 text-gray-600",children:"Manage your application's database tables and data"})]}),e("button",{type:"button",onClick:()=>r(!0),className:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition-colors",children:"Schema Snapshots"})]})}),l&&e("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{className:"text-red-700",children:l})}),e("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e("div",{className:"lg:col-span-1",children:e(vr,{tables:n,selectedTable:s,onTableSelect:v=>{m(v)},onTablesChange:()=>{b()},loading:c})}),e("div",{className:"lg:col-span-2 space-y-6",children:s?e(Y,{children:[e(yr,{tableName:s,tableData:i,tableColumns:a,onDataChange:()=>{d()},loading:c}),e(xr,{tableName:s,tableColumns:a,tableForeignKeys:o,tables:n,onSchemaChange:()=>{g(),d()},loading:c})]}):e("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e("div",{className:"text-center py-8",children:e("p",{className:"text-gray-500",children:"Select a table from the left to view and manage its data and schema"})})})})]}),t&&e(wr,{onClose:()=>r(!1),onRestore:()=>{r(!1),g(),b()}})]})})}function kr(){const[t,r]=k({userTables:0,systemTables:0,dbStatus:"checking..."});K(()=>{n()},[]);const n=async()=>{try{const s=await L.health(),i=await L.getTables(),a=i.tables.filter(c=>c.type==="user").length,o=i.tables.filter(c=>c.type==="system").length;r({userTables:a,systemTables:o,dbStatus:(s==null?void 0:s.database)==="connected"?"connected":"disconnected"})}catch(s){console.error("Failed to load stats:",s),r(i=>({...i,dbStatus:"error"}))}};return e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Dashboard"}),e("div",{class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e(xe,{title:"Database Tables",description:"User-defined tables in D1",href:"/database",stats:`${t.userTables} tables`,status:t.dbStatus}),e(xe,{title:"System Tables",description:"Protected system tables",href:"/database",stats:`${t.systemTables} tables`}),e(xe,{title:"Storage",description:"R2 object storage for files",href:"/storage",stats:"Ready",status:"connected"})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-3",children:[e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Create new table →"}),e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Browse database →"}),e("a",{href:"/storage",class:"text-indigo-600 hover:text-indigo-500 block",children:"Upload files →"}),e("a",{href:"/api/health",target:"_blank",class:"text-indigo-600 hover:text-indigo-500 block",rel:"noopener",children:"View API health →"})]})})})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"API Endpoints"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-2 text-sm",children:[e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/health"}),e("span",{class:"text-green-600",children:"Health check"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables"}),e("span",{class:"text-green-600",children:"List tables"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/tables"}),e("span",{class:"text-green-600",children:"Create table"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables/:name/data"}),e("span",{class:"text-green-600",children:"Get table data"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/storage"}),e("span",{class:"text-green-600",children:"List files"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/storage/upload"}),e("span",{class:"text-green-600",children:"Upload file"})]})]})})})]})]})}function xe({title:t,description:r,href:n,stats:s,status:i}){return e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between",children:[e("dt",{class:"text-sm font-medium text-gray-500 truncate",children:t}),i&&e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i==="connected"?"bg-green-100 text-green-800":i==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:i})]}),e("dd",{class:"mt-1 text-3xl font-semibold text-gray-900",children:s}),e("p",{class:"mt-2 text-sm text-gray-600",children:r}),e("a",{href:n,class:"mt-3 text-indigo-600 hover:text-indigo-500 text-sm font-medium inline-block",children:"Manage →"})]})})}function Cr({logs:t}){return e("div",{className:"space-y-6",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Logs"}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:t.map(r=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-start justify-between",children:e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-sm font-medium text-gray-900",children:r.title}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="sent"?"bg-green-100 text-green-800":r.status==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status})]}),e("p",{className:"text-sm text-gray-600 mt-1",children:r.body}),r.errorMessage&&e("p",{className:"text-sm text-red-600 mt-1",children:r.errorMessage}),e("div",{className:"mt-2 text-xs text-gray-500",children:["User: ",r.userId," | Provider: ",r.provider," | ",W(r.createdAt)]})]})})},r.id))}),t.length===0&&e("output",{className:"text-center py-8 text-gray-500","aria-live":"polite",children:"No notification logs available"})]})]})}function Tr({rules:t,onCreateRule:r,onEditRule:n,onToggleRule:s,onDeleteRule:i}){return e("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Rules"}),e("button",{type:"button",onClick:r,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Create Rule"})]}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:t.map(a=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-center justify-between",children:[e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-lg font-medium text-gray-900",children:a.name}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${a.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.enabled?"Enabled":"Disabled"})]}),a.description&&e("p",{className:"text-sm text-gray-600 mt-1",children:a.description}),e("div",{className:"mt-2 text-sm text-gray-500",children:[e("span",{className:"bg-gray-100 px-2 py-1 rounded mr-2",children:a.triggerType}),a.tableName&&e("span",{className:"bg-blue-100 px-2 py-1 rounded mr-2",children:a.tableName}),a.eventType&&e("span",{className:"bg-purple-100 px-2 py-1 rounded mr-2",children:a.eventType}),e("span",{className:"bg-yellow-100 px-2 py-1 rounded",children:a.recipientType})]})]}),e("div",{className:"flex space-x-2",children:[e("button",{type:"button",onClick:()=>s(a),className:`px-3 py-1 text-sm rounded-md ${a.enabled?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:a.enabled?"Disable":"Enable"}),e("button",{type:"button",onClick:()=>n(a),className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:"Edit"}),e("button",{type:"button",onClick:()=>i(a.id),className:"px-3 py-1 text-sm bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"Delete"})]})]})},a.id))}),t.length===0&&e("output",{className:"text-center py-8 text-gray-500","aria-live":"polite",children:"No notification rules configured yet"})]})]})}function Er({vapidPublicKey:t}){return e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"VAPID Configuration"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"vapid-public-key",className:"block text-sm font-medium text-gray-700 mb-2",children:"Public Key"}),e("div",{id:"vapid-public-key",className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800 break-all",children:t||"Loading..."})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use this public key in your client application for Web Push subscriptions"})]}),e("div",{children:[e("label",{htmlFor:"vapid-subject",className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),e("div",{id:"vapid-subject",className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800",children:"mailto:support@vibebase.app"})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"VAPID subject for push notification identification"})]}),e("div",{children:[e("label",{htmlFor:"api-endpoints",className:"block text-sm font-medium text-gray-700 mb-2",children:"API Endpoints"}),e("section",{id:"api-endpoints",className:"bg-gray-50 p-3 rounded-md space-y-2","aria-label":"API endpoints information",children:[e("div",{children:[e("strong",{children:"Subscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/subscribe"})]}),e("div",{children:[e("strong",{children:"Unsubscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/unsubscribe"})]}),e("div",{children:[e("strong",{children:"Send Notification:"})," ",e("code",{className:"text-sm",children:"POST /api/push/send"})]})]}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use these endpoints in your application for end-user push notification management"})]})]})]})})}function Sr({isAdminSubscribed:t,permission:r,loading:n,onAdminSubscribe:s,onAdminUnsubscribe:i,onAdminTestNotification:a}){return e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Admin Test Notifications"}),e("p",{className:"text-sm text-gray-600 mb-6",children:"Test push notifications by subscribing your browser and sending test messages"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"browser-permission",className:"block text-sm font-medium text-gray-700",children:"Browser Permission"}),e("output",{id:"browser-permission",className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r==="granted"?"bg-green-100 text-green-800":r==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,"aria-label":`Browser notification permission status: ${r||"Unknown"}`,children:r||"Unknown"})]}),e("div",{children:[e("label",{htmlFor:"admin-subscription-status",className:"block text-sm font-medium text-gray-700",children:"Admin Subscription Status"}),e("output",{id:"admin-subscription-status",className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,"aria-label":`Admin subscription status: ${t?"Subscribed":"Not Subscribed"}`,children:t?"Subscribed":"Not Subscribed"})]}),e("div",{className:"flex space-x-3",children:t?e(Y,{children:[e("button",{type:"button",onClick:i,disabled:n,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50",children:n?"Unsubscribing...":"Unsubscribe"}),e("button",{type:"button",onClick:a,disabled:n,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:n?"Sending...":"Send Test Notification"})]}):e("button",{type:"button",onClick:s,disabled:n||r==="denied",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50",children:n?"Subscribing...":"Subscribe for Testing"})}),r==="denied"&&e("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",role:"alert","aria-live":"polite",children:e("div",{className:"flex",children:e("div",{className:"ml-3",children:[e("h3",{className:"text-sm font-medium text-yellow-800",children:"Notifications Blocked"}),e("div",{className:"mt-2 text-sm text-yellow-700",children:[e("p",{children:"Browser notifications are blocked. To test push notifications, please:"}),e("ol",{className:"list-decimal list-inside mt-1",children:[e("li",{children:"Click the lock icon in your browser's address bar"}),e("li",{children:'Set notifications to "Allow"'}),e("li",{children:"Refresh this page"})]})]})]})})})]})]})})}function Ar({editingRule:t,loading:r,onSubmit:n,onClose:s,setLoading:i}){const[a,o]=k({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",triggerType:(t==null?void 0:t.triggerType)||"db_change",tableName:(t==null?void 0:t.tableName)||"",eventType:(t==null?void 0:t.eventType)||"insert",recipientType:(t==null?void 0:t.recipientType)||"all_users",recipientValue:(t==null?void 0:t.recipientValue)||"",titleTemplate:(t==null?void 0:t.titleTemplate)||"",bodyTemplate:(t==null?void 0:t.bodyTemplate)||"",iconUrl:(t==null?void 0:t.iconUrl)||"",imageUrl:(t==null?void 0:t.imageUrl)||"",clickAction:(t==null?void 0:t.clickAction)||"",priority:(t==null?void 0:t.priority)||"normal",ttl:(t==null?void 0:t.ttl)||86400,enabled:(t==null?void 0:t.enabled)??!0});return e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",role:"dialog","aria-modal":"true","aria-labelledby":"rule-form-title",children:e("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:e("div",{className:"mt-3",children:[e("h3",{id:"rule-form-title",className:"text-lg font-medium text-gray-900 mb-4",children:t?"Edit Notification Rule":"Create Notification Rule"}),e("form",{onSubmit:async l=>{l.preventDefault(),i(!0);try{const m=t?`/api/push/rules/${t.id}`:"/api/push/rules",b=t?"PUT":"POST",d={...a,iconUrl:a.iconUrl.trim()||void 0,imageUrl:a.imageUrl.trim()||void 0,clickAction:a.clickAction.trim()||void 0,description:a.description.trim()||void 0,tableName:a.triggerType==="db_change"?a.tableName:void 0,eventType:a.triggerType==="db_change"?a.eventType:void 0,recipientValue:a.recipientType!=="all_users"?a.recipientValue:void 0},g=await fetch(m,{method:b,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});if(g.ok)alert(t?"Rule updated successfully":"Rule created successfully"),await n(a);else{const x=await g.json();console.error("API Error:",x),x.details&&console.error("Validation errors:",x.details),alert(`Failed to ${t?"update":"create"} rule: ${x.error}${x.details?`

Validation errors: ${JSON.stringify(x.details,null,2)}`:""}`)}}catch(m){alert(`Error ${t?"updating":"creating"} rule: ${m}`)}finally{i(!1)}},className:"space-y-4",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{children:[e("label",{htmlFor:"rule-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e("input",{id:"rule-name",type:"text",required:!0,value:a.name,onChange:l=>o({...a,name:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e("input",{id:"rule-description",type:"text",value:a.description,onChange:l=>o({...a,description:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-trigger-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Trigger Type *"}),e("select",{id:"rule-trigger-type",value:a.triggerType,onChange:l=>o({...a,triggerType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"db_change",children:"Database Change"}),e("option",{value:"api",children:"API Trigger"})]})]}),a.triggerType==="db_change"&&e(Y,{children:[e("div",{children:[e("label",{htmlFor:"rule-table-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Name *"}),e("input",{id:"rule-table-name",type:"text",required:!0,value:a.tableName,onChange:l=>o({...a,tableName:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-event-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Event Type *"}),e("select",{id:"rule-event-type",value:a.eventType,onChange:l=>o({...a,eventType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"insert",children:"Insert"}),e("option",{value:"update",children:"Update"}),e("option",{value:"delete",children:"Delete"})]})]})]}),e("div",{children:[e("label",{htmlFor:"rule-recipient-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Recipient Type *"}),e("select",{id:"rule-recipient-type",value:a.recipientType,onChange:l=>o({...a,recipientType:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all_users",children:"All Users"}),e("option",{value:"specific_user",children:"Specific User"}),e("option",{value:"column_reference",children:"Column Reference"})]})]}),a.recipientType!=="all_users"&&e("div",{children:[e("label",{htmlFor:"rule-recipient-value",className:"block text-sm font-medium text-gray-700 mb-1",children:[a.recipientType==="specific_user"?"User ID":"Column Name"," *"]}),e("input",{id:"rule-recipient-value",type:"text",required:!0,value:a.recipientValue,onChange:l=>o({...a,recipientValue:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-title-template",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title Template *"}),e("input",{id:"rule-title-template",type:"text",required:!0,value:a.titleTemplate,onChange:l=>o({...a,titleTemplate:l.target.value}),placeholder:"e.g., New message from {{user_name}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-body-template",className:"block text-sm font-medium text-gray-700 mb-1",children:"Body Template *"}),e("input",{id:"rule-body-template",type:"text",required:!0,value:a.bodyTemplate,onChange:l=>o({...a,bodyTemplate:l.target.value}),placeholder:"e.g., {{message}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-icon-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Icon URL"}),e("input",{id:"rule-icon-url",type:"url",value:a.iconUrl,onChange:l=>o({...a,iconUrl:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-image-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),e("input",{id:"rule-image-url",type:"url",value:a.imageUrl,onChange:l=>o({...a,imageUrl:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-click-action",className:"block text-sm font-medium text-gray-700 mb-1",children:"Click Action URL"}),e("input",{id:"rule-click-action",type:"text",value:a.clickAction,onChange:l=>o({...a,clickAction:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{htmlFor:"rule-priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e("select",{id:"rule-priority",value:a.priority,onChange:l=>o({...a,priority:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"high",children:"High"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"low",children:"Low"})]})]}),e("div",{children:[e("label",{htmlFor:"rule-ttl",className:"block text-sm font-medium text-gray-700 mb-1",children:"TTL (seconds)"}),e("input",{id:"rule-ttl",type:"number",value:a.ttl,onChange:l=>o({...a,ttl:parseInt(l.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:"enabled",checked:a.enabled,onChange:l=>o({...a,enabled:l.target.checked}),className:"mr-2"}),e("label",{htmlFor:"enabled",className:"text-sm font-medium text-gray-700",children:"Enabled"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e("button",{type:"submit",disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:r?"Saving...":t?"Update Rule":"Create Rule"})]})]})]})})})}class $r{constructor(r="/api"){re(this,"apiBaseUrl");re(this,"vapidPublicKey",null);re(this,"registration",null);this.apiBaseUrl=r}async initialize(){try{return"serviceWorker"in navigator?"PushManager"in window?(this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered:",this.registration),await navigator.serviceWorker.ready,await this.fetchVapidPublicKey(),!0):(console.warn("Push messaging not supported"),!1):(console.warn("Service Workers not supported"),!1)}catch(r){return console.error("Failed to initialize push notifications:",r),!1}}async requestPermission(){try{return"Notification"in window?{granted:await Notification.requestPermission()==="granted"}:{granted:!1,error:"Notifications not supported"}}catch(r){return{granted:!1,error:r instanceof Error?r.message:"Permission request failed"}}}getPermissionStatus(){return"Notification"in window?Notification.permission:null}async subscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const a=await this.requestPermission();if(!a.granted)throw new Error(a.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),s={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")||new ArrayBuffer(0)),auth:this.arrayBufferToBase64(n.getKey("auth")||new ArrayBuffer(0))}},deviceInfo:this.getDeviceInfo()},i=await fetch(`${this.apiBaseUrl}/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!i.ok){const a=await i.json();throw new Error(a.error||"Subscription failed")}return console.log("Successfully subscribed to push notifications"),{success:!0}}catch(r){return console.error("Failed to subscribe to push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async unsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const r=await this.registration.pushManager.getSubscription();return r?(await r.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:r.endpoint})})).ok||console.warn("Failed to notify server of unsubscription"),console.log("Successfully unsubscribed from push notifications"),{success:!0}):{success:!0}}catch(r){return console.error("Failed to unsubscribe from push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async isSubscribed(){try{return this.registration?await this.registration.pushManager.getSubscription()!==null:!1}catch(r){return console.error("Failed to check subscription status:",r),!1}}async getSubscription(){try{return this.registration?await this.registration.pushManager.getSubscription():null}catch(r){return console.error("Failed to get subscription:",r),null}}async adminSubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const a=await this.requestPermission();if(!a.granted)throw new Error(a.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),s={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")||new ArrayBuffer(0)),auth:this.arrayBufferToBase64(n.getKey("auth")||new ArrayBuffer(0))}},deviceInfo:this.getDeviceInfo()},i=await fetch(`${this.apiBaseUrl}/push/admin/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!i.ok){const a=await i.json();throw new Error(a.error||"Admin subscription failed")}return console.log("Successfully subscribed admin to push notifications"),{success:!0}}catch(r){return console.error("Failed to subscribe admin to push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async adminUnsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const r=await this.registration.pushManager.getSubscription();return r?(await r.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/admin/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:r.endpoint})})).ok||console.warn("Failed to notify server of admin unsubscription"),console.log("Successfully unsubscribed admin from push notifications"),{success:!0}):{success:!0}}catch(r){return console.error("Failed to unsubscribe admin from push notifications:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async sendAdminTestNotification(){try{const r=await fetch(`${this.apiBaseUrl}/push/admin/test`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok){const n=await r.json();throw new Error(n.error||"Admin test notification failed")}return{success:!0}}catch(r){return console.error("Failed to send admin test notification:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async sendTestNotification(){try{const r=await fetch(`${this.apiBaseUrl}/push/send`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:"Test Notification",body:"This is a test notification from Vibebase",icon:"/favicon.svg",tag:"test-notification"})});if(!r.ok){const n=await r.json();throw new Error(n.error||"Test notification failed")}return{success:!0}}catch(r){return console.error("Failed to send test notification:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async fetchVapidPublicKey(){try{const r=await fetch(`${this.apiBaseUrl}/push/vapid-public-key`);if(!r.ok)throw new Error("Failed to fetch VAPID public key");const n=await r.json();this.vapidPublicKey=n.publicKey}catch(r){throw console.error("Failed to fetch VAPID public key:",r),r}}urlBase64ToUint8Array(r){const n="=".repeat((4-r.length%4)%4),s=(r+n).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),a=new Uint8Array(i.length);for(let o=0;o<i.length;++o)a[o]=i.charCodeAt(o);return a}arrayBufferToBase64(r){const n=new Uint8Array(r);let s="";for(let i=0;i<n.byteLength;i++)s+=String.fromCharCode(n[i]);return window.btoa(s)}getDeviceInfo(){const n=window.navigator.userAgent;let s="Unknown",i="Unknown",a="web";if(n.includes("Chrome")){s="Chrome";const o=n.match(/Chrome\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Firefox")){s="Firefox";const o=n.match(/Firefox\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Safari")&&!n.includes("Chrome")){s="Safari";const o=n.match(/Version\/(\d+)/);i=o?o[1]:"Unknown"}else if(n.includes("Edge")){s="Edge";const o=n.match(/Edge\/(\d+)/);i=o?o[1]:"Unknown"}return n.includes("Mobile")||n.includes("Android")?a="android":(n.includes("iPhone")||n.includes("iPad"))&&(a="ios"),{userAgent:n,browser:s,version:i,platform:a}}}const ne=new $r;function Fr(){const[t,r]=k(!1),[n,s]=k(null),[i,a]=k(!1),[o,c]=k([]),[l,m]=k([]),[b,d]=k(""),[g,x]=k("settings");K(()=>{u(),v(),y(),h(),p()},[]);const u=async()=>{await ne.initialize(),s(ne.getPermissionStatus())},h=async()=>{try{const f=await fetch("/api/push/vapid-public-key");if(f.ok){const T=await f.json();d(T.publicKey)}}catch(f){console.error("Failed to fetch VAPID public key:",f)}},p=async()=>{try{const f=await fetch("/api/push/admin/subscription",{credentials:"include"});if(f.ok){const T=await f.json();r(T.isSubscribed)}}catch(f){console.error("Failed to check admin subscription:",f)}},v=async()=>{try{const f=await fetch("/api/push/rules",{credentials:"include"});if(f.ok){const T=await f.json();c(T.rules||[])}}catch(f){console.error("Failed to fetch rules:",f)}},y=async()=>{try{const f=await fetch("/api/push/logs?limit=50",{credentials:"include"});if(f.ok){const T=await f.json();m(T.logs||[])}}catch(f){console.error("Failed to fetch logs:",f)}};return{isAdminSubscribed:t,permission:n,loading:i,rules:o,logs:l,vapidPublicKey:b,activeTab:g,setActiveTab:x,setLoading:a,handleAdminSubscribe:async()=>{a(!0);try{const f=await ne.adminSubscribe();f.success?(r(!0),s("granted"),alert("Successfully subscribed to push notifications for testing!")):alert(`Failed to subscribe: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{a(!1)}},handleAdminUnsubscribe:async()=>{a(!0);try{const f=await ne.adminUnsubscribe();f.success?(r(!1),alert("Successfully unsubscribed from push notifications!")):alert(`Failed to unsubscribe: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{a(!1)}},handleAdminTestNotification:async()=>{a(!0);try{const f=await ne.sendAdminTestNotification();f.success?(alert("Test notification sent! Check your notifications."),y()):alert(`Failed to send test notification: ${f.error}`)}catch(f){alert(`Error: ${f}`)}finally{a(!1)}},handleDeleteRule:async f=>{if(confirm("Are you sure you want to delete this rule?"))try{(await fetch(`/api/push/rules/${f}`,{method:"DELETE",credentials:"include"})).ok?(v(),alert("Rule deleted successfully")):alert("Failed to delete rule")}catch(T){console.error("Failed to delete rule:",T),alert("Error deleting rule")}},handleToggleRule:async f=>{try{(await fetch(`/api/push/rules/${f.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...f,enabled:!f.enabled})})).ok?v():alert("Failed to toggle rule")}catch(T){console.error("Failed to toggle rule:",T),alert("Error toggling rule")}},fetchRules:v,fetchLogs:y}}function Pr(){const{isAdminSubscribed:t,permission:r,loading:n,rules:s,logs:i,vapidPublicKey:a,activeTab:o,setActiveTab:c,setLoading:l,handleAdminSubscribe:m,handleAdminUnsubscribe:b,handleAdminTestNotification:d,handleDeleteRule:g,handleToggleRule:x,fetchRules:u}=Fr(),[h,p]=k(!1),[v,y]=k(null),w=()=>{y(null),p(!0)},_=$=>{y($),p(!0)},C=()=>{p(!1),y(null)},N=async $=>{await u(),C()};return e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Push Notifications"}),e("p",{className:"mt-2 text-gray-600",children:"Manage push notification settings, rules, and view delivery logs"})]}),e("div",{className:"border-b border-gray-200 mb-8",children:e("div",{className:"-mb-px flex space-x-8",role:"tablist","aria-label":"Push notifications navigation",children:[{id:"settings",name:"Settings"},{id:"test",name:"Test"},{id:"rules",name:"Rules"},{id:"logs",name:"Logs"}].map($=>e("button",{type:"button",role:"tab","aria-selected":o===$.id,"aria-controls":`${$.id}-panel`,onClick:()=>c($.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${o===$.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:$.name},$.id))})}),e("div",{role:"tabpanel",id:"settings-panel","aria-labelledby":"settings-tab",children:o==="settings"&&e(Er,{vapidPublicKey:a})}),e("div",{role:"tabpanel",id:"test-panel","aria-labelledby":"test-tab",children:o==="test"&&e(Sr,{isAdminSubscribed:t,permission:r,loading:n,onAdminSubscribe:m,onAdminUnsubscribe:b,onAdminTestNotification:d})}),e("div",{role:"tabpanel",id:"rules-panel","aria-labelledby":"rules-tab",children:o==="rules"&&e(Tr,{rules:s,onCreateRule:w,onEditRule:_,onToggleRule:x,onDeleteRule:g})}),e("div",{role:"tabpanel",id:"logs-panel","aria-labelledby":"logs-tab",children:o==="logs"&&e(Cr,{logs:i})}),h&&e(Ar,{editingRule:v,loading:n,onSubmit:N,onClose:C,setLoading:l})]})}function Ur({onError:t}){const[r,n]=k([]),[s,i]=k(!1),[a,o]=k(""),[c,l]=k(!1),[m,b]=k(null),d=async()=>{try{i(!0),t(null);const u=await fetch("/api/admin",{credentials:"include"});if(!u.ok)throw new Error("Failed to load admins");const h=await u.json();n(h.admins)}catch(u){console.error("Failed to load admins:",u),t(u instanceof Error?u.message:"Failed to load admins")}finally{i(!1)}},g=async u=>{if(u.preventDefault(),!a.trim()){t("GitHub username is required");return}try{l(!0),t(null);const h=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({github_username:a.trim()})});if(!h.ok){const p=await h.json();throw new Error(p.error||"Failed to add admin")}o(""),await d()}catch(h){console.error("Failed to add admin:",h),t(h instanceof Error?h.message:"Failed to add admin")}finally{l(!1)}},x=async u=>{try{t(null);const h=await fetch(`/api/admin/${u}`,{method:"DELETE",credentials:"include"});if(!h.ok){const p=await h.json();throw new Error(p.error||"Failed to remove admin")}b(null),await d()}catch(h){console.error("Failed to remove admin:",h),t(h instanceof Error?h.message:"Failed to remove admin")}};return K(()=>{d()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Admin Management"}),e("form",{onSubmit:g,className:"mb-6",children:e("div",{className:"flex space-x-3",children:[e("div",{className:"flex-1",children:e("input",{type:"text",value:a,onChange:u=>o(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"GitHub username",disabled:c})}),e("button",{type:"submit",disabled:c||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50",children:c?"Adding...":"Add Admin"})]})}),s?e("div",{className:"text-center py-4",children:e("p",{className:"text-gray-500",children:"Loading admins..."})}):e("div",{children:r.length===0?e("p",{className:"text-sm text-gray-500",children:"No admins found"}):e("div",{className:"space-y-2",children:r.map(u=>e("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e("div",{className:"flex items-center space-x-3",children:e("div",{children:[e("p",{className:"text-sm font-medium text-gray-900",children:[u.github_username,u.is_root&&e("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Root Admin"})]}),e("p",{className:"text-xs text-gray-500",children:["Added ",W(u.created_at)]})]})}),!u.is_root&&e("button",{type:"button",onClick:()=>b({id:u.id,username:u.github_username}),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]},u.id))})}),m&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Remove Admin"}),e("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to remove"," ",e("span",{className:"font-medium",children:m.username})," as an admin? This action cannot be undone."]}),e("div",{className:"flex justify-end space-x-3",children:[e("button",{type:"button",onClick:()=>b(null),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"button",onClick:()=>x(m.id),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700",children:"Remove Admin"})]})]})})]})})}function Ir({onError:t}){const[r,n]=k([]),[s,i]=k(!1),[a,o]=k(!1),[c,l]=k({name:"",scopes:[],expires_in_days:30}),[m,b]=k(null),[d]=k(["data:read","data:write","data:delete","tables:read","tables:write","tables:delete","storage:read","storage:write","storage:delete"]),[g,x]=k(null),u=async()=>{try{i(!0),t(null);const y=await fetch("/api/api-keys/init",{method:"POST",credentials:"include"});if(!y.ok){const C=await y.json().catch(()=>({}))}const w=await fetch("/api/api-keys",{credentials:"include"});if(!w.ok){const C=await w.json().catch(()=>({}));throw new Error(`Failed to load API keys: ${w.status} - ${C.error||"Unknown error"}`)}const _=await w.json();n(_.data||[])}catch(y){console.error("Failed to load API keys:",y);let w="Failed to load API keys";y instanceof Error&&(w=y.message),typeof y=="object"&&y!==null&&"status"in y&&(w+=` (Status: ${y.status})`),t(w)}finally{i(!1)}},h=async y=>{if(y.preventDefault(),!c.name.trim()||c.scopes.length===0){t("Name and at least one scope are required");return}try{t(null);const w=await fetch("/api/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)});if(!w.ok){const C=await w.json().catch(()=>({})),N=`Failed to create API key: ${w.status} - ${C.error||"Unknown error"}`;throw C.details?new Error(`${N}. Details: ${JSON.stringify(C.details)}`):new Error(N)}const _=await w.json();b(_.data),o(!1),l({name:"",scopes:[],expires_in_days:30}),await u()}catch(w){console.error("Failed to create API key:",w),t(w instanceof Error?w.message:"Failed to create API key")}},p=async y=>{try{t(null);const w=await fetch(`/api/api-keys/${y}`,{method:"DELETE",credentials:"include"});if(!w.ok){const _=await w.json().catch(()=>({}));throw new Error(_.error||"Failed to revoke API key")}x(null),await u()}catch(w){console.error("Failed to revoke API key:",w),t(w instanceof Error?w.message:"Failed to revoke API key")}},v=y=>{l(w=>({...w,scopes:w.scopes.includes(y)?w.scopes.filter(_=>_!==y):[...w.scopes,y]}))};return K(()=>{u()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"API Keys"}),e("div",{className:"flex items-center space-x-2",children:e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Create API Key"})})]}),s?e("div",{className:"text-center py-4",children:e("p",{className:"text-gray-500",children:"Loading API keys..."})}):e("div",{className:"space-y-2",children:r.length===0?e("p",{className:"text-sm text-gray-500",children:"No API keys found. Create one to get started."}):e("div",{className:"space-y-3",children:r.map(y=>e("div",{className:"border border-gray-200 rounded-lg p-4",children:e("div",{className:"flex items-start justify-between",children:[e("div",{className:"flex-1",children:[e("div",{className:"flex items-center space-x-2 mb-2",children:[e("h4",{className:"text-sm font-medium text-gray-900",children:y.name}),e("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:y.is_active?"Active":"Revoked"})]}),e("div",{className:"space-y-1 text-sm text-gray-600",children:[e("p",{children:[e("span",{className:"font-medium",children:"Key:"})," ",y.key_prefix,"..."]}),e("p",{children:[e("span",{className:"font-medium",children:"Scopes:"})," ",y.scopes.join(", ")]}),e("p",{children:[e("span",{className:"font-medium",children:"Created:"})," ",W(y.created_at)]}),y.expires_at&&e("p",{children:[e("span",{className:"font-medium",children:"Expires:"})," ",W(y.expires_at)]}),y.last_used_at&&e("p",{children:[e("span",{className:"font-medium",children:"Last used:"})," ",W(y.last_used_at)]})]})]}),y.is_active&&e("button",{type:"button",onClick:()=>x({id:y.id,name:y.name}),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Revoke"})]})},y.id))})}),a&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Create API Key"}),e("form",{onSubmit:h,className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"api-key-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e("input",{id:"api-key-name",type:"text",value:c.name,onChange:y=>l(w=>({...w,name:y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"My API Key",required:!0})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{className:"space-y-2",children:d.map(y=>e("label",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:c.scopes.includes(y),onChange:()=>v(y),className:"mr-2"}),e("span",{className:"text-sm",children:y})]},y))})]}),e("div",{children:[e("label",{htmlFor:"expires-in-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires in (days)"}),e("input",{id:"expires-in-days",type:"number",value:c.expires_in_days||"",onChange:y=>l(w=>({...w,expires_in_days:parseInt(y.target.value)||void 0})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"30",min:"1",max:"365"}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for no expiration"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700",children:"Create Key"})]})]})]})}),g&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"Revoke API Key"}),e("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to revoke the API key"," ",e("span",{className:"font-medium",children:['"',g.name,'"']}),"? This action cannot be undone and will immediately disable the key."]}),e("div",{className:"flex justify-end space-x-3",children:[e("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200",children:"Cancel"}),e("button",{type:"button",onClick:()=>p(g.id),className:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700",children:"Revoke Key"})]})]})}),m&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e("h3",{className:"text-lg font-semibold mb-4",children:"API Key Created"}),e("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:e("p",{className:"text-sm text-yellow-800 mb-2",children:[e("strong",{children:"Important:"})," This is the only time you'll see the full API key. Copy it now and store it securely."]})}),e("div",{className:"space-y-3",children:[e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Name"}),e("p",{className:"text-sm text-gray-900",children:m.name})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"API Key"}),e("div",{className:"flex items-center space-x-2",children:[e("code",{className:"flex-1 px-2 py-1 bg-gray-100 rounded text-sm font-mono break-all",children:m.key}),e("button",{type:"button",onClick:()=>navigator.clipboard.writeText(m.key),className:"px-2 py-1 text-blue-600 hover:text-blue-800 text-sm",children:"Copy"})]})]}),e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Scopes"}),e("p",{className:"text-sm text-gray-900",children:m.scopes.join(", ")})]}),m.expires_at&&e("div",{children:[e("div",{className:"text-sm font-medium text-gray-700",children:"Expires"}),e("p",{className:"text-sm text-gray-900",children:W(m.expires_at)})]})]}),e("div",{className:"flex justify-end pt-4",children:e("button",{type:"button",onClick:()=>b(null),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700",children:"I've saved the key"})})]})})]})})}function Xe({onError:t}){const[r,n]=k([]),[s,i]=k(!1),[a,o]=k(!1),[c,l]=k({}),[m,b]=k(!1),d=async()=>{try{i(!0),t(null);const u=await fetch("/api/app-settings",{credentials:"include"});if(!u.ok)throw new Error("Failed to load app settings");const h=await u.json();n(h.settings);const p={};h.settings.forEach(v=>{p[v.key]=v.value}),l(p)}catch(u){console.error("Failed to load app settings:",u),t(u instanceof Error?u.message:"Failed to load app settings")}finally{i(!1)}},g=async()=>{try{b(!0),t(null);const{oauth_user_agent:u,...h}=c,p=await fetch("/api/app-settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(h)});if(!p.ok){const v=await p.json();throw new Error(v.error||"Failed to save app settings")}o(!1),await d()}catch(u){console.error("Failed to save app settings:",u),t(u instanceof Error?u.message:"Failed to save app settings")}finally{b(!1)}},x=()=>{o(!1);const u={};r.forEach(h=>{u[h.key]=h.value}),l(u)};return K(()=>{d()},[]),e("div",{className:"bg-white shadow rounded-lg",children:e("div",{className:"px-4 py-5 sm:p-6",children:[e("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Application Settings"}),!a&&e("button",{type:"button",onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Edit Settings"})]}),s?e("p",{className:"text-gray-500",children:"Loading app settings..."}):e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{htmlFor:"app-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Application Name"}),e("input",{id:"app-name",type:"text",value:c.app_name||"",onChange:u=>l(h=>({...h,app_name:u.target.value})),disabled:!a,className:`w-full px-3 py-2 border ${a?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"My Vibebase App"}),e("p",{className:"mt-1 text-sm text-gray-500",children:"Used as User-Agent for OAuth providers"})]}),e("div",{children:[e("label",{htmlFor:"app-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Application URL (optional)"}),e("input",{id:"app-url",type:"url",value:c.app_url||"",onChange:u=>l(h=>({...h,app_url:u.target.value})),disabled:!a,className:`w-full px-3 py-2 border ${a?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"https://myapp.com"})]}),e("div",{children:[e("label",{htmlFor:"support-email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Support Email (optional)"}),e("input",{id:"support-email",type:"email",value:c.support_email||"",onChange:u=>l(h=>({...h,support_email:u.target.value})),disabled:!a,className:`w-full px-3 py-2 border ${a?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"support@myapp.com"})]}),a&&e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-700 bg-gray-100 text-sm font-medium rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300",disabled:m,children:"Cancel"}),e("button",{type:"button",onClick:g,className:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-300 disabled:opacity-50",disabled:m,children:m?"Saving...":"Save Changes"})]})]})]})})}function Dr({activeSection:t,onSectionChange:r}){return e("div",{className:"w-64 bg-gray-50 p-4",children:[e("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Settings"}),e("nav",{className:"space-y-2",children:[{id:"app-settings",label:"App Settings",icon:"⚙️"},{id:"admins",label:"Admins",icon:"👥"},{id:"api-keys",label:"API Keys",icon:"🔑"}].map(s=>e("button",{type:"button",onClick:()=>r(s.id),className:`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${t===s.id?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e("span",{className:"mr-2",children:s.icon}),s.label]},s.id))})]})}const Lr=()=>{const[t,r]=k({activeSection:"app-settings",error:null});return{...t,setActiveSection:a=>{r(o=>({...o,activeSection:a,error:null}))},setError:a=>{r(o=>({...o,error:a}))},clearError:()=>{r(a=>({...a,error:null}))}}};function jr(){const{activeSection:t,error:r,setActiveSection:n,setError:s}=Lr();return e("div",{className:"min-h-screen bg-gray-50",children:e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),e("p",{className:"mt-2 text-gray-600",children:"Manage your application settings, administrators, and API keys"})]}),r&&e("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("div",{className:"flex justify-between items-center",children:[e("p",{className:"text-red-700",children:r}),e("button",{type:"button",onClick:()=>s(null),className:"text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]})}),e("div",{className:"flex gap-6",children:[e(Dr,{activeSection:t,onSectionChange:n}),e("div",{className:"flex-1",children:(()=>{switch(t){case"app-settings":return e(Xe,{onError:s});case"admins":return e(Ur,{onError:s});case"api-keys":return e(Ir,{onError:s});default:return e(Xe,{onError:s})}})()})]})]})})}function Or(){const[t,r]=k([]),[n,s]=k(!0),[i,a]=k(null),[o,c]=k(!1),[l,m]=k(new Set);K(()=>{b()},[]);const b=async(p,v)=>{try{s(!0);const y=new URLSearchParams,w=await fetch(`/api/storage?${y}`);if(!w.ok)throw new Error("Failed to load files");const _=await w.json();r(v?[...t,..._.objects]:_.objects)}catch(y){a(y instanceof Error?y.message:"Unknown error")}finally{s(!1)}},d=async p=>{const v=p.target,y=v.files;if(y!=null&&y.length){c(!0);try{for(const w of Array.from(y)){const _=new FormData;if(_.append("file",w),!(await fetch("/api/storage/upload",{method:"POST",body:_})).ok)throw new Error(`Failed to upload ${w.name}`)}await b(),v.value=""}catch(w){a(w instanceof Error?w.message:"Upload failed")}finally{c(!1)}}},g=async p=>{if(confirm(`Delete ${p}?`))try{if(!(await fetch(`/api/storage/${encodeURIComponent(p)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete file");r(t.filter(y=>y.key!==p))}catch(v){a(v instanceof Error?v.message:"Delete failed")}},x=async()=>{if(l.size!==0&&confirm(`Delete ${l.size} files?`))try{if(!(await fetch("/api/storage",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:Array.from(l)})})).ok)throw new Error("Failed to delete files");r(t.filter(v=>!l.has(v.key))),m(new Set)}catch(p){a(p instanceof Error?p.message:"Bulk delete failed")}},u=p=>{if(p===0)return"0 B";const v=1024,y=["B","KB","MB","GB"],w=Math.floor(Math.log(p)/Math.log(v));return`${parseFloat((p/v**w).toFixed(2))} ${y[w]}`},h=p=>{const v=new Set(l);v.has(p)?v.delete(p):v.add(p),m(v)};return n&&t.length===0?e("div",{class:"flex items-center justify-center h-64",children:e("div",{class:"text-gray-500",children:"Loading files..."})}):e("div",{children:[e("div",{class:"flex justify-between items-center mb-6",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Storage"}),e("div",{class:"flex gap-2",children:[l.size>0&&e("button",{type:"button",onClick:x,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:["Delete Selected (",l.size,")"]}),e("label",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer",children:[o?"Uploading...":"Upload Files",e("input",{type:"file",multiple:!0,onChange:d,disabled:o,class:"hidden"})]})]})]}),i&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-red-600",children:i}),e("button",{type:"button",onClick:()=>a(null),class:"mt-2 text-sm text-red-500 hover:text-red-700",children:"Dismiss"})]}),e("div",{class:"bg-white shadow rounded-lg overflow-hidden",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[e("th",{class:"w-12 px-6 py-3",children:e("input",{type:"checkbox",checked:l.size===t.length&&t.length>0,onChange:p=>{p.target.checked?m(new Set(t.map(y=>y.key))):m(new Set)}})}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:t.length===0?e("tr",{children:e("td",{colSpan:6,class:"px-6 py-4 text-center text-gray-500",children:"No files uploaded yet"})}):t.map(p=>e("tr",{class:"hover:bg-gray-50",children:[e("td",{class:"px-6 py-4",children:e("input",{type:"checkbox",checked:l.has(p.key),onChange:()=>h(p.key)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm font-medium text-gray-900",children:p.key})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:u(p.size)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:p.contentType||"Unknown"})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:W(p.uploaded)})}),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e("a",{href:`/api/storage/download/${encodeURIComponent(p.key)}`,class:"text-blue-600 hover:text-blue-900 mr-4",download:!0,children:"Download"}),e("button",{type:"button",onClick:()=>g(p.key),class:"text-red-600 hover:text-red-900",children:"Delete"})]})]},p.key))})]})})]})}function Mr(){return e(Gt,{children:e(bt,{children:[e(Q,{path:"/",component:kr}),e(Q,{path:"/database",component:Nr}),e(Q,{path:"/custom-sql",component:br}),e(Q,{path:"/storage",component:Or}),e(Q,{path:"/push",component:Pr}),e(Q,{path:"/auth",component:or}),e(Q,{path:"/settings",component:jr})]})})}const wt=document.getElementById("app");if(!wt)throw new Error("App container not found");At(e(Mr,{}),wt);
//# sourceMappingURL=index-DArdZn0p.js.map
