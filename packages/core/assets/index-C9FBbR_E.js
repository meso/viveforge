var Fr=Object.defineProperty;var Dr=(r,t,n)=>t in r?Fr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var He=(r,t,n)=>Dr(r,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var Re,H,Wt,ke,Lt,Jt,Gt,Qt,ut,st,it,Zt,Ke={},Xt=[],Lr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Me=Array.isArray;function be(r,t){for(var n in t)r[n]=t[n];return r}function ht(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function qe(r,t,n){var i,a,o,l={};for(o in t)o=="key"?i=t[o]:o=="ref"?a=t[o]:l[o]=t[o];if(arguments.length>2&&(l.children=arguments.length>3?Re.call(arguments,2):n),typeof r=="function"&&r.defaultProps!=null)for(o in r.defaultProps)l[o]===void 0&&(l[o]=r.defaultProps[o]);return Ue(r,l,i,a,null)}function Ue(r,t,n,i,a){var o={type:r,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++Wt,__i:-1,__u:0};return a==null&&H.vnode!=null&&H.vnode(o),o}function Se(r){return r.children}function Oe(r,t){this.props=r,this.context=t}function Ne(r,t){if(t==null)return r.__?Ne(r.__,r.__i+1):null;for(var n;t<r.__k.length;t++)if((n=r.__k[t])!=null&&n.__e!=null)return n.__e;return typeof r.type=="function"?Ne(r):null}function Yt(r){var t,n;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,t=0;t<r.__k.length;t++)if((n=r.__k[t])!=null&&n.__e!=null){r.__e=r.__c.base=n.__e;break}return Yt(r)}}function at(r){(!r.__d&&(r.__d=!0)&&ke.push(r)&&!Je.__r++||Lt!=H.debounceRendering)&&((Lt=H.debounceRendering)||Jt)(Je)}function Je(){for(var r,t,n,i,a,o,l,g=1;ke.length;)ke.length>g&&ke.sort(Gt),r=ke.shift(),g=ke.length,r.__d&&(n=void 0,a=(i=(t=r).__v).__e,o=[],l=[],t.__P&&((n=be({},i)).__v=i.__v+1,H.vnode&&H.vnode(n),mt(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[a]:null,o,a??Ne(i),!!(32&i.__u),l),n.__v=i.__v,n.__.__k[n.__i]=n,rr(o,n,l),n.__e!=a&&Yt(n)));Je.__r=0}function er(r,t,n,i,a,o,l,g,w,x,$){var d,k,p,v,T,m,N=i&&i.__k||Xt,j=t.length;for(w=Pr(n,t,N,w,j),d=0;d<j;d++)(p=n.__k[d])!=null&&(k=p.__i==-1?Ke:N[p.__i]||Ke,p.__i=d,m=mt(r,p,k,a,o,l,g,w,x,$),v=p.__e,p.ref&&k.ref!=p.ref&&(k.ref&&pt(k.ref,null,p),$.push(p.ref,p.__c||v,p)),T==null&&v!=null&&(T=v),4&p.__u||k.__k===p.__k?w=tr(p,w,r):typeof p.type=="function"&&m!==void 0?w=m:v&&(w=v.nextSibling),p.__u&=-7);return n.__e=T,w}function Pr(r,t,n,i,a){var o,l,g,w,x,$=n.length,d=$,k=0;for(r.__k=new Array(a),o=0;o<a;o++)(l=t[o])!=null&&typeof l!="boolean"&&typeof l!="function"?(w=o+k,(l=r.__k[o]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?Ue(null,l,null,null,null):Me(l)?Ue(Se,{children:l},null,null,null):l.constructor==null&&l.__b>0?Ue(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=r,l.__b=r.__b+1,g=null,(x=l.__i=Ur(l,n,w,d))!=-1&&(d--,(g=n[x])&&(g.__u|=2)),g==null||g.__v==null?(x==-1&&(a>$?k--:a<$&&k++),typeof l.type!="function"&&(l.__u|=4)):x!=w&&(x==w-1?k--:x==w+1?k++:(x>w?k--:k++,l.__u|=4))):r.__k[o]=null;if(d)for(o=0;o<$;o++)(g=n[o])!=null&&!(2&g.__u)&&(g.__e==i&&(i=Ne(g)),sr(g,g));return i}function tr(r,t,n){var i,a;if(typeof r.type=="function"){for(i=r.__k,a=0;i&&a<i.length;a++)i[a]&&(i[a].__=r,t=tr(i[a],t,n));return t}r.__e!=t&&(t&&r.type&&!n.contains(t)&&(t=Ne(r)),n.insertBefore(r.__e,t||null),t=r.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function ot(r,t){return t=t||[],r==null||typeof r=="boolean"||(Me(r)?r.some(function(n){ot(n,t)}):t.push(r)),t}function Ur(r,t,n,i){var a,o,l=r.key,g=r.type,w=t[n];if(w===null&&r.key==null||w&&l==w.key&&g==w.type&&!(2&w.__u))return n;if(i>(w!=null&&!(2&w.__u)?1:0))for(a=n-1,o=n+1;a>=0||o<t.length;){if(a>=0){if((w=t[a])&&!(2&w.__u)&&l==w.key&&g==w.type)return a;a--}if(o<t.length){if((w=t[o])&&!(2&w.__u)&&l==w.key&&g==w.type)return o;o++}}return-1}function Pt(r,t,n){t[0]=="-"?r.setProperty(t,n??""):r[t]=n==null?"":typeof n!="number"||Lr.test(t)?n:n+"px"}function Ve(r,t,n,i,a){var o,l;e:if(t=="style")if(typeof n=="string")r.style.cssText=n;else{if(typeof i=="string"&&(r.style.cssText=i=""),i)for(t in i)n&&t in n||Pt(r.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||Pt(r.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(Qt,"$1")),l=t.toLowerCase(),t=l in r||t=="onFocusOut"||t=="onFocusIn"?l.slice(2):t.slice(2),r.l||(r.l={}),r.l[t+o]=n,n?i?n.u=i.u:(n.u=ut,r.addEventListener(t,o?it:st,o)):r.removeEventListener(t,o?it:st,o);else{if(a=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in r)try{r[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?r.removeAttribute(t):r.setAttribute(t,t=="popover"&&n==1?"":n))}}function Ut(r){return function(t){if(this.l){var n=this.l[t.type+r];if(t.t==null)t.t=ut++;else if(t.t<n.u)return;return n(H.event?H.event(t):t)}}}function mt(r,t,n,i,a,o,l,g,w,x){var $,d,k,p,v,T,m,N,j,F,S,K,z,te,W,re,le,G=t.type;if(t.constructor!=null)return null;128&n.__u&&(w=!!(32&n.__u),o=[g=t.__e=n.__e]),($=H.__b)&&$(t);e:if(typeof G=="function")try{if(N=t.props,j="prototype"in G&&G.prototype.render,F=($=G.contextType)&&i[$.__c],S=$?F?F.props.value:$.__:i,n.__c?m=(d=t.__c=n.__c).__=d.__E:(j?t.__c=d=new G(N,S):(t.__c=d=new Oe(N,S),d.constructor=G,d.render=Ir),F&&F.sub(d),d.props=N,d.state||(d.state={}),d.context=S,d.__n=i,k=d.__d=!0,d.__h=[],d._sb=[]),j&&d.__s==null&&(d.__s=d.state),j&&G.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=be({},d.__s)),be(d.__s,G.getDerivedStateFromProps(N,d.__s))),p=d.props,v=d.state,d.__v=t,k)j&&G.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),j&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(j&&G.getDerivedStateFromProps==null&&N!==p&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(N,S),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(N,d.__s,S)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(d.props=N,d.state=d.__s,d.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(I){I&&(I.__=t)}),K=0;K<d._sb.length;K++)d.__h.push(d._sb[K]);d._sb=[],d.__h.length&&l.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(N,d.__s,S),j&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(p,v,T)})}if(d.context=S,d.props=N,d.__P=r,d.__e=!1,z=H.__r,te=0,j){for(d.state=d.__s,d.__d=!1,z&&z(t),$=d.render(d.props,d.state,d.context),W=0;W<d._sb.length;W++)d.__h.push(d._sb[W]);d._sb=[]}else do d.__d=!1,z&&z(t),$=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++te<25);d.state=d.__s,d.getChildContext!=null&&(i=be(be({},i),d.getChildContext())),j&&!k&&d.getSnapshotBeforeUpdate!=null&&(T=d.getSnapshotBeforeUpdate(p,v)),re=$,$!=null&&$.type===Se&&$.key==null&&(re=nr($.props.children)),g=er(r,Me(re)?re:[re],t,n,i,a,o,l,g,w,x),d.base=t.__e,t.__u&=-161,d.__h.length&&l.push(d),m&&(d.__E=d.__=null)}catch(I){if(t.__v=null,w||o!=null)if(I.then){for(t.__u|=w?160:128;g&&g.nodeType==8&&g.nextSibling;)g=g.nextSibling;o[o.indexOf(g)]=null,t.__e=g}else for(le=o.length;le--;)ht(o[le]);else t.__e=n.__e,t.__k=n.__k;H.__e(I,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):g=t.__e=Or(n.__e,t,n,i,a,o,l,w,x);return($=H.diffed)&&$(t),128&t.__u?void 0:g}function rr(r,t,n){for(var i=0;i<n.length;i++)pt(n[i],n[++i],n[++i]);H.__c&&H.__c(t,r),r.some(function(a){try{r=a.__h,a.__h=[],r.some(function(o){o.call(a)})}catch(o){H.__e(o,a.__v)}})}function nr(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Me(r)?r.map(nr):be({},r)}function Or(r,t,n,i,a,o,l,g,w){var x,$,d,k,p,v,T,m=n.props,N=t.props,j=t.type;if(j=="svg"?a="http://www.w3.org/2000/svg":j=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(x=0;x<o.length;x++)if((p=o[x])&&"setAttribute"in p==!!j&&(j?p.localName==j:p.nodeType==3)){r=p,o[x]=null;break}}if(r==null){if(j==null)return document.createTextNode(N);r=document.createElementNS(a,j,N.is&&N),g&&(H.__m&&H.__m(t,o),g=!1),o=null}if(j==null)m===N||g&&r.data==N||(r.data=N);else{if(o=o&&Re.call(r.childNodes),m=n.props||Ke,!g&&o!=null)for(m={},x=0;x<r.attributes.length;x++)m[(p=r.attributes[x]).name]=p.value;for(x in m)if(p=m[x],x!="children"){if(x=="dangerouslySetInnerHTML")d=p;else if(!(x in N)){if(x=="value"&&"defaultValue"in N||x=="checked"&&"defaultChecked"in N)continue;Ve(r,x,null,p,a)}}for(x in N)p=N[x],x=="children"?k=p:x=="dangerouslySetInnerHTML"?$=p:x=="value"?v=p:x=="checked"?T=p:g&&typeof p!="function"||m[x]===p||Ve(r,x,p,m[x],a);if($)g||d&&($.__html==d.__html||$.__html==r.innerHTML)||(r.innerHTML=$.__html),t.__k=[];else if(d&&(r.innerHTML=""),er(t.type=="template"?r.content:r,Me(k)?k:[k],t,n,i,j=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,l,o?o[0]:n.__k&&Ne(n,0),g,w),o!=null)for(x=o.length;x--;)ht(o[x]);g||(x="value",j=="progress"&&v==null?r.removeAttribute("value"):v!=null&&(v!==r[x]||j=="progress"&&!v||j=="option"&&v!=m[x])&&Ve(r,x,v,m[x],a),x="checked",T!=null&&T!=r[x]&&Ve(r,x,T,m[x],a))}return r}function pt(r,t,n){try{if(typeof r=="function"){var i=typeof r.__u=="function";i&&r.__u(),i&&t==null||(r.__u=r(t))}else r.current=t}catch(a){H.__e(a,n)}}function sr(r,t,n){var i,a;if(H.unmount&&H.unmount(r),(i=r.ref)&&(i.current&&i.current!=r.__e||pt(i,null,t)),(i=r.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){H.__e(o,t)}i.base=i.__P=null}if(i=r.__k)for(a=0;a<i.length;a++)i[a]&&sr(i[a],t,n||typeof r.type!="function");n||ht(r.__e),r.__c=r.__=r.__e=void 0}function Ir(r,t,n){return this.constructor(r,n)}function Kr(r,t,n){var i,a,o,l;t==document&&(t=document.documentElement),H.__&&H.__(r,t),a=(i=!1)?null:t.__k,o=[],l=[],mt(t,r=t.__k=qe(Se,null,[r]),a||Ke,Ke,t.namespaceURI,a?null:t.firstChild?Re.call(t.childNodes):null,o,a?a.__e:t.firstChild,i,l),rr(o,r,l)}function Rr(r,t,n){var i,a,o,l,g=be({},r.props);for(o in r.type&&r.type.defaultProps&&(l=r.type.defaultProps),t)o=="key"?i=t[o]:o=="ref"?a=t[o]:g[o]=t[o]===void 0&&l!=null?l[o]:t[o];return arguments.length>2&&(g.children=arguments.length>3?Re.call(arguments,2):n),Ue(r.type,g,i||r.key,a||r.ref,null)}function Mr(r){function t(n){var i,a;return this.getChildContext||(i=new Set,(a={})[t.__c]=this,this.getChildContext=function(){return a},this.componentWillUnmount=function(){i=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&i.forEach(function(l){l.__e=!0,at(l)})},this.sub=function(o){i.add(o);var l=o.componentWillUnmount;o.componentWillUnmount=function(){i&&i.delete(o),l&&l.call(o)}}),n.children}return t.__c="__cC"+Zt++,t.__=r,t.Provider=t.__l=(t.Consumer=function(n,i){return n.children(i)}).contextType=t,t}Re=Xt.slice,H={__e:function(r,t,n,i){for(var a,o,l;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(r)),l=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(r,i||{}),l=a.__d),l)return a.__E=a}catch(g){r=g}throw r}},Wt=0,Oe.prototype.setState=function(r,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=be({},this.state),typeof r=="function"&&(r=r(be({},n),this.props)),r&&be(n,r),r!=null&&this.__v&&(t&&this._sb.push(t),at(this))},Oe.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),at(this))},Oe.prototype.render=Se,ke=[],Jt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Gt=function(r,t){return r.__v.__b-t.__v.__b},Je.__r=0,Qt=/(PointerCapture)$|Capture$/i,ut=0,st=Ut(!1),it=Ut(!0),Zt=0;var qr=0;function e(r,t,n,i,a,o){t||(t={});var l,g,w=t;if("ref"in w)for(g in w={},t)g=="ref"?l=t[g]:w[g]=t[g];var x={type:r,props:w,key:n,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--qr,__i:-1,__u:0,__source:a,__self:o};if(typeof r=="function"&&(l=r.defaultProps))for(g in l)w[g]===void 0&&(w[g]=l[g]);return H.vnode&&H.vnode(x),x}var $e,Y,Ye,Ot,Ge=0,ir=[],ie=H,It=ie.__b,Kt=ie.__r,Rt=ie.diffed,Mt=ie.__c,qt=ie.unmount,Bt=ie.__;function Qe(r,t){ie.__h&&ie.__h(Y,r,Ge||t),Ge=0;var n=Y.__H||(Y.__H={__:[],__h:[]});return r>=n.__.length&&n.__.push({}),n.__[r]}function y(r){return Ge=1,Br(or,r)}function Br(r,t,n){var i=Qe($e++,2);if(i.t=r,!i.__c&&(i.__=[or(void 0,t),function(g){var w=i.__N?i.__N[0]:i.__[0],x=i.t(w,g);w!==x&&(i.__N=[x,i.__[1]],i.__c.setState({}))}],i.__c=Y,!Y.__f)){var a=function(g,w,x){if(!i.__c.__H)return!0;var $=i.__c.__H.__.filter(function(k){return!!k.__c});if($.every(function(k){return!k.__N}))return!o||o.call(this,g,w,x);var d=i.__c.props!==g;return $.forEach(function(k){if(k.__N){var p=k.__[0];k.__=k.__N,k.__N=void 0,p!==k.__[0]&&(d=!0)}}),o&&o.call(this,g,w,x)||d};Y.__f=!0;var o=Y.shouldComponentUpdate,l=Y.componentWillUpdate;Y.componentWillUpdate=function(g,w,x){if(this.__e){var $=o;o=void 0,a(g,w,x),o=$}l&&l.call(this,g,w,x)},Y.shouldComponentUpdate=a}return i.__N||i.__}function he(r,t){var n=Qe($e++,3);!ie.__s&&ar(n.__H,t)&&(n.__=r,n.u=t,Y.__H.__h.push(n))}function zt(r){return Ge=5,zr(function(){return{current:r}},[])}function zr(r,t){var n=Qe($e++,7);return ar(n.__H,t)&&(n.__=r(),n.__H=t,n.__h=r),n.__}function Hr(r){var t=Y.context[r.__c],n=Qe($e++,9);return n.c=r,t?(n.__==null&&(n.__=!0,t.sub(Y)),t.props.value):r.__}function Vr(){for(var r;r=ir.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(We),r.__H.__h.forEach(lt),r.__H.__h=[]}catch(t){r.__H.__h=[],ie.__e(t,r.__v)}}ie.__b=function(r){Y=null,It&&It(r)},ie.__=function(r,t){r&&t.__k&&t.__k.__m&&(r.__m=t.__k.__m),Bt&&Bt(r,t)},ie.__r=function(r){Kt&&Kt(r),$e=0;var t=(Y=r.__c).__H;t&&(Ye===Y?(t.__h=[],Y.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(We),t.__h.forEach(lt),t.__h=[],$e=0)),Ye=Y},ie.diffed=function(r){Rt&&Rt(r);var t=r.__c;t&&t.__H&&(t.__H.__h.length&&(ir.push(t)!==1&&Ot===ie.requestAnimationFrame||((Ot=ie.requestAnimationFrame)||Wr)(Vr)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ye=Y=null},ie.__c=function(r,t){t.some(function(n){try{n.__h.forEach(We),n.__h=n.__h.filter(function(i){return!i.__||lt(i)})}catch(i){t.some(function(a){a.__h&&(a.__h=[])}),t=[],ie.__e(i,n.__v)}}),Mt&&Mt(r,t)},ie.unmount=function(r){qt&&qt(r);var t,n=r.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{We(i)}catch(a){t=a}}),n.__H=void 0,t&&ie.__e(t,n.__v))};var Ht=typeof requestAnimationFrame=="function";function Wr(r){var t,n=function(){clearTimeout(i),Ht&&cancelAnimationFrame(t),setTimeout(r)},i=setTimeout(n,35);Ht&&(t=requestAnimationFrame(n))}function We(r){var t=Y,n=r.__c;typeof n=="function"&&(r.__c=void 0,n()),Y=t}function lt(r){var t=Y;r.__c=r.__(),Y=t}function ar(r,t){return!r||r.length!==t.length||t.some(function(n,i){return n!==r[i]})}function or(r,t){return typeof t=="function"?t(r):t}var Jr={};function Pe(r,t){for(var n in t)r[n]=t[n];return r}function ct(r,t,n){var i,a=/(?:\?([^#]*))?(#.*)?$/,o=r.match(a),l={};if(o&&o[1])for(var g=o[1].split("&"),w=0;w<g.length;w++){var x=g[w].split("=");l[decodeURIComponent(x[0])]=decodeURIComponent(x.slice(1).join("="))}r=dt(r.replace(a,"")),t=dt(t||"");for(var $=Math.max(r.length,t.length),d=0;d<$;d++)if(t[d]&&t[d].charAt(0)===":"){var k=t[d].replace(/(^:|[+*?]+$)/g,""),p=(t[d].match(/[+*?]+$/)||Jr)[0]||"",v=~p.indexOf("+"),T=~p.indexOf("*"),m=r[d]||"";if(!m&&!T&&(p.indexOf("?")<0||v)){i=!1;break}if(l[k]=decodeURIComponent(m),v||T){l[k]=r.slice(d).map(decodeURIComponent).join("/");break}}else if(t[d]!==r[d]){i=!1;break}return(n.default===!0||i!==!1)&&l}function Gr(r,t){return r.rank<t.rank?1:r.rank>t.rank?-1:r.index-t.index}function Qr(r,t){return r.index=t,r.rank=function(n){return n.props.default?0:dt(n.props.path).map(Zr).join("")}(r),r.props}function dt(r){return r.replace(/(^\/+|\/+$)/g,"").split("/")}function Zr(r){return r.charAt(0)==":"?1+"*+?".indexOf(r.charAt(r.length-1))||4:5}var Xr={},Ce=[],Ie=[],me=null,ft={url:gt()},lr=Mr(ft);function Yr(){var r=Hr(lr);if(r===ft){var t=y()[1];he(function(){return Ie.push(t),function(){return Ie.splice(Ie.indexOf(t),1)}},[])}return[r,cr]}function gt(){var r;return""+((r=me&&me.location?me.location:me&&me.getCurrentLocation?me.getCurrentLocation():typeof location<"u"?location:Xr).pathname||"")+(r.search||"")}function cr(r,t){return t===void 0&&(t=!1),typeof r!="string"&&r.url&&(t=r.replace,r=r.url),function(n){for(var i=Ce.length;i--;)if(Ce[i].canRoute(n))return!0;return!1}(r)&&function(n,i){i===void 0&&(i="push"),me&&me[i]?me[i](n):typeof history<"u"&&history[i+"State"]&&history[i+"State"](null,null,n)}(r,t?"replace":"push"),dr(r)}function dr(r){for(var t=!1,n=0;n<Ce.length;n++)Ce[n].routeTo(r)&&(t=!0);return t}function en(r){if(r&&r.getAttribute){var t=r.getAttribute("href"),n=r.getAttribute("target");if(t&&t.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return cr(t)}}function tn(r){return r.stopImmediatePropagation&&r.stopImmediatePropagation(),r.stopPropagation&&r.stopPropagation(),r.preventDefault(),!1}function ur(r){if(!(r.ctrlKey||r.metaKey||r.altKey||r.shiftKey||r.button)){var t=r.target;do if(t.localName==="a"&&t.getAttribute("href")){if(t.hasAttribute("data-native")||t.hasAttribute("native"))return;if(en(t))return tn(r)}while(t=t.parentNode)}}var Vt=!1;function hr(r){r.history&&(me=r.history),this.state={url:r.url||gt()}}Pe(hr.prototype=new Oe,{shouldComponentUpdate:function(r){return r.static!==!0||r.url!==this.props.url||r.onChange!==this.props.onChange},canRoute:function(r){var t=ot(this.props.children);return this.g(t,r)!==void 0},routeTo:function(r){this.setState({url:r});var t=this.canRoute(r);return this.p||this.forceUpdate(),t},componentWillMount:function(){this.p=!0},componentDidMount:function(){var r=this;Vt||(Vt=!0,me||addEventListener("popstate",function(){dr(gt())}),addEventListener("click",ur)),Ce.push(this),me&&(this.u=me.listen(function(t){var n=t.location||t;r.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Ce.splice(Ce.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(r,t){r=r.filter(Qr).sort(Gr);for(var n=0;n<r.length;n++){var i=r[n],a=ct(t,i.props.path,i.props);if(a)return[i,a]}},render:function(r,t){var n,i,a=r.onChange,o=t.url,l=this.c,g=this.g(ot(r.children),o);if(g&&(i=Rr(g[0],Pe(Pe({url:o,matches:n=g[1]},n),{key:void 0,ref:void 0}))),o!==(l&&l.url)){Pe(ft,l=this.c={url:o,previous:l&&l.url,current:i,path:i?i.props.path:null,matches:n}),l.router=this,l.active=i?[i]:[];for(var w=Ie.length;w--;)Ie[w]({});typeof a=="function"&&a(l)}return qe(lr.Provider,{value:l},i)}});var rn=function(r){return qe("a",Pe({onClick:ur},r))},we=function(r){return qe(r.component,r)};function mr(r){var t,n,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var a=r.length;for(t=0;t<a;t++)r[t]&&(n=mr(r[t]))&&(i&&(i+=" "),i+=n)}else for(n in r)r[n]&&(i&&(i+=" "),i+=n);return i}function nn(){for(var r,t,n=0,i="",a=arguments.length;n<a;n++)(r=arguments[n])&&(t=mr(r))&&(i&&(i+=" "),i+=t);return i}var sn=["className","activeClass","activeClassName","path"];function an(r){var t=r.className,n=r.activeClass,i=r.activeClassName,a=r.path,o=function($,d){if($==null)return{};var k,p,v={},T=Object.keys($);for(p=0;p<T.length;p++)d.indexOf(k=T[p])>=0||(v[k]=$[k]);return v}(r,sn),l=Yr()[0],g=a&&l.path&&ct(l.path,a,{})||ct(l.url,o.href,{}),w=o.class||t||"",x=g&&(n||i)||"";return o.class=w+(w&&x&&" ")+x,qe(rn,o)}function on(){he(()=>{const r=async()=>{try{(await fetch(`${window.location.origin}/auth/status`)).status===401&&window.location.pathname!=="/auth/login"&&(console.warn("Session expired, redirecting to login..."),window.location.href="/auth/login")}catch(t){console.debug("Auth check failed on focus:",t)}};return window.addEventListener("focus",r),r(),()=>{window.removeEventListener("focus",r)}},[])}function ln({children:r}){return on(),e("div",{class:"min-h-screen bg-gray-50",children:[e("nav",{class:"bg-white shadow-sm border-b",children:e("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e("div",{class:"flex justify-between h-16",children:[e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0 flex items-center",children:e("h1",{class:"text-xl font-bold text-gray-900",children:"Vibebase"})}),e("div",{class:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[e(_e,{href:"/",children:"Dashboard"}),e(_e,{href:"/database",children:"Database"}),e(_e,{href:"/custom-sql",children:"Custom SQL"}),e(_e,{href:"/storage",children:"Storage"}),e(_e,{href:"/push",children:"Push"}),e(_e,{href:"/auth",children:"Auth"}),e(_e,{href:"/settings",children:"Settings"})]})]}),e("div",{class:"flex items-center space-x-4",children:e("a",{href:"/api/docs/swagger",target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"📚 API Docs"})})]})})}),e("main",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r})]})}function _e({href:r,children:t}){return e(an,{href:r,class:nn("inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium","hover:border-gray-300 hover:text-gray-700","border-transparent text-gray-500"),activeClassName:"border-indigo-500 text-gray-900",children:t})}const R=window.location.origin;function cn(){window.location.pathname!=="/auth/login"&&(console.warn("Authentication required, redirecting to login..."),window.location.href="/auth/login")}async function M(r,t={}){const n=await fetch(r,t);if(n.status===401)throw cn(),new Error("Authentication required");return n}const B={async health(){return(await M(`${R}/api/health`)).json()},async getItems(){const r=await M(`${R}/api/items`);if(!r.ok)throw new Error("Failed to fetch items");return r.json()},async createItem(r){const t=await M(`${R}/api/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw new Error("Failed to create item");return t.json()},async updateItem(r,t){const n=await M(`${R}/api/items/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to update item");return n.json()},async deleteItem(r){const t=await M(`${R}/api/items/${r}`,{method:"DELETE"});if(!t.ok)throw new Error("Failed to delete item");return t.json()},async getTables(){const r=await M(`${R}/api/tables`);if(!r.ok)throw new Error("Failed to fetch tables");return r.json()},async getTableSchema(r){const t=await M(`${R}/api/tables/${r}/schema`);if(!t.ok)throw new Error("Failed to fetch table schema");return t.json()},async getTableData(r,t=100,n=0){const i=await M(`${R}/api/tables/${r}/data?limit=${t}&offset=${n}`);if(!i.ok)throw new Error("Failed to fetch table data");return i.json()},async createTable(r,t){const n=await M(`${R}/api/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,columns:t})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to create table")}return n.json()},async dropTable(r){const t=await M(`${R}/api/tables/${r}`,{method:"DELETE"});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to drop table")}return t.json()},async executeSQL(r,t=[]){const n=await M(`${R}/api/tables/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:r,params:t})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to execute SQL")}return n.json()},async addColumn(r,t){const n=await M(`${R}/api/tables/${r}/columns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to add column")}return n.json()},async renameColumn(r,t,n){const i=await M(`${R}/api/tables/${r}/columns/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldName:t,newName:n})});if(!i.ok){const a=await i.json();throw new Error(a.error||"Failed to rename column")}return i.json()},async dropColumn(r,t){const n=await M(`${R}/api/tables/${r}/columns/${t}`,{method:"DELETE"});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to drop column")}return n.json()},async modifyColumn(r,t,n){const i=await M(`${R}/api/tables/${r}/columns/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const a=await i.json();throw new Error(a.error||"Failed to modify column")}return i.json()},async validateColumnChanges(r,t,n){const i=await M(`${R}/api/tables/${r}/columns/${t}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const a=await i.json();throw new Error(a.error||"Failed to validate column changes")}return i.json()},async updateRecord(r,t,n){const i=await M(`${R}/api/tables/${r}/data/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const a=await i.json();throw new Error(a.error||"Failed to update record")}return i.json()},async getSnapshots(r=20,t=0){const n=await M(`${R}/api/snapshots?limit=${r}&offset=${t}`);if(!n.ok)throw new Error("Failed to fetch snapshots");return n.json()},async getSnapshot(r){const t=await M(`${R}/api/snapshots/${r}`);if(!t.ok)throw new Error("Failed to fetch snapshot");return t.json()},async createSnapshot(r){const t=await M(`${R}/api/snapshots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to create snapshot")}return t.json()},async restoreSnapshot(r){const t=await M(`${R}/api/snapshots/${r}/restore`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){const n=await t.json().catch(()=>({error:"Failed to restore snapshot"}));throw new Error(n.error||"Failed to restore snapshot")}return t.json()},async deleteSnapshot(r){const t=await M(`${R}/api/snapshots/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok){const n=await t.json().catch(()=>({error:"Failed to delete snapshot"}));throw new Error(n.error||"Failed to delete snapshot")}return t.json()},async compareSnapshots(r,t){const n=await M(`${R}/api/snapshots/compare/${r}/${t}`);if(!n.ok)throw new Error("Failed to compare snapshots");return n.json()},async getTableIndexes(r){const t=await M(`${R}/api/tables/${r}/indexes`);if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to fetch table indexes")}return t.json()},async getAllIndexes(){const r=await M(`${R}/api/tables/indexes`);if(!r.ok){const t=await r.json();throw new Error(t.error||"Failed to fetch all indexes")}return r.json()},async createIndex(r,t){const n=await M(`${R}/api/tables/${r}/indexes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to create index")}return n.json()},async dropIndex(r,t){const n=await M(`${R}/api/tables/${r}/indexes/${t}`,{method:"DELETE"});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to drop index")}return n.json()},async getOAuthProviders(){const r=await M(`${R}/api/admin/oauth/providers`);if(!r.ok){let t="Failed to fetch OAuth providers";try{const n=await r.json();n.error==="Authentication required"?t="Admin authentication required. Please log in to access OAuth settings.":t=n.error||t}catch{}throw new Error(t)}return r.json()},async getOAuthProvider(r){const t=await M(`${R}/api/admin/oauth/providers/${r}`);if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to fetch OAuth provider")}return t.json()},async updateOAuthProvider(r,t){const n=await M(`${R}/api/admin/oauth/providers/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to update OAuth provider")}return n.json()},async toggleOAuthProvider(r,t){const n=await M(`${R}/api/admin/oauth/providers/${r}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_enabled:t})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to toggle OAuth provider")}return n.json()},async deleteOAuthProvider(r){const t=await M(`${R}/api/admin/oauth/providers/${r}`,{method:"DELETE"});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to delete OAuth provider")}return t.json()},async getSupportedProviders(){const r=await M(`${R}/api/admin/oauth/supported-providers`);if(!r.ok){let t="Failed to fetch supported providers";try{const n=await r.json();n.error==="Authentication required"?t="Admin authentication required. Please log in to access OAuth settings.":t=n.error||t}catch{}throw new Error(t)}return r.json()},async getTablePolicy(r){const t=await M(`${R}/api/tables/${r}/policy`);if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to get table policy")}return t.json()},async updateTablePolicy(r,t){const n=await M(`${R}/api/tables/${r}/policy`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_policy:t})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to update table policy")}return n.json()}};function dn({supportedProvider:r,configuredProvider:t,onUpdate:n}){const[i,a]=y(!1),[o,l]=y(!1),[g,w]=y({client_id:(t==null?void 0:t.client_id)||"",client_secret:(t==null?void 0:t.client_secret)||"",is_enabled:(t==null?void 0:t.is_enabled)||!1,scopes:(t==null?void 0:t.scopes)||r.default_scopes}),[x,$]=y(!1),[d,k]=y(null),p=!!t,v=(t==null?void 0:t.is_enabled)||!1,T=async()=>{if(!g.client_id||!g.client_secret){k("Client ID and Client Secret are required");return}l(!0),k(null);try{await B.updateOAuthProvider(r.provider,g),a(!1),n()}catch(F){k(F instanceof Error?F.message:"Failed to save provider")}finally{l(!1)}},m=async()=>{if(p){l(!0),k(null);try{await B.toggleOAuthProvider(r.provider,!v),n()}catch(F){k(F instanceof Error?F.message:"Failed to toggle provider")}finally{l(!1)}}},N=async()=>{if(!(!p||!confirm(`Are you sure you want to delete the ${r.name} OAuth configuration?`))){l(!0),k(null);try{await B.deleteOAuthProvider(r.provider),n()}catch(F){k(F instanceof Error?F.message:"Failed to delete provider")}finally{l(!1)}}};return e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("div",{class:"flex items-start justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("div",{class:"w-8 h-8 flex items-center justify-center",children:(F=>({google:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),github:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}),facebook:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#1877F2",children:e("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),linkedin:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#0A66C2",children:e("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),twitter:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),apple:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})}),microsoft:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M0 0h11.377v11.372H0z",fill:"#F25022"}),e("path",{d:"M12.623 0H24v11.372H12.623z",fill:"#7FBA00"}),e("path",{d:"M0 12.628h11.377V24H0z",fill:"#00A4EF"}),e("path",{d:"M12.623 12.628H24V24H12.623z",fill:"#FFB900"})]}),discord:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#5865F2",children:e("path",{d:"M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419-.0190 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9460 2.4189-2.1568 2.4189Z"})}),slack:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M5.042 15.165a2.528 2.528 0 01-2.52 2.523A2.528 2.528 0 010 15.165a2.527 2.527 0 012.522-2.52h2.52v2.52z",fill:"#E01E5A"}),e("path",{d:"M6.313 15.165a2.527 2.527 0 012.521-2.52 2.527 2.527 0 012.521 2.52v6.313A2.528 2.528 0 018.834 24a2.528 2.528 0 01-2.521-2.522v-6.313z",fill:"#E01E5A"}),e("path",{d:"M8.834 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 018.834 0a2.528 2.528 0 012.521 2.522v2.52H8.834z",fill:"#36C5F0"}),e("path",{d:"M8.834 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521H2.522A2.528 2.528 0 010 8.834a2.528 2.528 0 012.522-2.521h6.312z",fill:"#36C5F0"}),e("path",{d:"M18.956 8.834a2.528 2.528 0 012.521-2.521A2.528 2.528 0 0124 8.834a2.528 2.528 0 01-2.523 2.521h-2.521V8.834z",fill:"#2EB67D"}),e("path",{d:"M17.688 8.834a2.528 2.528 0 01-2.523 2.521 2.527 2.527 0 01-2.52-2.521V2.522A2.527 2.527 0 0115.165 0a2.528 2.528 0 012.523 2.522v6.312z",fill:"#2EB67D"}),e("path",{d:"M15.165 18.956a2.528 2.528 0 012.523 2.521A2.528 2.528 0 0115.165 24a2.527 2.527 0 01-2.52-2.523v-2.521h2.52z",fill:"#ECB22E"}),e("path",{d:"M15.165 17.688a2.527 2.527 0 01-2.52-2.523 2.526 2.526 0 012.52-2.52h6.313A2.527 2.527 0 0124 15.165a2.528 2.528 0 01-2.522 2.523h-6.313z",fill:"#ECB22E"})]})})[F]||e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}))(r.provider)}),e("div",{children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:r.name}),e("div",{class:"flex items-center gap-2 mt-1",children:[e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p?v?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:p?v?"Enabled":"Disabled":"Not Configured"}),r.note&&e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:r.note})]})]})]}),e("div",{class:"flex items-center gap-2",children:[p&&e("button",{onClick:m,disabled:o,class:`px-3 py-1 text-sm rounded-md font-medium transition-colors ${v?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"} disabled:opacity-50`,children:v?"Disable":"Enable"}),e("button",{onClick:()=>a(!i),disabled:o,class:"px-3 py-1 text-sm rounded-md font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors disabled:opacity-50",children:i?"Cancel":p?"Edit":"Configure"})]})]}),d&&e("div",{class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:d})}),i?e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),e("input",{type:"text",value:g.client_id,onInput:F=>w({...g,client_id:F.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client ID"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),e("div",{class:"relative",children:[e("input",{type:x?"text":"password",value:g.client_secret,onInput:F=>w({...g,client_secret:F.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client Secret"}),e("button",{type:"button",onClick:()=>$(!x),class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:x?"👁️":"👁️‍🗨️"})]})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{class:"flex flex-wrap gap-2",children:g.scopes.map((F,S)=>e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:F},S))})]}),e("div",{class:"flex items-center gap-3 pt-4",children:[e("button",{onClick:T,disabled:o,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Saving...":"Save Configuration"}),p&&e("button",{onClick:N,disabled:o,class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]}):e("div",{class:"space-y-3",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Setup Instructions:"}),e("p",{class:"mt-1",children:r.setup_instructions})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"OAuth Callback URL for Provider:"}),e("br",{}),e("code",{class:"px-2 py-1 bg-gray-100 rounded text-xs",children:[window.location.origin,"/api/auth/callback/",r.provider]}),e("p",{class:"mt-1 text-xs text-gray-500",children:"Use this URL when configuring your OAuth application with the provider. After authentication, users will be redirected to your app based on the callback URLs you configure in your application settings."})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Default Scopes:"}),e("div",{class:"flex flex-wrap gap-1 mt-1",children:r.default_scopes.map((F,S)=>e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:F},S))})]}),p&&e("div",{class:"pt-2 border-t border-gray-100",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Status:"})," Configured and ",v?"enabled":"disabled"]}),t&&e("div",{class:"text-sm text-gray-600 mt-1",children:[e("strong",{children:"Last updated:"})," ",new Date(t.updated_at).toLocaleDateString()]})]})]})]})}function un(){const[r,t]=y([]),[n,i]=y(""),[a,o]=y(!0),[l,g]=y(!1),[w,x]=y(null),$=async()=>{try{o(!0),x(null);const T=await fetch("/api/app-settings",{credentials:"include"});if(!T.ok)throw new Error("Failed to load app settings");const m=await T.json();t(m.settings.allowed_callback_urls||[])}catch(T){console.error("Failed to load callback URLs:",T),x(T instanceof Error?T.message:"Failed to load callback URLs")}finally{o(!1)}},d=async T=>{try{if(g(!0),x(null),!(await fetch("/api/app-settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({allowed_callback_urls:T})})).ok)throw new Error("Failed to save callback URLs");t(T)}catch(m){console.error("Failed to save callback URLs:",m),x(m instanceof Error?m.message:"Failed to save callback URLs")}finally{g(!1)}},k=async()=>{if(!n.trim())return;const T=[...r,n.trim()];await d(T),i("")},p=async T=>{const m=r.filter((N,j)=>j!==T);await d(m)},v=T=>{T.key==="Enter"&&(T.preventDefault(),k())};return he(()=>{$()},[]),a?e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading callback URLs..."})}):e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"Allowed Callback URLs"}),e("p",{class:"text-gray-600 mt-2",children:"Configure URLs where users can be redirected after OAuth authentication. Supports web URLs (https://), mobile deep links (myapp://), and localhost for development."})]}),w&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:w})}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:"Add Callback URL"}),e("div",{class:"flex gap-3",children:[e("input",{type:"text",value:n,onInput:T=>i(T.target.value),onKeyPress:v,placeholder:"https://myapp.com/auth/callback or myapp://auth/callback",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e("button",{onClick:k,disabled:!n.trim()||l,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Adding...":"Add URL"})]})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:["Configured URLs (",r.length,")"]}),r.length===0?e("div",{class:"text-center py-8 text-gray-500",children:[e("p",{class:"mb-2",children:"No callback URLs configured"}),e("p",{class:"text-sm",children:"When no URLs are configured, any callback URL will be allowed (for backward compatibility)"})]}):e("div",{class:"space-y-3",children:r.map((T,m)=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex-1",children:[e("code",{class:"text-sm text-gray-800",children:T}),e("div",{class:"text-xs text-gray-500 mt-1",children:T.startsWith("https://")?"🌐 Web App":T.startsWith("http://localhost")||T.startsWith("http://127.0.0.1")?"🔧 Development":T.includes("://")?"📱 Mobile/Desktop App":"❓ Unknown"})]}),e("button",{onClick:()=>p(m),disabled:l,class:"ml-3 text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50",children:"Remove"})]},m))})]}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-blue-900 mb-3",children:"URL Format Examples"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:[e("strong",{children:"Web Applications:"})," ",e("code",{children:"https://myapp.com/auth/callback"})]}),e("p",{children:[e("strong",{children:"Mobile Apps:"})," ",e("code",{children:"myapp://auth/callback"})," or"," ",e("code",{children:"com.example.myapp://callback"})]}),e("p",{children:[e("strong",{children:"Desktop Apps:"})," ",e("code",{children:"myapp://localhost/callback"})]}),e("p",{children:[e("strong",{children:"Development:"})," ",e("code",{children:"http://localhost:3000/callback"})," or"," ",e("code",{children:"http://127.0.0.1:8080/auth"})]})]})]}),e("div",{class:"mt-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-gray-900 mb-3",children:"API Usage"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("p",{children:e("strong",{children:"Login with callback:"})}),e("code",{class:"block bg-white p-2 rounded border",children:"GET /api/auth/login/google?callback_url=https://myapp.com/auth/callback"}),e("p",{class:"mt-3",children:e("strong",{children:"The callback response includes:"})}),e("code",{class:"block bg-white p-2 rounded border text-xs",children:JSON.stringify({success:!0,access_token:"...",refresh_token:"...",user:{id:"...",email:"...",name:"..."},return_url:"https://myapp.com/auth/callback"},null,2)})]})]})]})}function hn(){const[r,t]=y("providers"),[n,i]=y([]),[a,o]=y([]),[l,g]=y(!0),[w,x]=y(null),$=async()=>{g(!0),x(null);try{const[v,T]=await Promise.all([B.getSupportedProviders(),B.getOAuthProviders()]);i(v.supported_providers),o(T.providers)}catch(v){x(v instanceof Error?v.message:"Failed to load OAuth providers"),console.error("Error loading OAuth providers:",v)}finally{g(!1)}};he(()=>{$()},[]);const d=v=>a.find(T=>T.provider===v),k=a.filter(v=>v.is_enabled).length,p=a.length;return l?e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading OAuth providers..."})})]}):e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{onClick:()=>t("providers"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="providers"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"OAuth Providers"}),e("button",{onClick:()=>t("callback-urls"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="callback-urls"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Callback URLs"})]})}),e("div",{class:"flex-1 min-w-0",children:[r==="providers"&&e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"OAuth Providers"}),e("p",{class:"text-gray-600 mt-2",children:"Configure OAuth providers to enable user authentication in your applications"})]}),w&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-sm text-red-600",children:w}),w.includes("authentication required")?e("div",{class:"mt-3",children:[e("p",{class:"text-sm text-red-700 mb-2",children:"You need to log in as an administrator to manage OAuth settings."}),e("a",{href:"/",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Go to Dashboard"})]}):e("button",{onClick:$,class:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]}),e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-gray-900",children:n.length}),e("div",{class:"text-sm text-gray-600",children:"Supported Providers"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-blue-600",children:p}),e("div",{class:"text-sm text-gray-600",children:"Configured"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-green-600",children:k}),e("div",{class:"text-sm text-gray-600",children:"Enabled"})]})]}),e("div",{class:"space-y-6",children:n.map(v=>e(dn,{supportedProvider:v,configuredProvider:d(v.provider),onUpdate:$},v.provider))}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-blue-900 mb-3",children:"Getting Started"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:["1. ",e("strong",{children:"Choose a provider:"}),' Click "Configure" on any OAuth provider you want to enable']}),e("p",{children:["2. ",e("strong",{children:"Create OAuth app:"})," Follow the setup instructions to create an OAuth application"]}),e("p",{children:["3. ",e("strong",{children:"Configure credentials:"})," Enter your Client ID and Client Secret"]}),e("p",{children:["4. ",e("strong",{children:"Enable provider:"}),' Toggle the provider to "Enabled" status']}),e("p",{children:["5. ",e("strong",{children:"Test authentication:"})," Users can now authenticate with this provider"]})]})]}),e("div",{class:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900 mb-3",children:"Authentication Endpoints"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("div",{children:[e("strong",{children:"Available providers:"})," ",e("code",{children:"GET /api/auth/providers"})]}),e("div",{children:[e("strong",{children:"Start authentication:"})," ",e("code",{children:["GET /api/auth/login/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"OAuth callback:"})," ",e("code",{children:["GET /api/auth/callback/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"Get user info:"})," ",e("code",{children:"GET /api/auth/me"})]}),e("div",{children:[e("strong",{children:"Refresh token:"})," ",e("code",{children:"POST /api/auth/refresh"})]}),e("div",{children:[e("strong",{children:"Logout:"})," ",e("code",{children:"POST /api/auth/logout"})]})]})]})]}),r==="callback-urls"&&e(un,{})]})]})]})}function mn(){const[r,t]=y([]),[n,i]=y(null),[a,o]=y(!1),[l,g]=y(!1),[w,x]=y(!0),[$,d]=y(null),[k,p]=y({}),[v,T]=y({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),m=f=>{if(!f.trim())return Date.now().toString(36).slice(-8).padStart(8,"0");let _=f.length+1e3;for(let q=0;q<f.length;q++){const ae=f.charCodeAt(q);_=_*31+ae,_=_&2147483647}let L="",U=_;for(let q=0;q<8;q++){U=U*1664525+1013904223&2147483647;const ae=U%36;L+=ae.toString(36)}return L},N=f=>{const _=/:(\w+)/g,L=new Set;let U;for(;(U=_.exec(f))!==null;)L.add(U[1]);return Array.from(L).map(q=>({name:q,type:"string",required:!0,description:""}))},j=f=>{const _=f.trim().toLowerCase(),L=_.startsWith("select"),U=_.includes("pragma");return{method:L?"GET":"POST",readonly:L||U}},F=()=>{const f={};if(v.name.trim()||(f.name="クエリ名は必須です"),v.slug.trim()?/^[a-z0-9_-]+$/.test(v.slug)||(f.slug="スラッグは小文字の英数字、ハイフン、アンダースコアのみ使用できます"):f.slug="スラッグは必須です",!v.sql_query.trim())f.sql_query="SQLクエリは必須です";else{const _=/:(\w+)/g,L=new Set;let U;for(;(U=_.exec(v.sql_query))!==null;)L.add(U[1]);const q=new Set(v.parameters.map(ge=>ge.name)),ae=Array.from(L).filter(ge=>!q.has(ge));ae.length>0&&(f.sql_query=`SQLに未定義のパラメーターが含まれています: ${ae.join(", ")}`)}return v.parameters.forEach((_,L)=>{_.name.trim()?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(_.name)||(f[`parameter_${L}_name`]="パラメーター名は英文字またはアンダースコアで始まり、英数字とアンダースコアのみ使用できます"):f[`parameter_${L}_name`]="パラメーター名は必須です"}),p(f),Object.keys(f).length===0},[S,K]=y({}),[z,te]=y(null),[W,re]=y(null),[le,G]=y(!1);he(()=>{I()},[]);const I=async()=>{try{const f=await fetch("/api/custom-queries");if(!f.ok)throw new Error("Failed to fetch queries");const _=await f.json();t(_.queries)}catch(f){d(f instanceof Error?f.message:"Failed to fetch queries")}finally{x(!1)}},de=async()=>{if(d(null),p({}),!!F())try{const f=await fetch("/api/custom-queries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!f.ok){const L=(await f.json()).error||"Failed to create query";if(L.includes("slug already exists")){p({slug:"このスラッグは既に使用されています"});return}throw new Error(L)}await I(),o(!1),c()}catch(f){d(f instanceof Error?f.message:"Failed to create query")}},X=async()=>{if(n&&(d(null),p({}),!!F()))try{const f=await fetch(`/api/custom-queries/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!f.ok){const L=(await f.json()).error||"Failed to update query";if(L.includes("slug already exists")){p({slug:"このスラッグは既に使用されています"});return}throw new Error(L)}await I(),g(!1),i(null),c()}catch(f){d(f instanceof Error?f.message:"Failed to update query")}},pe=async f=>{if(confirm("Are you sure you want to delete this query?"))try{if(!(await fetch(`/api/custom-queries/${f}`,{method:"DELETE"})).ok)throw new Error("Failed to delete query");await I(),(n==null?void 0:n.id)===f&&i(null)}catch(_){d(_ instanceof Error?_.message:"Failed to delete query")}},E=async()=>{if(n){G(!0),te(null),re(null);try{const f=await fetch(`/api/custom-queries/${n.id}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parameters:S})}),_=await f.json();if(!f.ok)throw new Error(_.error||"Failed to test query");te(_)}catch(f){re(f instanceof Error?f.message:"Failed to test query")}finally{G(!1)}}},c=()=>{T({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),p({}),d(null)},P=()=>{T({...v,parameters:[...v.parameters,{name:"",type:"string",required:!1}]})},ne=f=>{T({...v,parameters:v.parameters.filter((_,L)=>L!==f)})},O=(f,_)=>{if(T({...v,parameters:v.parameters.map((L,U)=>U===f?{...L,..._}:L)}),_.name!==void 0){const L=`parameter_${f}_name`;k[L]&&p(U=>{const q={...U};return delete q[L],q})}};return w?e("div",{class:"flex justify-center items-center h-64",children:e("div",{class:"text-gray-500",children:"Loading custom queries..."})}):e("div",{class:"space-y-6",children:[e("div",{class:"flex justify-between items-center",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Custom SQL APIs"}),e("button",{onClick:()=>o(!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Create Query"})]}),$&&e("div",{class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:$}),e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e("div",{class:"bg-white shadow rounded-lg p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Queries"}),e("div",{class:"space-y-2",children:r.length===0?e("p",{class:"text-gray-500",children:"No custom queries yet"}):r.map(f=>e("div",{class:`p-3 border rounded cursor-pointer hover:bg-gray-50 ${(n==null?void 0:n.id)===f.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>{const _={...f,parameters:typeof f.parameters=="string"?JSON.parse(f.parameters||"[]"):f.parameters||[]};i(_),K({}),te(null),re(null)},children:e("div",{class:"flex justify-between items-start",children:[e("div",{children:[e("h4",{class:"font-medium text-gray-900",children:f.name}),e("p",{class:"text-sm text-gray-500",children:["/",f.slug]}),e("div",{class:"flex gap-2 mt-1",children:[e("span",{class:`text-xs px-2 py-1 rounded ${f.method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:f.method}),e("span",{class:`text-xs px-2 py-1 rounded ${f.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:f.enabled?"Enabled":"Disabled"}),f.is_readonly&&e("span",{class:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-800",children:"Read-only"})]})]}),e("div",{class:"flex gap-2",children:[e("button",{onClick:_=>{_.stopPropagation(),i(f),T({slug:f.slug,name:f.name,description:f.description||"",sql_query:f.sql_query,parameters:f.parameters||[],cache_ttl:f.cache_ttl,enabled:!!f.enabled}),g(!0)},class:"text-indigo-600 hover:text-indigo-800",children:"Edit"}),e("button",{onClick:_=>{_.stopPropagation(),pe(f.id)},class:"text-red-600 hover:text-red-800",children:"Delete"})]})]})},f.id))})]}),e("div",{class:"bg-white shadow rounded-lg p-6",children:n?e("div",{class:"space-y-4",children:[e("div",{children:[e("h3",{class:"text-lg font-medium text-gray-900",children:n.name}),n.description&&e("p",{class:"text-gray-600 mt-1",children:n.description}),e("p",{class:"text-sm text-gray-500 mt-2",children:["Endpoint:"," ",e("code",{class:"bg-gray-100 px-1 py-0.5 rounded",children:[n.method," /api/custom/",n.slug]})]})]}),e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"SQL Query"}),e("pre",{class:"bg-gray-50 p-3 rounded text-sm overflow-x-auto",children:n.sql_query})]}),n.parameters&&Array.isArray(n.parameters)&&n.parameters.length>0&&e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"Parameters"}),e("div",{class:"space-y-2",children:n.parameters.map(f=>e("div",{class:"flex items-center gap-2",children:[e("label",{class:"text-sm font-medium text-gray-700 w-32",children:[f.name,f.required&&e("span",{class:"text-red-500",children:"*"})]}),e("input",{type:f.type==="number"?"number":"text",value:S[f.name]||"",onChange:_=>K({...S,[f.name]:_.currentTarget.value}),placeholder:f.default?`Default: ${f.default}`:"",class:"flex-1 px-3 py-1 border border-gray-300 rounded-md"}),e("span",{class:"text-xs text-gray-500",children:f.type})]},f.name))})]}),e("button",{onClick:E,disabled:le,class:"w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:le?"Testing...":"Test Query"}),W&&e("div",{class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:W}),z&&e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"Test Results"}),e("div",{class:"text-sm text-gray-600 mb-2",children:["Rows: ",z.row_count," | Time: ",z.execution_time,"ms"]}),e("div",{class:"bg-gray-50 p-3 rounded overflow-x-auto",children:e("pre",{class:"text-sm",children:JSON.stringify(z.data,null,2)})})]})]}):e("div",{class:"text-center text-gray-500",children:"Select a query to view details"})})]}),(a||l)&&e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:a?"Create Custom Query":"Edit Custom Query"}),$&&e("div",{class:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:$}),e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{type:"text",value:v.name,onChange:f=>{const _=f.currentTarget.value;T({...v,name:_,slug:a?m(_):v.slug}),p(L=>{const U={...L};return delete U.name,a&&delete U.slug,U})},class:`mt-1 w-full px-3 py-2 border rounded-md ${k.name?"border-red-500 bg-red-50":"border-gray-300"}`}),k.name&&e("p",{class:"mt-1 text-sm text-red-600",children:k.name})]}),e("div",{children:[e("div",{class:"flex justify-between items-center",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:["Slug",e("span",{class:"text-xs text-gray-500",children:"(auto-generated, but editable)"})]}),e("button",{type:"button",onClick:()=>{T({...v,slug:m(v.name)}),p(f=>{const{slug:_,...L}=f;return L})},class:"text-xs text-indigo-600 hover:text-indigo-800",children:"Re-generate from name"})]}),e("input",{type:"text",value:v.slug,onChange:f=>{T({...v,slug:f.currentTarget.value}),k.slug&&p(_=>{const{slug:L,...U}=_;return U})},placeholder:"lowercase-with-hyphens",class:`mt-1 w-full px-3 py-2 border rounded-md ${k.slug?"border-red-500 bg-red-50":"border-gray-300"}`}),k.slug&&e("p",{class:"mt-1 text-sm text-red-600",children:k.slug}),e("p",{class:"mt-1 text-sm text-gray-500",children:["This will be the API endpoint: /api/custom/",v.slug||"a1b2c3d4"]})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Description"}),e("input",{type:"text",value:v.description,onChange:f=>T({...v,description:f.currentTarget.value}),class:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"SQL Query"}),e("textarea",{value:v.sql_query,onChange:f=>{const _=f.currentTarget.value,L=N(_),U=new Set(v.parameters.map(ae=>ae.name)),q=[...v.parameters.filter(ae=>_.includes(`:${ae.name}`)),...L.filter(ae=>!U.has(ae.name))];T({...v,sql_query:_,parameters:q}),k.sql_query&&p(ae=>{const{sql_query:ge,...oe}=ae;return oe})},rows:6,placeholder:"SELECT * FROM users WHERE created_at > :start_date",class:`mt-1 w-full px-3 py-2 border rounded-md font-mono text-sm ${k.sql_query?"border-red-500 bg-red-50":"border-gray-300"}`}),k.sql_query&&e("p",{class:"mt-1 text-sm text-red-600",children:k.sql_query}),e("div",{class:"mt-2 flex justify-between items-center",children:[e("p",{class:"text-sm text-gray-500",children:"Use :parameter_name for parameters (will be auto-detected)"}),v.sql_query&&e("div",{class:"flex gap-2",children:[e("span",{class:`px-2 py-1 rounded text-xs ${j(v.sql_query).method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:j(v.sql_query).method}),j(v.sql_query).readonly&&e("span",{class:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-800",children:"Read-only"})]})]})]}),e("div",{children:[e("div",{class:"flex justify-between items-center mb-2",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:["Parameters",v.parameters.length>0&&e("span",{class:"text-xs text-gray-500 ml-1",children:["(",v.parameters.length," detected)"]})]}),e("button",{type:"button",onClick:P,class:"text-sm text-indigo-600 hover:text-indigo-800",children:"Add Parameter"})]}),v.parameters.length===0?e("div",{class:"text-sm text-gray-500 bg-gray-50 p-3 rounded border-2 border-dashed border-gray-200",children:"No parameters detected. Use :param_name in your SQL query to automatically add parameters here."}):v.parameters.map((f,_)=>e("div",{class:"mb-3",children:[e("div",{class:"flex gap-2 mb-1",children:[e("input",{type:"text",value:f.name,onChange:L=>O(_,{name:L.currentTarget.value}),placeholder:"param_name",class:`flex-1 px-3 py-1 border rounded-md text-sm ${k[`parameter_${_}_name`]?"border-red-500 bg-red-50":"border-gray-300"}`}),e("select",{value:f.type,onChange:L=>O(_,{type:L.currentTarget.value}),class:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e("option",{value:"string",children:"String"}),e("option",{value:"number",children:"Number"}),e("option",{value:"boolean",children:"Boolean"}),e("option",{value:"date",children:"Date"})]}),e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:f.required,onChange:L=>O(_,{required:L.currentTarget.checked}),class:"mr-1"}),e("span",{class:"text-sm",children:"Required"})]}),e("button",{type:"button",onClick:()=>ne(_),class:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),k[`parameter_${_}_name`]&&e("p",{class:"text-xs text-red-600 ml-1",children:k[`parameter_${_}_name`]})]},_))]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Cache TTL (seconds)"}),e("input",{type:"number",value:v.cache_ttl,onChange:f=>T({...v,cache_ttl:parseInt(f.currentTarget.value)||0}),class:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:v.enabled,onChange:f=>T({...v,enabled:f.currentTarget.checked}),class:"mr-2"}),e("span",{class:"text-sm font-medium text-gray-700",children:"Enabled"})]})})]}),e("div",{class:"flex justify-end gap-2 mt-6",children:[e("button",{onClick:()=>{o(!1),g(!1),c()},class:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{onClick:a?de:X,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:a?"Create":"Update"})]})]})})]})}function et({size:r="sm"}){return e("svg",{class:`animate-spin ${r==="sm"?"h-4 w-4":"h-6 w-6"} text-white`,fill:"none",viewBox:"0 0 24 24",children:[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}function pn({onClose:r,onRestore:t}){const[n,i]=y([]),[a,o]=y(null),[l,g]=y(!0),[w,x]=y(null),[$,d]=y(!1),[k,p]=y({name:"",description:""}),[v,T]=y(null),[m,N]=y(null),[j,F]=y(null),[S,K]=y(!1),[z,te]=y(!1),[W,re]=y(!1);he(()=>{le()},[]),he(()=>{const E=c=>{if(j){const P=c.target;!P.closest("[data-menu-container]")&&!P.closest("[data-menu-button]")&&F(null)}};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[j]);const le=async()=>{try{g(!0),x(null);const E=await B.getSnapshots();i(E.snapshots)}catch(E){x(E instanceof Error?E.message:"Failed to load data")}finally{g(!1)}},G=async E=>{E.preventDefault();try{x(null),K(!0),await B.createSnapshot(k),d(!1),p({name:"",description:""}),await le()}catch(c){x(c instanceof Error?c.message:"Failed to create snapshot")}finally{K(!1)}},I=async()=>{if(v)try{x(null),te(!0),await B.restoreSnapshot(v),T(null),t&&t(),r()}catch(E){x(E instanceof Error?E.message:"Failed to restore"),T(null)}finally{te(!1)}},de=async()=>{if(m)try{x(null),re(!0),await B.deleteSnapshot(m),N(null),F(null),await le()}catch(E){x(E instanceof Error?E.message:"Failed to delete snapshot"),N(null)}finally{re(!1)}},X=E=>new Date(E).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZoneName:"short"}),pe=E=>{const c=new Date(E),ne=new Date().getTime()-c.getTime(),O=Math.floor(ne/(1e3*60*60*24)),f=Math.floor(ne%(1e3*60*60*24)/(1e3*60*60));return O>0?`${O} day${O>1?"s":""} ago`:f>0?`${f} hour${f>1?"s":""} ago`:"Just now"};return e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e("div",{class:"px-6 py-4 border-b flex items-center justify-between",children:[e("h2",{class:"text-xl font-semibold text-gray-900",children:"Schema Snapshots"}),e("button",{onClick:r,class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})})})]}),w&&e("div",{class:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:e("div",{class:"text-sm text-red-700",children:w})}),e("div",{class:"mx-6 mt-4 bg-blue-50 border border-blue-200 rounded-md p-4",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})})}),e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-blue-800",children:"💡 CloudflareのTime Travel機能について"}),e("p",{class:"mt-1 text-sm text-blue-700",children:["Cloudflareの管理画面から、D1データベースを過去の任意の時点（無料プランで7日間、有料プランで30日間）に復元できるTime Travel機能が利用可能です。 詳しくは",e("a",{href:"https://developers.cloudflare.com/d1/reference/time-travel/",target:"_blank",rel:"noopener noreferrer",class:"font-medium underline hover:no-underline",children:"Cloudflare D1 Time Travelドキュメント"}),"をご確認ください。"]})]})]})}),e("div",{class:"flex-1 overflow-auto p-6",children:l?e("div",{class:"text-center py-8",children:e("div",{class:"text-gray-500",children:"Loading..."})}):e("div",{children:[!$&&e("div",{class:"mb-6",children:e("button",{onClick:()=>d(!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})}),"Create Snapshot"]})}),$&&e("div",{class:"mb-6 bg-gray-50 rounded-lg p-4",children:[e("h3",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Snapshot"}),e("form",{onSubmit:G,children:e("div",{class:"space-y-3",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{type:"text",value:k.name,onInput:E=>p({...k,name:E.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., Before major refactoring"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Description"}),e("textarea",{value:k.description,onInput:E=>p({...k,description:E.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",rows:2,placeholder:"Optional description of current state"})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",disabled:S,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${S?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:[S&&e(et,{size:"sm"}),e("span",{children:S?"Creating...":"Create"})]}),e("button",{type:"button",onClick:()=>{d(!1),p({name:"",description:""})},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})})]}),e("div",{class:"space-y-3",children:n.length===0?e("div",{class:"text-center py-8 text-gray-500",children:"No snapshots yet. Create your first snapshot to start tracking schema changes."}):n.map(E=>e("div",{class:`border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer ${(a==null?void 0:a.id)===E.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>o(E),children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-3",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:E.name||`Snapshot v${E.version}`}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E.snapshotType==="manual"?"bg-blue-100 text-blue-800":E.snapshotType==="auto"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:E.snapshotType})]}),E.description&&e("p",{class:"mt-1 text-sm text-gray-600",children:E.description}),e("div",{class:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e("span",{children:["Version ",E.version]}),e("span",{children:X(E.createdAt)}),e("span",{children:pe(E.createdAt)})]})]}),e("div",{class:"ml-4 flex items-center space-x-2",children:[e("button",{onClick:c=>{c.stopPropagation(),T(E.id)},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Restore"}),e("div",{class:"relative",children:[e("button",{onClick:c=>{c.stopPropagation(),F(j===E.id?null:E.id)},"data-menu-button":"true",class:"inline-flex items-center p-1.5 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-md",children:e("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),j===E.id&&e("div",{class:"absolute right-0 top-full mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10","data-menu-container":"true",children:e("div",{class:"py-1",children:e("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),F(null),N(E.id)},class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 focus:outline-none",children:e("div",{class:"flex items-center space-x-2",children:[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e("span",{children:"Delete"})]})})})})]})]})]})},E.id))})]})}),v&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Confirm Restore"})})]}),e("div",{class:"mb-6",children:[e("p",{class:"text-sm text-gray-700",children:"This will restore your database schema to the selected snapshot. All current tables and data will be replaced."}),e("p",{class:"text-sm text-red-600 mt-2 font-medium",children:"This action cannot be undone. Make sure you have a backup of your current data."})]}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:I,disabled:z,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${z?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[z&&e(et,{size:"sm"}),e("span",{children:z?"Restoring...":"Restore"})]}),e("button",{onClick:()=>T(null),disabled:z,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${z?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})}),m&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Delete Snapshot"})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:"Are you sure you want to delete this snapshot? This action cannot be undone."})}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:de,disabled:W,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${W?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[W&&e(et,{size:"sm"}),e("span",{children:W?"Deleting...":"Delete"})]}),e("button",{onClick:()=>N(null),disabled:W,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${W?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})})]})})}const fn=r=>r?r.length>8?`${r.substring(0,4)}...`:r:"-",gn=["admins","sessions","schema_snapshots","schema_snapshot_counter","d1_migrations","api_keys","user_sessions","oauth_providers","app_settings","table_policies"],tt=r=>r.filter(t=>!gn.includes(t.name)),rt=(r,t)=>{const n=t.filter(i=>i.trim()!=="").join("_");return`idx_${r}_${n}`.toLowerCase()},bn=async r=>{try{return await navigator.clipboard.writeText(r),!0}catch{try{const n=document.createElement("textarea");n.value=r,document.body.appendChild(n),n.focus(),n.select();const i=document.execCommand("copy");return document.body.removeChild(n),i}catch(n){return console.error("Failed to copy to clipboard:",n),!1}}};function yn(){var Ct,Tt,Et,St,Nt;const[r,t]=y([]),[n,i]=y(null),[a,o]=y([]),[l,g]=y([]),[w,x]=y([]),[$,d]=y(!1),[k,p]=y(null),[v,T]=y(!1),[m,N]=y(!1),[j,F]=y({}),[S,K]=y({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),[z,te]=y(null),[W,re]=y(null),[le,G]=y(!1),[I,de]=y({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),[X,pe]=y(null),[E,c]=y(null),[P,ne]=y(null),[O,f]=y(null),[_,L]=y(null),[U,q]=y(null),[ae,ge]=y({}),[oe,Ae]=y({}),Ze=zt(null),je=zt(!1),[Xe,Be]=y(!1),[C,A]=y([]),[se,ce]=y(!1),[ee,xe]=y({name:"",columns:[""],unique:!1}),[bt,yt]=y(null);he(()=>{if(n&&ee.columns.some(s=>s.trim()!=="")){const s=rt(n,ee.columns);xe(u=>({...u,name:s}))}},[n,ee.columns]);const xt=s=>s?new Date(s).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZoneName:"short"}):"-";he(()=>{ze()},[]),he(()=>{n&&(Te(),ye(),T(!1),N(!1),G(!1))},[n]),he(()=>{const s=()=>{te(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const ze=async()=>{try{d(!0);const s=await B.getTables();t(s.tables),p(null)}catch(s){p(s instanceof Error?s.message:"Failed to load tables")}finally{d(!1)}},ye=async()=>{if(n)try{const s=await B.getTableSchema(n);g(s.columns),x(s.foreignKeys||[]);const u=await B.getTableIndexes(n);A(u.indexes);const b={};s.columns.forEach(h=>{["id","created_at","updated_at"].includes(h.name)||(b[h.name]="")}),F(b)}catch(s){console.error("Failed to load table schema:",s)}},Te=async()=>{if(n)try{d(!0);const s=await B.getTableData(n);o(s.data),p(null)}catch(s){p(s instanceof Error?s.message:"Failed to load table data")}finally{d(!1)}},pr=async s=>{if(s.preventDefault(),!!n)try{const u=Object.fromEntries(Object.entries(j).map(([h,D])=>[h,D===""?null:D]));console.log("Sending record data:",u);const b=await fetch(`${window.location.origin}/api/tables/${n}/data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!b.ok){const h=await b.json();throw new Error(h.error||`HTTP ${b.status}: Failed to create record`)}await Te(),T(!1),p(null)}catch(u){if(console.error("Create record error:",u),u instanceof Error){let b=u.message;if(u.message.includes("FOREIGN KEY constraint failed"))b="Foreign key constraint failed: The referenced record does not exist";else if(u.message.includes("NOT NULL constraint failed")){const h=u.message.match(/NOT NULL constraint failed: (\w+)\.(\w+)/);h?b=`Required field "${h[2]}" cannot be empty`:b="A required field cannot be empty"}else if(u.message.includes("UNIQUE constraint failed")){const h=u.message.match(/UNIQUE constraint failed: (\w+)\.(\w+)/);h?b=`Value for "${h[2]}" must be unique`:b="This value must be unique"}p(b)}else p("Failed to create record")}},fr=async s=>{n&&f({title:"Delete Record",message:"Are you sure you want to delete this record? This action cannot be undone.",variant:"danger",onConfirm:async()=>{f(null);try{await fetch(`${window.location.origin}/api/tables/${n}/data/${s}`,{method:"DELETE"}),await Te()}catch(u){p(u instanceof Error?u.message:"Failed to delete record")}}})},gr=async s=>{s.preventDefault();try{const u=S.columns.filter(b=>b.name).map(b=>{var h,D,J;return{name:b.name,type:b.type,constraints:b.notNull?"NOT NULL":void 0,...(h=b.foreignKey)!=null&&h.enabled&&((D=b.foreignKey)!=null&&D.table)&&((J=b.foreignKey)!=null&&J.column)?{foreignKey:{table:b.foreignKey.table,column:b.foreignKey.column}}:{}}});console.log("Creating table:",S.name,"with columns:",u),await B.createTable(S.name,u);for(const b of S.indexes)if(b.name&&b.columns.length>0&&b.columns.some(h=>h.trim()!==""))try{await B.createIndex(S.name,{name:b.name,columns:b.columns.filter(h=>h.trim()!==""),unique:b.unique})}catch(h){console.warn("Failed to create index:",h)}await ze(),N(!1),K({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),p(null)}catch(u){p(u instanceof Error?u.message:"Failed to create table")}},br=async s=>{f({title:"Drop Table",message:`Are you sure you want to drop the table "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{f(null);try{await B.dropTable(s),await ze(),n===s&&(i(null),o([]))}catch(u){p(u instanceof Error?u.message:"Failed to drop table")}}})},yr=async(s,u)=>{try{yt(s),await B.updateTablePolicy(s,u),t(b=>b.map(h=>h.name===s?{...h,access_policy:u}:h)),p(null)}catch(b){p(b instanceof Error?b.message:"Failed to update table policy")}finally{yt(null)}},xr=async(s,u,b)=>{if(await bn(s)){const D=`${u}-${b}`;re(D),setTimeout(()=>re(null),2e3)}},vr=async(s,u,b,h)=>{s.metaKey||s.ctrlKey?await wr(u,h):await xr(u,b,h)},wr=async(s,u)=>{const b=await _r(s,u);b&&(i(b),setTimeout(()=>{const h=document.querySelector(`[data-record-id="${s}"]`);h&&(h.scrollIntoView({behavior:"smooth",block:"center"}),h.classList.add("bg-yellow-100"),setTimeout(()=>h.classList.remove("bg-yellow-100"),2e3))},500))},_r=async(s,u)=>{if(u.endsWith("_id")){const b=`${u.replace("_id","")}s`,h=r.find(D=>D.name===b);if(h)return h.name}for(const b of r)try{if((await B.getTableData(b.name,1,0)).data.some(J=>J.id===s))return b.name}catch{}return null},kr=async s=>{var u,b,h;if(s.preventDefault(),!!n)try{const D={name:I.name,type:I.type,constraints:I.notNull?"NOT NULL":void 0,...(u=I.foreignKey)!=null&&u.enabled&&((b=I.foreignKey)!=null&&b.table)&&((h=I.foreignKey)!=null&&h.column)?{foreignKey:{table:I.foreignKey.table,column:I.foreignKey.column}}:{}};await B.addColumn(n,D),await ye(),de({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),p(null)}catch(D){p(D instanceof Error?D.message:"Failed to add column")}},vt=async(s,u)=>{if(!(!n||!u||s===u))try{await B.renameColumn(n,s,u),await ye(),pe(null),p(null)}catch(b){p(b instanceof Error?b.message:"Failed to rename column")}},Cr=async s=>{n&&f({title:"Drop Column",message:`Are you sure you want to drop the column "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{f(null);try{await B.dropColumn(n,s),await ye(),p(null)}catch(u){p(u instanceof Error?u.message:"Failed to drop column")}}})},Tr=async(s,u)=>{if(n)try{const b=await B.validateColumnChanges(n,s,u);if(!b.valid){ne({errors:b.errors,conflictingRows:b.conflictingRows,onConfirm:async()=>{ne(null);try{await B.modifyColumn(n,s,u),await ye(),c(null),p(null)}catch(h){p(h instanceof Error?h.message:"Failed to modify column")}}});return}await B.modifyColumn(n,s,u),await ye(),c(null),p(null)}catch(b){p(b instanceof Error?b.message:"Failed to modify column")}},ue=s=>w.find(u=>u.from===s)||null,wt=async(s,u)=>{if(!s.trim())return null;const b=`${u.table}-${s}`;Ae(h=>({...h,[b]:{isValid:!1,isChecking:!0}}));try{const D=(await B.getTableData(u.table)).data.some(J=>J.id===s);return Ae(J=>({...J,[b]:{isValid:D,isChecking:!1,displayName:D?`Valid ID in ${u.table}`:`ID not found in ${u.table}`}})),D}catch{return Ae(D=>({...D,[b]:{isValid:!1,isChecking:!1,displayName:`Error checking ${u.table}`}})),!1}},Er=(s,u,b)=>{if(["id","created_at","updated_at"].includes(u))return;const h=l.find(J=>J.name===u);if(ue(u)||!h){const J=a.find(V=>V.id===s);J&&q({id:s,data:{...J}})}else je.current=!1,L({rowId:s,columnName:u,value:b})},_t=async(s,u,b)=>{if(n){L(null),o(h=>h.map(D=>D.id===s?{...D,[u]:b}:D));try{await B.updateRecord(n,s,{[u]:b}),p(null)}catch(h){p(h instanceof Error?h.message:"Failed to update record"),L({rowId:s,columnName:u,value:b}),await Te()}}},Sr=()=>{L(null)},Nr=async()=>{if(!(!n||!U))try{const s={...U.data};delete s.id,delete s.created_at,delete s.updated_at,await B.updateRecord(n,U.id,s),await Te(),q(null),p(null)}catch(s){p(s instanceof Error?s.message:"Failed to update record")}},$r=async s=>{if(s.preventDefault(),!!n)try{const u=ee.columns.filter(b=>b.trim()!=="");if(u.length===0){p("At least one column is required for the index");return}await B.createIndex(n,{name:ee.name,columns:u,unique:ee.unique}),await ye(),xe({name:"",columns:[""],unique:!1}),ce(!1),p(null)}catch(u){p(u instanceof Error?u.message:"Failed to create index")}},Ar=async s=>{n&&f({title:"Drop Index",message:`Are you sure you want to drop the index "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{f(null);try{await B.dropIndex(n,s),await ye(),p(null)}catch(u){p(u instanceof Error?u.message:"Failed to drop index")}}})},kt=r.filter(s=>s.type==="user"),jr=r.filter(s=>s.type==="system");return e("div",{children:[e("div",{class:"sm:flex sm:items-center",children:[e("div",{class:"sm:flex-auto",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Database"}),e("p",{class:"mt-2 text-sm text-gray-700",children:"Manage your D1 database tables and data"})]}),e("div",{class:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none flex space-x-3",children:[e("button",{type:"button",onClick:()=>Be(!0),class:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:[e("svg",{class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"History"]}),e("button",{type:"button",onClick:()=>N(!0),class:"inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:"Create Table"})]})]}),k&&!v&&e("div",{class:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:[e("div",{class:"text-sm text-red-700",children:k}),e("button",{onClick:()=>p(null),class:"mt-2 text-xs text-red-600 hover:text-red-500",children:"Dismiss"})]}),m&&e("div",{class:"mt-6 bg-white shadow rounded-lg p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Create New Table"}),e("form",{onSubmit:gr,children:[e("div",{class:"mb-4",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Table Name"}),e("input",{type:"text",value:S.name,onInput:s=>K({...S,name:s.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"my_table",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",required:!0})]}),e("div",{class:"mb-4",children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{class:"space-y-2",children:S.columns.map((s,u)=>{var b,h,D,J;return e("div",{children:[e("div",{class:"flex space-x-2",children:[e("input",{type:"text",value:s.name,onInput:V=>{const Q=[...S.columns];Q[u].name=V.target.value,K({...S,columns:Q})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"column_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*"}),e("select",{value:s.type,onChange:V=>{const Q=[...S.columns];Q[u].type=V.target.value,K({...S,columns:Q})},class:"border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:s.notNull||!1,onChange:V=>{const Q=[...S.columns];Q[u].notNull=V.target.checked,K({...S,columns:Q})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"NN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:((b=s.foreignKey)==null?void 0:b.enabled)||!1,onChange:V=>{const Q=[...S.columns],ve=V.target.checked;Q[u].foreignKey={...Q[u].foreignKey,enabled:ve,column:ve?"id":""},K({...S,columns:Q})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"FK"})]}),u>0&&e("button",{type:"button",onClick:()=>{const V=S.columns.filter((Q,ve)=>ve!==u);K({...S,columns:V})},class:"text-red-600 hover:text-red-900 text-sm",children:"Remove"})]}),((h=s.foreignKey)==null?void 0:h.enabled)&&e("div",{class:"flex space-x-2 ml-4 mt-1",children:[e("select",{value:((D=s.foreignKey)==null?void 0:D.table)||"",onChange:V=>{const Q=[...S.columns];Q[u].foreignKey={...Q[u].foreignKey,table:V.target.value},K({...S,columns:Q})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"",children:"Select table..."}),tt(r).map(V=>e("option",{value:V.name,children:V.name},V.name))]}),e("input",{type:"text",value:((J=s.foreignKey)==null?void 0:J.column)||"",onChange:V=>{const Q=[...S.columns];Q[u].foreignKey={...Q[u].foreignKey,column:V.target.value},K({...S,columns:Q})},placeholder:"id",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]},u)})}),e("button",{type:"button",onClick:()=>K({...S,columns:[...S.columns,{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}]}),class:"mt-2 text-sm text-indigo-600 hover:text-indigo-500",children:"Add Column"}),e("p",{class:"mt-2 text-xs text-gray-500",children:"Note: id, created_at, and updated_at columns will be added automatically"})]}),e("div",{class:"mb-4",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Indexes (Optional)"}),e("button",{type:"button",onClick:()=>{const s=S.columns.filter(b=>b.name.trim()!=="").map(b=>b.name),u=S.name?rt(S.name,s.slice(0,1)):"";K({...S,indexes:[...S.indexes,{name:u,columns:s.slice(0,1),unique:!1}]})},class:"text-sm text-indigo-600 hover:text-indigo-500",children:"Add Index"})]}),e("div",{class:"space-y-3",children:S.indexes.map((s,u)=>e("div",{class:"p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex space-x-2 mb-2",children:[e("input",{type:"text",value:s.name,onInput:b=>{const h=[...S.indexes];h[u].name=b.target.value,K({...S,indexes:h})},placeholder:"index_name",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:s.unique,onChange:b=>{const h=[...S.indexes];h[u].unique=b.target.checked,K({...S,indexes:h})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"Unique"})]}),e("button",{type:"button",onClick:()=>{const b=S.indexes.filter((h,D)=>D!==u);K({...S,indexes:b})},class:"text-red-600 hover:text-red-900 text-sm",children:"Remove"})]}),e("div",{class:"space-y-1",children:[e("label",{class:"text-xs text-gray-700",children:"Columns:"}),s.columns.map((b,h)=>e("div",{class:"flex space-x-2",children:[e("select",{value:b,onChange:D=>{const J=[...S.indexes];J[u].columns[h]=D.target.value,S.name&&(J[u].name=rt(S.name,J[u].columns.filter(V=>V.trim()!==""))),K({...S,indexes:J})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select column..."}),S.columns.filter(D=>D.name.trim()!=="").map(D=>e("option",{value:D.name,children:D.name},D.name))]}),s.columns.length>1&&e("button",{type:"button",onClick:()=>{const D=[...S.indexes];D[u].columns=D[u].columns.filter((J,V)=>V!==h),K({...S,indexes:D})},class:"text-red-600 hover:text-red-500 text-sm",children:"Remove"})]},h)),e("button",{type:"button",onClick:()=>{const b=[...S.indexes];b[u].columns.push(""),K({...S,indexes:b})},class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Add Column"})]})]},u))})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create"}),e("button",{type:"button",onClick:()=>{N(!1),K({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),p(null)},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]}),e("div",{class:"mt-8 grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e("div",{class:"lg:col-span-1",children:e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Tables"}),$&&!n?e("div",{class:"text-sm text-gray-500",children:"Loading..."}):e("div",{class:"space-y-4",children:[e("div",{children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"User Tables"}),e("div",{class:"space-y-1",children:[kt.map(s=>e("div",{class:`flex items-center justify-between p-2 rounded hover:bg-gray-50 ${n===s.name?"bg-indigo-50 border border-indigo-200":""}`,children:[e("div",{class:"flex-1 cursor-pointer",onClick:()=>i(s.name),children:[e("div",{class:"flex items-center gap-2",children:[e("div",{class:"text-sm font-medium text-gray-900",children:s.name}),s.access_policy&&e("span",{class:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.access_policy==="private"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.access_policy})]}),e("div",{class:"text-xs text-gray-500",children:[s.rowCount||0," rows"]})]}),s.type==="user"&&e("div",{class:"relative",children:[e("button",{onClick:u=>{u.stopPropagation(),te(z===s.name?null:s.name)},class:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),z===s.name&&e("div",{class:"absolute right-0 mt-1 w-24 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e("button",{onClick:u=>{u.stopPropagation(),br(s.name),te(null)},class:"w-full px-3 py-2 text-xs text-left text-red-600 hover:bg-red-50",children:"Drop Table"})})]})]},s.name)),kt.length===0&&e("p",{class:"text-sm text-gray-500",children:"No user tables yet"})]})]}),e("div",{children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"System Tables"}),e("div",{class:"space-y-1",children:jr.map(s=>e("div",{class:`flex items-center justify-between p-2 rounded cursor-pointer hover:bg-gray-50 ${n===s.name?"bg-indigo-50 border border-indigo-200":""}`,onClick:()=>i(s.name),children:[e("div",{children:[e("div",{class:"text-sm font-medium text-gray-900",children:s.name}),e("div",{class:"text-xs text-gray-500",children:[s.rowCount||0," rows"]})]}),e("span",{class:"text-xs text-gray-400",children:"Protected"})]},s.name))})]})]})]})})}),e("div",{class:"lg:col-span-2",children:n?e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:n}),(()=>{const s=r.find(u=>u.name===n);return(s==null?void 0:s.type)==="user"&&s.access_policy?e("div",{class:"flex items-center gap-2",children:[e("select",{value:s.access_policy,onChange:u=>{const b=u.target.value;yr(n,b)},disabled:bt===n,class:`text-xs px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 ${s.access_policy==="private"?"border-red-300 bg-red-50 text-red-800":"border-green-300 bg-green-50 text-green-800"}`,children:[e("option",{value:"public",children:"public"}),e("option",{value:"private",children:"private"})]}),bt===n&&e("div",{class:"text-xs text-gray-500",children:"Updating..."})]}):null})()]}),((Ct=r.find(s=>s.name===n))==null?void 0:Ct.type)==="user"&&e("div",{class:"flex space-x-2",children:[e("button",{type:"button",onClick:()=>G(!le),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Edit Schema"}),e("button",{type:"button",onClick:()=>{const s={};l.forEach(u=>{["id","created_at","updated_at"].includes(u.name)||(s[u.name]="")}),F(s),p(null),T(!0)},class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add Record"})]})]}),le&&e("div",{class:"mb-6 p-4 border border-gray-200 rounded-lg",children:[e("h4",{class:"text-sm font-medium text-gray-900 mb-3",children:"Table Schema"}),e("div",{class:"mb-4",children:[e("h5",{class:"text-xs font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{class:"space-y-2",children:l.map(s=>{var u,b;return e("div",{class:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(X==null?void 0:X.oldName)===s.name?e("input",{type:"text",value:(X==null?void 0:X.newName)||"",onInput:h=>{X&&pe({...X,newName:h.target.value})},onKeyDown:h=>{X&&(h.key==="Enter"&&vt(X.oldName,X.newName),h.key==="Escape"&&pe(null))},onBlur:()=>{X&&vt(X.oldName,X.newName)},class:"flex-1 text-sm border-gray-300 rounded px-2 py-1"}):e("div",{class:"flex-1",children:[e("span",{class:"text-sm font-medium text-gray-900",children:s.name}),e("span",{class:"ml-2 text-xs text-gray-500",children:s.type}),s.notnull?e("span",{class:"ml-1 text-xs text-red-500",children:"NOT NULL"}):null,s.pk?e("span",{class:"ml-1 text-xs text-blue-500",children:"PRIMARY KEY"}):null,ue(s.name)&&e("span",{class:"ml-1 text-xs text-green-600",children:["FK → ",(u=ue(s.name))==null?void 0:u.table,".",(b=ue(s.name))==null?void 0:b.to]})]}),!["id","created_at","updated_at"].includes(s.name)&&e("div",{class:"flex space-x-2",children:[e("button",{onClick:()=>pe({oldName:s.name,newName:s.name}),class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Rename"}),e("button",{onClick:()=>{const h=ue(s.name);c({name:s.name,type:s.type,notNull:s.notnull===1,foreignKey:{enabled:!!h,table:(h==null?void 0:h.table)||"",column:(h==null?void 0:h.to)||""}})},class:"text-xs text-blue-600 hover:text-blue-500",children:"Modify"}),e("button",{onClick:()=>Cr(s.name),class:"text-xs text-red-600 hover:text-red-500",children:"Drop"})]})]},s.name)})})]}),e("div",{class:"border-t pt-4",children:[e("h5",{class:"text-xs font-medium text-gray-700 mb-2",children:"Add Column"}),e("form",{onSubmit:kr,children:[e("div",{class:"flex space-x-2",children:[e("input",{type:"text",value:I.name,onInput:s=>de({...I,name:s.target.value}),placeholder:"column_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0}),e("select",{value:I.type,onChange:s=>de({...I,type:s.target.value}),class:"border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:I.notNull,onChange:s=>de({...I,notNull:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"NN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:(Tt=I.foreignKey)==null?void 0:Tt.enabled,onChange:s=>de({...I,foreignKey:{...I.foreignKey,enabled:s.target.checked,column:s.target.checked?"id":""}}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"FK"})]}),e("button",{type:"submit",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add"})]}),((Et=I.foreignKey)==null?void 0:Et.enabled)&&e("div",{class:"flex space-x-2 mt-2",children:[e("select",{value:((St=I.foreignKey)==null?void 0:St.table)||"",onChange:s=>de({...I,foreignKey:{...I.foreignKey,table:s.target.value}}),class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select table..."}),tt(r).map(s=>e("option",{value:s.name,children:s.name},s.name))]}),e("input",{type:"text",value:((Nt=I.foreignKey)==null?void 0:Nt.column)||"",onChange:s=>de({...I,foreignKey:{...I.foreignKey,column:s.target.value}}),placeholder:"id",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]})]}),e("div",{class:"border-t pt-4",children:[e("div",{class:"flex items-center justify-between mb-3",children:[e("h5",{class:"text-xs font-medium text-gray-700",children:"Indexes"}),e("button",{type:"button",onClick:()=>ce(!se),class:"text-xs text-indigo-600 hover:text-indigo-500",children:se?"Hide":"Manage Indexes"})]}),e("div",{class:"space-y-2 mb-3",children:[C.map(s=>e("div",{class:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-2",children:[e("span",{class:"text-sm font-medium text-gray-900",children:s.name}),s.unique&&e("span",{class:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"UNIQUE"})]}),e("div",{class:"text-xs text-gray-500",children:["Columns: ",s.columns.join(", ")]})]}),e("button",{onClick:()=>Ar(s.name),class:"text-xs text-red-600 hover:text-red-500",children:"Drop"})]},s.name)),C.length===0&&e("p",{class:"text-xs text-gray-500",children:"No custom indexes"})]}),se&&e("form",{onSubmit:$r,class:"space-y-3 p-3 bg-blue-50 rounded-md",children:[e("h6",{class:"text-xs font-medium text-gray-700",children:"Create New Index"}),e("div",{children:e("input",{type:"text",value:ee.name,onInput:s=>xe({...ee,name:s.target.value}),placeholder:"index_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})}),e("div",{class:"space-y-2",children:[e("label",{class:"text-xs text-gray-700",children:"Columns:"}),ee.columns.map((s,u)=>e("div",{class:"flex space-x-2",children:[e("select",{value:s,onChange:b=>{const h=[...ee.columns];h[u]=b.target.value,xe({...ee,columns:h})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select column..."}),l.map(b=>e("option",{value:b.name,children:b.name},b.name))]}),ee.columns.length>1&&e("button",{type:"button",onClick:()=>{const b=ee.columns.filter((h,D)=>D!==u);xe({...ee,columns:b})},class:"text-red-600 hover:text-red-500 text-sm",children:"Remove"})]},u)),e("button",{type:"button",onClick:()=>xe({...ee,columns:[...ee.columns,""]}),class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Add Column"})]}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:ee.unique,onChange:s=>xe({...ee,unique:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"Unique Index"})]})}),e("div",{class:"flex space-x-2",children:[e("button",{type:"submit",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create Index"}),e("button",{type:"button",onClick:()=>{ce(!1),xe({name:"",columns:[""],unique:!1})},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]})]}),E&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("h4",{class:"text-lg font-medium text-gray-900 mb-4",children:["Modify Column: ",E.name]}),e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Type"}),e("select",{value:E.type,onChange:s=>c({...E,type:s.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]})]}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:E.notNull,onChange:s=>c({...E,notNull:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"NOT NULL"})]})}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:E.foreignKey.enabled,onChange:s=>c({...E,foreignKey:{...E.foreignKey,enabled:s.target.checked,column:s.target.checked?"id":""}}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"Foreign Key"})]})}),E.foreignKey.enabled&&e("div",{class:"space-y-2",children:[e("select",{value:E.foreignKey.table,onChange:s=>c({...E,foreignKey:{...E.foreignKey,table:s.target.value}}),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"",children:"Select table..."}),tt(r).map(s=>e("option",{value:s.name,children:s.name},s.name))]}),e("input",{type:"text",value:E.foreignKey.column,onChange:s=>c({...E,foreignKey:{...E.foreignKey,column:s.target.value}}),placeholder:"id",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]}),e("div",{class:"mt-6 flex space-x-3",children:[e("button",{onClick:()=>{var b,h;const s={};E.type!==((b=l.find(D=>D.name===E.name))==null?void 0:b.type)&&(s.type=E.type);const u=((h=l.find(D=>D.name===E.name))==null?void 0:h.notnull)===1;E.notNull!==u&&(s.notNull=E.notNull),E.foreignKey.enabled&&E.foreignKey.table&&E.foreignKey.column?s.foreignKey={table:E.foreignKey.table,column:E.foreignKey.column}:E.foreignKey.enabled||(s.foreignKey=null),Tr(E.name,s)},class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Apply Changes"}),e("button",{onClick:()=>c(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),P&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-lg w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Validation Warning"})})]}),e("div",{class:"mb-4",children:[e("p",{class:"text-sm text-gray-700 mb-3",children:"The following issues were found with your changes:"}),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:[e("ul",{class:"list-disc list-inside space-y-1",children:P.errors.map((s,u)=>e("li",{class:"text-sm text-yellow-800",children:s},u))}),P.conflictingRows>0&&e("p",{class:"text-sm text-yellow-800 mt-2 font-medium",children:[P.conflictingRows," rows will be affected."]})]}),e("p",{class:"text-sm text-gray-600 mt-3",children:"Proceeding may result in data loss or corruption. Are you sure you want to continue?"})]}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:P.onConfirm,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Proceed Anyway"}),e("button",{onClick:()=>ne(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),O&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:O.variant==="danger"?e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:O.title})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:O.message})}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:O.onConfirm,class:`inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 ${O.variant==="danger"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"}`,children:"Confirm"}),e("button",{onClick:()=>f(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),U&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"Edit Record"}),e("button",{onClick:()=>q(null),class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{class:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:l.map(s=>{if(["id","created_at","updated_at"].includes(s.name))return e("div",{class:"sm:col-span-2",children:[e("label",{class:"block text-sm font-medium text-gray-500",children:[s.name," (read-only)"]}),e("div",{class:"mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-sm text-gray-500",children:s.name.includes("_at")&&U.data[s.name]?xt(U.data[s.name]):U.data[s.name]||"-"})]},s.name);const u=ue(s.name);return e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:[s.name,s.notnull?e("span",{class:"text-red-500 ml-1",children:"*"}):null,u&&e("span",{class:"text-green-600 ml-1 text-xs",children:["FK → ",u.table,".",u.to]})]}),u?e("div",{class:"relative",children:[e("input",{type:"text",value:U.data[s.name]||"",onInput:b=>{const h=b.target.value;q({...U,data:{...U.data,[s.name]:h}}),h.trim()&&wt(h,u)},class:`mt-1 block w-full border rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm ${U.data[s.name]&&oe[`${u.table}-${U.data[s.name]}`]?oe[`${u.table}-${U.data[s.name]}`].isValid?"border-green-300 bg-green-50":"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:`Enter ${u.table} ID`,required:s.notnull===1}),U.data[s.name]&&oe[`${u.table}-${U.data[s.name]}`]&&e("div",{class:`absolute left-0 top-full mt-1 text-xs px-2 py-1 rounded ${oe[`${u.table}-${U.data[s.name]}`].isValid?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:oe[`${u.table}-${U.data[s.name]}`].isChecking?"Checking...":oe[`${u.table}-${U.data[s.name]}`].displayName})]}):e("input",{type:s.type==="INTEGER"||s.type==="REAL"?"number":"text",value:U.data[s.name]||"",onInput:b=>q({...U,data:{...U.data,[s.name]:b.target.value}}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:s.notnull===1})]},s.name)})}),e("div",{class:"mt-6 flex space-x-3",children:[e("button",{onClick:Nr,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Save Changes"}),e("button",{onClick:()=>q(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),v&&e("div",{class:"mb-6 p-4 border border-gray-200 rounded-lg",children:[e("h4",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Record"}),e("form",{onSubmit:pr,children:[e("div",{class:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:Object.entries(j).map(([s,u])=>e("div",{children:[e("label",{class:"block text-xs font-medium text-gray-700",children:s}),e("input",{type:"text",value:u,onInput:b=>F({...j,[s]:b.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]},s))}),k&&v&&e("div",{class:"mt-3 bg-red-50 border border-red-200 rounded-md p-3",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})})}),e("div",{class:"ml-3",children:e("p",{class:"text-sm text-red-700",children:k})})]})}),e("div",{class:"mt-3 flex space-x-2",children:[e("button",{type:"submit",class:"inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create"}),e("button",{type:"button",onClick:()=>{T(!1),p(null)},class:"inline-flex justify-center py-1.5 px-3 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]}),$?e("div",{class:"text-center py-4 text-sm text-gray-500",children:"Loading data..."}):a.length===0?e("div",{class:"text-center py-8",children:e("p",{class:"text-sm text-gray-500",children:"No data in this table"})}):e("div",{class:"overflow-x-auto",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[l.map(s=>e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s.name},s.name)),e("th",{class:"px-3 py-2"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:a.map((s,u)=>{var b;return e("tr",{"data-record-id":s.id,children:[l.map(h=>{var D,J,V,Q,ve,$t,At,jt;return e("td",{class:`px-3 py-2 whitespace-nowrap text-sm text-gray-900 select-text ${!["id","created_at","updated_at"].includes(h.name)&&((D=r.find(Z=>Z.name===n))==null?void 0:D.type)==="user"?"cursor-pointer hover:bg-gray-50":""}`,onClick:Z=>{var Ft;const fe=`${s.id}-${h.name}`;if(["id","created_at","updated_at"].includes(h.name)||((Ft=r.find(De=>De.name===n))==null?void 0:Ft.type)!=="user")return;const Fe=ae[fe];if(Fe)clearTimeout(Fe.timeout),ge(De=>{const Ee={...De};return delete Ee[fe],Ee}),Z.preventDefault(),Z.stopPropagation(),Er(s.id,h.name,s[h.name]);else{const De=setTimeout(()=>{ge(Ee=>{const Dt={...Ee};return delete Dt[fe],Dt})},400);ge(Ee=>({...Ee,[fe]:{count:1,timeout:De}}))}},title:!["id","created_at","updated_at"].includes(h.name)&&((J=r.find(Z=>Z.name===n))==null?void 0:J.type)==="user"?"Double-click to edit":"",children:(_==null?void 0:_.rowId)===s.id&&(_==null?void 0:_.columnName)===h.name?e("div",{class:"relative",children:[e("input",{type:h.type==="INTEGER"||h.type==="REAL"?"number":"text",value:(_==null?void 0:_.value)||"",onInput:Z=>{if(_){const fe=Z.target.value;L({..._,value:fe});const Fe=ue(h.name);Fe&&fe.trim()&&wt(fe,Fe)}},onKeyDown:Z=>{_&&(Z.key==="Enter"&&!Z.isComposing&&_t(s.id,h.name,_.value),Z.key==="Escape"&&Sr())},onBlur:()=>{_&&_t(s.id,h.name,_.value)},class:`w-full px-2 py-1 border rounded focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${ue(h.name)&&(_!=null&&_.value)&&oe[`${(V=ue(h.name))==null?void 0:V.table}-${_.value}`]?oe[`${(Q=ue(h.name))==null?void 0:Q.table}-${_.value}`].isValid?"border-green-300 bg-green-50":"border-red-300 bg-red-50":"border-indigo-300"}`,ref:Z=>{Ze.current=Z,Z&&!je.current&&(je.current=!0,setTimeout(()=>{Z.focus();const fe=Z.value.length;Z.setSelectionRange(fe,fe)},0))}}),ue(h.name)&&(_==null?void 0:_.value)&&oe[`${(ve=ue(h.name))==null?void 0:ve.table}-${_.value}`]&&e("div",{class:`absolute left-0 -bottom-6 text-xs px-2 py-1 rounded ${oe[`${($t=ue(h.name))==null?void 0:$t.table}-${_.value}`].isValid?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:oe[`${(At=ue(h.name))==null?void 0:At.table}-${_.value}`].isChecking?"Checking...":oe[`${(jt=ue(h.name))==null?void 0:jt.table}-${_.value}`].displayName})]}):h.name.includes("_at")&&s[h.name]?xt(s[h.name]):(h.name==="id"||h.name.endsWith("_id"))&&s[h.name]&&s[h.name].length>8?e("button",{onClick:Z=>{Z.stopPropagation(),vr(Z,s[h.name],u,h.name)},onDblClick:Z=>{Z.preventDefault(),Z.stopPropagation()},class:"text-blue-600 hover:text-blue-800 cursor-pointer underline decoration-dotted relative",title:"Click to copy • Cmd+Click to jump to record",children:[fn(s[h.name]),W===`${u}-${h.name}`&&e("span",{class:"absolute -top-8 left-0 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:"Copied!"})]}):s[h.name]||"-"},h.name)}),e("td",{class:"px-3 py-2 whitespace-nowrap text-right text-sm font-medium",children:((b=r.find(h=>h.name===n))==null?void 0:b.type)==="user"&&e("div",{class:"flex space-x-2",children:[e("button",{onClick:()=>{const h=a.find(D=>D.id===s.id);h&&q({id:s.id,data:{...h}})},class:"text-indigo-600 hover:text-indigo-900",children:"Edit"}),e("button",{onClick:()=>fr(s.id),class:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},s.id||u)})})]})})]})}):e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6 text-center",children:[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e("h3",{class:"mt-2 text-sm font-medium text-gray-900",children:"No table selected"}),e("p",{class:"mt-1 text-sm text-gray-500",children:"Select a table from the list to view its data"})]})})})]}),Xe&&e(pn,{onClose:()=>Be(!1),onRestore:()=>{ze(),n&&(Te(),ye())}})]})}function xn(){const[r,t]=y({userTables:0,systemTables:0,dbStatus:"checking..."});he(()=>{n()},[]);const n=async()=>{try{const i=await B.health(),a=await B.getTables(),o=a.tables.filter(g=>g.type==="user").length,l=a.tables.filter(g=>g.type==="system").length;t({userTables:o,systemTables:l,dbStatus:i.database==="connected"?"connected":"disconnected"})}catch(i){console.error("Failed to load stats:",i),t(a=>({...a,dbStatus:"error"}))}};return e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Dashboard"}),e("div",{class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e(nt,{title:"Database Tables",description:"User-defined tables in D1",href:"/database",stats:`${r.userTables} tables`,status:r.dbStatus}),e(nt,{title:"System Tables",description:"Protected system tables",href:"/database",stats:`${r.systemTables} tables`}),e(nt,{title:"Storage",description:"R2 object storage for files",href:"/storage",stats:"Ready",status:"connected"})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-3",children:[e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Create new table →"}),e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Browse database →"}),e("a",{href:"/storage",class:"text-indigo-600 hover:text-indigo-500 block",children:"Upload files →"}),e("a",{href:"/api/health",target:"_blank",class:"text-indigo-600 hover:text-indigo-500 block",rel:"noopener",children:"View API health →"})]})})})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"API Endpoints"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-2 text-sm",children:[e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/health"}),e("span",{class:"text-green-600",children:"Health check"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables"}),e("span",{class:"text-green-600",children:"List tables"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/tables"}),e("span",{class:"text-green-600",children:"Create table"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables/:name/data"}),e("span",{class:"text-green-600",children:"Get table data"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/storage"}),e("span",{class:"text-green-600",children:"List files"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/storage/upload"}),e("span",{class:"text-green-600",children:"Upload file"})]})]})})})]})]})}function nt({title:r,description:t,href:n,stats:i,status:a}){return e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between",children:[e("dt",{class:"text-sm font-medium text-gray-500 truncate",children:r}),a&&e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a==="connected"?"bg-green-100 text-green-800":a==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a})]}),e("dd",{class:"mt-1 text-3xl font-semibold text-gray-900",children:i}),e("p",{class:"mt-2 text-sm text-gray-600",children:t}),e("a",{href:n,class:"mt-3 text-indigo-600 hover:text-indigo-500 text-sm font-medium inline-block",children:"Manage →"})]})})}class vn{constructor(t="/api"){He(this,"apiBaseUrl");He(this,"vapidPublicKey",null);He(this,"registration",null);this.apiBaseUrl=t}async initialize(){try{return"serviceWorker"in navigator?"PushManager"in window?(this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered:",this.registration),await navigator.serviceWorker.ready,await this.fetchVapidPublicKey(),!0):(console.warn("Push messaging not supported"),!1):(console.warn("Service Workers not supported"),!1)}catch(t){return console.error("Failed to initialize push notifications:",t),!1}}async requestPermission(){try{return"Notification"in window?{granted:await Notification.requestPermission()==="granted"}:{granted:!1,error:"Notifications not supported"}}catch(t){return{granted:!1,error:t instanceof Error?t.message:"Permission request failed"}}}getPermissionStatus(){return"Notification"in window?Notification.permission:null}async subscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const o=await this.requestPermission();if(!o.granted)throw new Error(o.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),i={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")),auth:this.arrayBufferToBase64(n.getKey("auth"))}},deviceInfo:this.getDeviceInfo()},a=await fetch(`${this.apiBaseUrl}/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)});if(!a.ok){const o=await a.json();throw new Error(o.error||"Subscription failed")}return console.log("Successfully subscribed to push notifications"),{success:!0}}catch(t){return console.error("Failed to subscribe to push notifications:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async unsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const t=await this.registration.pushManager.getSubscription();return t?(await t.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:t.endpoint})})).ok||console.warn("Failed to notify server of unsubscription"),console.log("Successfully unsubscribed from push notifications"),{success:!0}):{success:!0}}catch(t){return console.error("Failed to unsubscribe from push notifications:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async isSubscribed(){try{return this.registration?await this.registration.pushManager.getSubscription()!==null:!1}catch(t){return console.error("Failed to check subscription status:",t),!1}}async getSubscription(){try{return this.registration?await this.registration.pushManager.getSubscription():null}catch(t){return console.error("Failed to get subscription:",t),null}}async adminSubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");if(!this.vapidPublicKey)throw new Error("VAPID public key not available");if(this.getPermissionStatus()!=="granted"){const o=await this.requestPermission();if(!o.granted)throw new Error(o.error||"Permission denied")}const n=await this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)}),i={subscription:{endpoint:n.endpoint,keys:{p256dh:this.arrayBufferToBase64(n.getKey("p256dh")),auth:this.arrayBufferToBase64(n.getKey("auth"))}},deviceInfo:this.getDeviceInfo()},a=await fetch(`${this.apiBaseUrl}/push/admin/subscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)});if(!a.ok){const o=await a.json();throw new Error(o.error||"Admin subscription failed")}return console.log("Successfully subscribed admin to push notifications"),{success:!0}}catch(t){return console.error("Failed to subscribe admin to push notifications:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async adminUnsubscribe(){try{if(!this.registration)throw new Error("Service Worker not registered");const t=await this.registration.pushManager.getSubscription();return t?(await t.unsubscribe(),(await fetch(`${this.apiBaseUrl}/push/admin/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({endpoint:t.endpoint})})).ok||console.warn("Failed to notify server of admin unsubscription"),console.log("Successfully unsubscribed admin from push notifications"),{success:!0}):{success:!0}}catch(t){return console.error("Failed to unsubscribe admin from push notifications:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async sendAdminTestNotification(){try{const t=await fetch(`${this.apiBaseUrl}/push/admin/test`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const n=await t.json();throw new Error(n.error||"Admin test notification failed")}return{success:!0}}catch(t){return console.error("Failed to send admin test notification:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async sendTestNotification(){try{const t=await fetch(`${this.apiBaseUrl}/push/send`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:"Test Notification",body:"This is a test notification from Vibebase",icon:"/favicon.svg",tag:"test-notification"})});if(!t.ok){const n=await t.json();throw new Error(n.error||"Test notification failed")}return{success:!0}}catch(t){return console.error("Failed to send test notification:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchVapidPublicKey(){try{const t=await fetch(`${this.apiBaseUrl}/push/vapid-public-key`);if(!t.ok)throw new Error("Failed to fetch VAPID public key");const n=await t.json();this.vapidPublicKey=n.publicKey}catch(t){throw console.error("Failed to fetch VAPID public key:",t),t}}urlBase64ToUint8Array(t){const n="=".repeat((4-t.length%4)%4),i=(t+n).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(i),o=new Uint8Array(a.length);for(let l=0;l<a.length;++l)o[l]=a.charCodeAt(l);return o}arrayBufferToBase64(t){const n=new Uint8Array(t);let i="";for(let a=0;a<n.byteLength;a++)i+=String.fromCharCode(n[a]);return window.btoa(i)}getDeviceInfo(){const n=window.navigator.userAgent;let i="Unknown",a="Unknown",o="web";if(n.includes("Chrome")){i="Chrome";const l=n.match(/Chrome\/(\d+)/);a=l?l[1]:"Unknown"}else if(n.includes("Firefox")){i="Firefox";const l=n.match(/Firefox\/(\d+)/);a=l?l[1]:"Unknown"}else if(n.includes("Safari")&&!n.includes("Chrome")){i="Safari";const l=n.match(/Version\/(\d+)/);a=l?l[1]:"Unknown"}else if(n.includes("Edge")){i="Edge";const l=n.match(/Edge\/(\d+)/);a=l?l[1]:"Unknown"}return n.includes("Mobile")||n.includes("Android")?o="android":(n.includes("iPhone")||n.includes("iPad"))&&(o="ios"),{userAgent:n,browser:i,version:a,platform:o}}}const Le=new vn;function wn(){const[r,t]=y(!1),[n,i]=y(null),[a,o]=y(!1),[l,g]=y([]),[w,x]=y([]),[$,d]=y(""),[k,p]=y("settings"),[v,T]=y(!1),[m,N]=y(null);he(()=>{j(),K(),z(),F(),S()},[]);const j=async()=>{await Le.initialize(),i(Le.getPermissionStatus())},F=async()=>{try{const c=await fetch("/api/push/vapid-public-key");if(c.ok){const P=await c.json();d(P.publicKey)}}catch(c){console.error("Failed to fetch VAPID public key:",c)}},S=async()=>{try{const c=await fetch("/api/push/admin/subscription",{credentials:"include"});if(c.ok){const P=await c.json();t(P.isSubscribed)}}catch(c){console.error("Failed to check admin subscription:",c)}},K=async()=>{try{const c=await fetch("/api/push/rules",{credentials:"include"});if(c.ok){const P=await c.json();g(P.rules||[])}}catch(c){console.error("Failed to fetch rules:",c)}},z=async()=>{try{const c=await fetch("/api/push/logs?limit=50",{credentials:"include"});if(c.ok){const P=await c.json();x(P.logs||[])}}catch(c){console.error("Failed to fetch logs:",c)}},te=async()=>{o(!0);try{const c=await Le.adminSubscribe();c.success?(t(!0),i("granted"),alert("Successfully subscribed to push notifications for testing!")):alert(`Failed to subscribe: ${c.error}`)}catch(c){alert(`Error: ${c}`)}finally{o(!1)}},W=async()=>{o(!0);try{const c=await Le.adminUnsubscribe();c.success?(t(!1),alert("Successfully unsubscribed from push notifications!")):alert(`Failed to unsubscribe: ${c.error}`)}catch(c){alert(`Error: ${c}`)}finally{o(!1)}},re=async()=>{o(!0);try{const c=await Le.sendAdminTestNotification();c.success?(alert("Test notification sent! Check your notifications."),z()):alert(`Failed to send test notification: ${c.error}`)}catch(c){alert(`Error: ${c}`)}finally{o(!1)}},le=async c=>{if(confirm("Are you sure you want to delete this rule?"))try{(await fetch(`/api/push/rules/${c}`,{method:"DELETE",credentials:"include"})).ok?(K(),alert("Rule deleted successfully")):alert("Failed to delete rule")}catch(P){console.error("Failed to delete rule:",P),alert("Error deleting rule")}},G=async c=>{try{(await fetch(`/api/push/rules/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...c,enabled:!c.enabled})})).ok?K():alert("Failed to toggle rule")}catch(P){console.error("Failed to toggle rule:",P),alert("Error toggling rule")}},I=()=>e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"VAPID Configuration"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Public Key"}),e("div",{className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800 break-all",children:$||"Loading..."})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use this public key in your client application for Web Push subscriptions"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),e("div",{className:"bg-gray-50 p-3 rounded-md",children:e("code",{className:"text-sm text-gray-800",children:"mailto:support@vibebase.app"})}),e("p",{className:"text-xs text-gray-500 mt-1",children:"VAPID subject for push notification identification"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Endpoints"}),e("div",{className:"bg-gray-50 p-3 rounded-md space-y-2",children:[e("div",{children:[e("strong",{children:"Subscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/subscribe"})]}),e("div",{children:[e("strong",{children:"Unsubscribe:"})," ",e("code",{className:"text-sm",children:"POST /api/push/unsubscribe"})]}),e("div",{children:[e("strong",{children:"Send Notification:"})," ",e("code",{className:"text-sm",children:"POST /api/push/send"})]})]}),e("p",{className:"text-xs text-gray-500 mt-1",children:"Use these endpoints in your application for end-user push notification management"})]})]})]})}),de=()=>e("div",{className:"space-y-6",children:e("div",{className:"bg-white shadow rounded-lg p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Admin Test Notifications"}),e("p",{className:"text-sm text-gray-600 mb-6",children:"Test push notifications by subscribing your browser and sending test messages"}),e("div",{className:"space-y-4",children:[e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Browser Permission"}),e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${n==="granted"?"bg-green-100 text-green-800":n==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n||"Unknown"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700",children:"Admin Subscription Status"}),e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r?"Subscribed":"Not Subscribed"})]}),e("div",{className:"flex space-x-3",children:r?e(Se,{children:[e("button",{onClick:W,disabled:a,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50",children:a?"Unsubscribing...":"Unsubscribe"}),e("button",{onClick:re,disabled:a,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:a?"Sending...":"Send Test Notification"})]}):e("button",{onClick:te,disabled:a||n==="denied",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50",children:a?"Subscribing...":"Subscribe for Testing"})}),n==="denied"&&e("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e("div",{className:"flex",children:e("div",{className:"ml-3",children:[e("h3",{className:"text-sm font-medium text-yellow-800",children:"Notifications Blocked"}),e("div",{className:"mt-2 text-sm text-yellow-700",children:[e("p",{children:"Browser notifications are blocked. To test push notifications, please:"}),e("ol",{className:"list-decimal list-inside mt-1",children:[e("li",{children:"Click the lock icon in your browser's address bar"}),e("li",{children:'Set notifications to "Allow"'}),e("li",{children:"Refresh this page"})]})]})]})})})]})]})}),X=()=>e("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Rules"}),e("button",{onClick:()=>T(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Create Rule"})]}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:l.map(c=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-center justify-between",children:[e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-lg font-medium text-gray-900",children:c.name}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${c.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:c.enabled?"Enabled":"Disabled"})]}),c.description&&e("p",{className:"text-sm text-gray-600 mt-1",children:c.description}),e("div",{className:"mt-2 text-sm text-gray-500",children:[e("span",{className:"bg-gray-100 px-2 py-1 rounded mr-2",children:c.triggerType}),c.tableName&&e("span",{className:"bg-blue-100 px-2 py-1 rounded mr-2",children:c.tableName}),c.eventType&&e("span",{className:"bg-purple-100 px-2 py-1 rounded mr-2",children:c.eventType}),e("span",{className:"bg-yellow-100 px-2 py-1 rounded",children:c.recipientType})]})]}),e("div",{className:"flex space-x-2",children:[e("button",{onClick:()=>G(c),className:`px-3 py-1 text-sm rounded-md ${c.enabled?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:c.enabled?"Disable":"Enable"}),e("button",{onClick:()=>{N(c),T(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:"Edit"}),e("button",{onClick:()=>le(c.id),className:"px-3 py-1 text-sm bg-red-100 text-red-800 rounded-md hover:bg-red-200",children:"Delete"})]})]})},c.id))}),l.length===0&&e("div",{className:"text-center py-8 text-gray-500",children:"No notification rules configured yet"})]})]}),pe=()=>{const[c,P]=y({name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",triggerType:(m==null?void 0:m.triggerType)||"db_change",tableName:(m==null?void 0:m.tableName)||"",eventType:(m==null?void 0:m.eventType)||"insert",recipientType:(m==null?void 0:m.recipientType)||"all_users",recipientValue:(m==null?void 0:m.recipientValue)||"",titleTemplate:(m==null?void 0:m.titleTemplate)||"",bodyTemplate:(m==null?void 0:m.bodyTemplate)||"",iconUrl:(m==null?void 0:m.iconUrl)||"",imageUrl:(m==null?void 0:m.imageUrl)||"",clickAction:(m==null?void 0:m.clickAction)||"",priority:(m==null?void 0:m.priority)||"normal",ttl:(m==null?void 0:m.ttl)||86400,enabled:(m==null?void 0:m.enabled)??!0});return e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:e("div",{className:"mt-3",children:[e("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:m?"Edit Notification Rule":"Create Notification Rule"}),e("form",{onSubmit:async O=>{O.preventDefault(),o(!0);try{const f=m?`/api/push/rules/${m.id}`:"/api/push/rules",_=m?"PUT":"POST",L={...c,iconUrl:c.iconUrl.trim()||void 0,imageUrl:c.imageUrl.trim()||void 0,clickAction:c.clickAction.trim()||void 0,description:c.description.trim()||void 0,tableName:c.triggerType==="db_change"?c.tableName:void 0,eventType:c.triggerType==="db_change"?c.eventType:void 0,recipientValue:c.recipientType!=="all_users"?c.recipientValue:void 0},U=await fetch(f,{method:_,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(L)});if(U.ok)alert(m?"Rule updated successfully":"Rule created successfully"),T(!1),N(null),K();else{const q=await U.json();console.error("API Error:",q),q.details&&console.error("Validation errors:",q.details),alert(`Failed to ${m?"update":"create"} rule: ${q.error}${q.details?`

Validation errors: `+JSON.stringify(q.details,null,2):""}`)}}catch(f){alert(`Error ${m?"updating":"creating"} rule: ${f}`)}finally{o(!1)}},className:"space-y-4",children:[e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e("input",{type:"text",required:!0,value:c.name,onChange:O=>P({...c,name:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e("input",{type:"text",value:c.description,onChange:O=>P({...c,description:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trigger Type *"}),e("select",{value:c.triggerType,onChange:O=>P({...c,triggerType:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"db_change",children:"Database Change"}),e("option",{value:"api",children:"API Trigger"})]})]}),c.triggerType==="db_change"&&e(Se,{children:[e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Name *"}),e("input",{type:"text",required:!0,value:c.tableName,onChange:O=>P({...c,tableName:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Event Type *"}),e("select",{value:c.eventType,onChange:O=>P({...c,eventType:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"insert",children:"Insert"}),e("option",{value:"update",children:"Update"}),e("option",{value:"delete",children:"Delete"})]})]})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Recipient Type *"}),e("select",{value:c.recipientType,onChange:O=>P({...c,recipientType:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all_users",children:"All Users"}),e("option",{value:"specific_user",children:"Specific User"}),e("option",{value:"column_reference",children:"Column Reference"})]})]}),c.recipientType!=="all_users"&&e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[c.recipientType==="specific_user"?"User ID":"Column Name"," *"]}),e("input",{type:"text",required:!0,value:c.recipientValue,onChange:O=>P({...c,recipientValue:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title Template *"}),e("input",{type:"text",required:!0,value:c.titleTemplate,onChange:O=>P({...c,titleTemplate:O.target.value}),placeholder:"e.g., New message from {{user_name}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Body Template *"}),e("input",{type:"text",required:!0,value:c.bodyTemplate,onChange:O=>P({...c,bodyTemplate:O.target.value}),placeholder:"e.g., {{message}}",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Icon URL"}),e("input",{type:"url",value:c.iconUrl,onChange:O=>P({...c,iconUrl:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),e("input",{type:"url",value:c.imageUrl,onChange:O=>P({...c,imageUrl:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Click Action URL"}),e("input",{type:"text",value:c.clickAction,onChange:O=>P({...c,clickAction:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),e("select",{value:c.priority,onChange:O=>P({...c,priority:O.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"high",children:"High"}),e("option",{value:"normal",children:"Normal"}),e("option",{value:"low",children:"Low"})]})]}),e("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TTL (seconds)"}),e("input",{type:"number",value:c.ttl,onChange:O=>P({...c,ttl:parseInt(O.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e("div",{className:"flex items-center",children:[e("input",{type:"checkbox",id:"enabled",checked:c.enabled,onChange:O=>P({...c,enabled:O.target.checked}),className:"mr-2"}),e("label",{htmlFor:"enabled",className:"text-sm font-medium text-gray-700",children:"Enabled"})]}),e("div",{className:"flex justify-end space-x-3 pt-4",children:[e("button",{type:"button",onClick:()=>{T(!1),N(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e("button",{type:"submit",disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:a?"Saving...":m?"Update Rule":"Create Rule"})]})]})]})})})},E=()=>e("div",{className:"space-y-6",children:[e("h3",{className:"text-lg font-medium text-gray-900",children:"Notification Logs"}),e("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e("ul",{className:"divide-y divide-gray-200",children:w.map(c=>e("li",{className:"px-6 py-4",children:e("div",{className:"flex items-start justify-between",children:e("div",{className:"flex-1",children:[e("div",{className:"flex items-center",children:[e("h4",{className:"text-sm font-medium text-gray-900",children:c.title}),e("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${c.status==="sent"?"bg-green-100 text-green-800":c.status==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:c.status})]}),e("p",{className:"text-sm text-gray-600 mt-1",children:c.body}),c.errorMessage&&e("p",{className:"text-sm text-red-600 mt-1",children:c.errorMessage}),e("div",{className:"mt-2 text-xs text-gray-500",children:["User: ",c.userId," | Provider: ",c.provider," | ",(()=>{console.log("Original log.createdAt:",c.createdAt),console.log("Type of log.createdAt:",typeof c.createdAt);let P;return c.createdAt.includes("T")&&!c.createdAt.endsWith("Z")?P=new Date(c.createdAt+"Z"):P=new Date(c.createdAt),console.log("Parsed date:",P),console.log("Local time:",P.toLocaleString()),P.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})()]})]})})},c.id))}),w.length===0&&e("div",{className:"text-center py-8 text-gray-500",children:"No notification logs available"})]})]});return e("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e("div",{className:"mb-8",children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Push Notifications"}),e("p",{className:"mt-2 text-gray-600",children:"Manage push notification settings, rules, and view delivery logs"})]}),e("div",{className:"border-b border-gray-200 mb-8",children:e("nav",{className:"-mb-px flex space-x-8",children:[{id:"settings",name:"Settings"},{id:"test",name:"Test"},{id:"rules",name:"Rules"},{id:"logs",name:"Logs"}].map(c=>e("button",{onClick:()=>p(c.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${k===c.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:c.name},c.id))})}),k==="settings"&&I(),k==="test"&&de(),k==="rules"&&X(),k==="logs"&&E(),v&&pe()]})}function _n(){const[r,t]=y("app-settings"),[n,i]=y([]),[a,o]=y(!1),[l,g]=y(null),[w,x]=y(""),[$,d]=y(!1),[k,p]=y(null),[v,T]=y([]),[m,N]=y(!1),[j,F]=y(null),[S,K]=y(!1),[z,te]=y({name:"",scopes:[],expires_in_days:30}),[W,re]=y(null),[le]=y(["data:read","data:write","data:delete","tables:read","tables:write","tables:delete","storage:read","storage:write","storage:delete"]),[G,I]=y(null),[de,X]=y([]),[pe,E]=y(!1),[c,P]=y(null),[ne,O]=y(!1),[f,_]=y({}),[L,U]=y(!1),q=async()=>{try{o(!0),g(null);const C=await fetch("/api/admin",{credentials:"include"});if(!C.ok)throw new Error("Failed to load admins");const A=await C.json();i(A.admins)}catch(C){console.error("Failed to load admins:",C),g(C instanceof Error?C.message:"Failed to load admins")}finally{o(!1)}},ae=async C=>{if(C.preventDefault(),!w.trim()){g("GitHub username is required");return}try{d(!0),g(null);const A=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({github_username:w.trim()})});if(!A.ok){const se=await A.json();throw new Error(se.error||"Failed to add admin")}x(""),await q()}catch(A){console.error("Failed to add admin:",A),g(A instanceof Error?A.message:"Failed to add admin")}finally{d(!1)}},ge=async C=>{try{g(null);const A=await fetch(`/api/admin/${C}`,{method:"DELETE",credentials:"include"});if(!A.ok){const se=await A.json();throw new Error(se.error||"Failed to remove admin")}p(null),await q()}catch(A){console.error("Failed to remove admin:",A),g(A instanceof Error?A.message:"Failed to remove admin")}},oe=async()=>{try{N(!0),F(null);const C=await fetch("/api/api-keys/init",{method:"POST",credentials:"include"});if(!C.ok){const ce=await C.json().catch(()=>({}))}const A=await fetch("/api/api-keys",{credentials:"include"});if(!A.ok){const ce=await A.json().catch(()=>({}));throw new Error(`Failed to load API keys: ${A.status} - ${ce.error||"Unknown error"}`)}const se=await A.json();T(se.data||[])}catch(C){console.error("Failed to load API keys:",C);let A="Failed to load API keys";C instanceof Error&&(A=C.message),typeof C=="object"&&C!==null&&"status"in C&&(A+=` (Status: ${C.status})`),F(A)}finally{N(!1)}},Ae=async C=>{if(C.preventDefault(),!z.name.trim()||z.scopes.length===0){F("Name and at least one scope are required");return}try{F(null);const A=await fetch("/api/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(z)});if(!A.ok){const ce=await A.json().catch(()=>({})),ee=`Failed to create API key: ${A.status} - ${ce.error||"Unknown error"}`;throw ce.details?new Error(`${ee}. Details: ${JSON.stringify(ce.details)}`):new Error(ee)}const se=await A.json();re(se.data),K(!1),te({name:"",scopes:[],expires_in_days:30}),await oe()}catch(A){console.error("Failed to create API key:",A),F(A instanceof Error?A.message:"Failed to create API key")}},Ze=async C=>{try{F(null);const A=await fetch(`/api/api-keys/${C}/revoke`,{method:"PATCH",credentials:"include"});if(!A.ok){const se=await A.json().catch(()=>({})),ce=`Failed to revoke API key: ${A.status} - ${se.error||"Unknown error"}`;throw se.details?new Error(`${ce}. Details: ${JSON.stringify(se.details)}`):new Error(ce)}I(null),await oe()}catch(A){console.error("Failed to revoke API key:",A),F(A instanceof Error?A.message:"Failed to revoke API key")}},je=C=>{te(A=>({...A,scopes:A.scopes.includes(C)?A.scopes.filter(se=>se!==C):[...A.scopes,C]}))},Xe=async()=>{try{E(!0),P(null);const C=await fetch("/api/app-settings",{credentials:"include"});if(!C.ok)throw new Error("Failed to load app settings");const A=await C.json();X(A.settings);const se={};A.settings.forEach(ce=>{se[ce.key]=ce.value}),_(se)}catch(C){console.error("Failed to load app settings:",C),P(C instanceof Error?C.message:"Failed to load app settings")}finally{E(!1)}},Be=async()=>{try{U(!0),P(null);const C=await fetch("/api/app-settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(f)});if(!C.ok)throw new Error("Failed to save app settings");const A=await C.json();X(A.settings),O(!1)}catch(C){console.error("Failed to save app settings:",C),P(C instanceof Error?C.message:"Failed to save app settings")}finally{U(!1)}};return he(()=>{q(),oe(),Xe()},[]),e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Settings"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{onClick:()=>t("app-settings"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="app-settings"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Application Settings"}),e("button",{onClick:()=>t("admins"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="admins"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Admin Management"}),e("button",{onClick:()=>t("api-keys"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="api-keys"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"API Keys"})]})}),e("div",{class:"flex-1",children:[r==="app-settings"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex justify-between items-center mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"Application Settings"}),!ne&&e("button",{onClick:()=>O(!0),class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Edit Settings"})]}),c&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:c})}),pe?e("p",{class:"text-gray-500",children:"Loading app settings..."}):e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application Name"}),e("input",{type:"text",value:f.app_name||"",onChange:C=>_(A=>({...A,app_name:C.target.value})),disabled:!ne,class:`w-full px-3 py-2 border ${ne?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"My Vibebase App"}),e("p",{class:"mt-1 text-sm text-gray-500",children:"Used as User-Agent for OAuth providers"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application URL (optional)"}),e("input",{type:"url",value:f.app_url||"",onChange:C=>_(A=>({...A,app_url:C.target.value})),disabled:!ne,class:`w-full px-3 py-2 border ${ne?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"https://myapp.com"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Support Email (optional)"}),e("input",{type:"email",value:f.support_email||"",onChange:C=>_(A=>({...A,support_email:C.target.value})),disabled:!ne,class:`w-full px-3 py-2 border ${ne?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"support@myapp.com"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application Description (optional)"}),e("textarea",{value:f.app_description||"",onChange:C=>_(A=>({...A,app_description:C.target.value})),disabled:!ne,rows:3,class:`w-full px-3 py-2 border ${ne?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"A brief description of your application"})]}),ne&&e("div",{class:"flex gap-3 pt-4",children:[e("button",{onClick:()=>{O(!1);const C={};de.forEach(A=>{C[A.key]=A.value}),_(C)},disabled:L,class:"px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Cancel"}),e("button",{onClick:Be,disabled:L,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50",children:L?"Saving...":"Save Settings"})]})]})]})}),r==="admins"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Admin Management"}),l&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:l})}),e("form",{onSubmit:ae,class:"mb-6",children:e("div",{class:"flex gap-2",children:[e("input",{type:"text",value:w,onInput:C=>x(C.target.value),placeholder:"GitHub username (e.g., meso)",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:$}),e("button",{type:"submit",disabled:$||!w.trim(),class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Adding...":"Add Admin"})]})}),a?e("div",{class:"text-center py-4",children:e("p",{class:"text-gray-500",children:"Loading admins..."})}):e("div",{class:"space-y-2",children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"Current Admins"}),n.length===0?e("p",{class:"text-sm text-gray-500",children:"No admins found"}):e("div",{class:"space-y-2",children:n.map(C=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e("div",{class:"flex items-center space-x-3",children:e("div",{children:[e("p",{class:"text-sm font-medium text-gray-900",children:[C.github_username,C.is_root&&e("span",{class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Root Admin"})]}),e("p",{class:"text-xs text-gray-500",children:["Added ",new Date(C.created_at).toLocaleDateString()]})]})}),!C.is_root&&e("button",{onClick:()=>p({id:C.id,username:C.github_username}),class:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]},C.id))})]})]})}),r==="api-keys"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"API Keys"}),e("div",{class:"flex items-center space-x-2",children:e("button",{onClick:()=>K(!0),class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Create API Key"})})]}),j&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:j})}),m?e("div",{class:"text-center py-4",children:e("p",{class:"text-gray-500",children:"Loading API keys..."})}):e("div",{class:"space-y-2",children:v.length===0?e("p",{class:"text-sm text-gray-500",children:"No API keys found. Create one to get started."}):e("div",{class:"space-y-3",children:v.map(C=>e("div",{class:"border border-gray-200 rounded-lg p-4",children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-2 mb-2",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:C.name}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:C.is_active?"Active":"Revoked"})]}),e("div",{class:"text-sm text-gray-600 space-y-1",children:[e("p",{children:[e("span",{class:"font-medium",children:"Key:"})," ",C.key_prefix]}),e("p",{children:[e("span",{class:"font-medium",children:"Scopes:"})," ",C.scopes.join(", ")]}),e("p",{children:[e("span",{class:"font-medium",children:"Created:"})," ",new Date(C.created_at).toLocaleDateString()]}),C.expires_at&&e("p",{children:[e("span",{class:"font-medium",children:"Expires:"})," ",new Date(C.expires_at).toLocaleDateString()]}),C.last_used_at&&e("p",{children:[e("span",{class:"font-medium",children:"Last used:"})," ",new Date(C.last_used_at).toLocaleDateString()]})]})]}),C.is_active&&e("button",{onClick:()=>I({id:C.id,name:C.name}),class:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Revoke"})]})},C.id))})})]})}),S&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Create New API Key"}),e("form",{onSubmit:Ae,children:[e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e("input",{type:"text",value:z.name,onInput:C=>te(A=>({...A,name:C.target.value})),placeholder:"My Backend Service",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e("div",{class:"space-y-2 max-h-32 overflow-y-auto",children:le.map(C=>e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:z.scopes.includes(C),onChange:()=>je(C),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e("span",{class:"ml-2 text-sm text-gray-700",children:C})]},C))})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Expires in (days)"}),e("select",{value:z.expires_in_days||"",onChange:C=>te(A=>({...A,expires_in_days:C.target.value?parseInt(C.target.value):void 0})),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e("option",{value:"7",children:"7 days"}),e("option",{value:"30",children:"30 days"}),e("option",{value:"90",children:"90 days"}),e("option",{value:"365",children:"1 year"}),e("option",{value:"",children:"Never"})]})]})]}),e("div",{class:"flex space-x-3 mt-6",children:[e("button",{type:"button",onClick:()=>K(!1),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-sm font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create Key"})]})]})]})})})]})]}),W&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})})}),e("h3",{class:"text-lg font-medium text-gray-900 text-center mb-4",children:"API Key Created"}),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:[e("p",{class:"text-sm text-yellow-800 mb-2",children:[e("strong",{children:"Important:"})," Save this key securely. It will not be shown again."]}),e("div",{class:"bg-white p-3 rounded border",children:e("code",{class:"text-sm break-all",children:W.key})})]}),e("div",{class:"text-sm text-gray-600 space-y-1 mb-4",children:[e("p",{children:[e("strong",{children:"Name:"})," ",W.name]}),e("p",{children:[e("strong",{children:"Scopes:"})," ",W.scopes.join(", ")]}),W.expires_at&&e("p",{children:[e("strong",{children:"Expires:"})," ",new Date(W.expires_at).toLocaleDateString()]})]}),e("button",{onClick:()=>re(null),class:"w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"I've saved the key safely"})]})})}),G&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3 text-center",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("h3",{class:"text-lg font-medium text-gray-900 mt-2",children:"Revoke API Key"}),e("div",{class:"mt-2 px-7 py-3",children:e("p",{class:"text-sm text-gray-500",children:['Are you sure you want to revoke the API key "',G.name,'"? This action cannot be undone and will immediately disable the key.']})}),e("div",{class:"items-center px-4 py-3",children:e("div",{class:"flex space-x-3",children:[e("button",{onClick:()=>I(null),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{onClick:()=>Ze(G.id),class:"flex-1 px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300",children:"Revoke"})]})})]})})}),k&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3 text-center",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("h3",{class:"text-lg font-medium text-gray-900 mt-2",children:"Remove Admin"}),e("div",{class:"mt-2 px-7 py-3",children:e("p",{class:"text-sm text-gray-500",children:['Are you sure you want to remove admin "',k.username,'"? This action cannot be undone.']})}),e("div",{class:"items-center px-4 py-3",children:e("div",{class:"flex space-x-3",children:[e("button",{onClick:()=>p(null),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{onClick:()=>ge(k.id),class:"flex-1 px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300",children:"Remove"})]})})]})})})]})}function kn(){const[r,t]=y([]),[n,i]=y(!0),[a,o]=y(null),[l,g]=y(!1),[w,x]=y(new Set);he(()=>{$()},[]);const $=async(m,N)=>{try{i(!0);const j=new URLSearchParams,F=await fetch(`/api/storage?${j}`);if(!F.ok)throw new Error("Failed to load files");const S=await F.json();t(N?[...r,...S.objects]:S.objects)}catch(j){o(j instanceof Error?j.message:"Unknown error")}finally{i(!1)}},d=async m=>{const N=m.target,j=N.files;if(j!=null&&j.length){g(!0);try{for(const F of Array.from(j)){const S=new FormData;if(S.append("file",F),!(await fetch("/api/storage/upload",{method:"POST",body:S})).ok)throw new Error(`Failed to upload ${F.name}`)}await $(),N.value=""}catch(F){o(F instanceof Error?F.message:"Upload failed")}finally{g(!1)}}},k=async m=>{if(confirm(`Delete ${m}?`))try{if(!(await fetch(`/api/storage/${encodeURIComponent(m)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete file");t(r.filter(j=>j.key!==m))}catch(N){o(N instanceof Error?N.message:"Delete failed")}},p=async()=>{if(w.size!==0&&confirm(`Delete ${w.size} files?`))try{if(!(await fetch("/api/storage",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:Array.from(w)})})).ok)throw new Error("Failed to delete files");t(r.filter(N=>!w.has(N.key))),x(new Set)}catch(m){o(m instanceof Error?m.message:"Bulk delete failed")}},v=m=>{if(m===0)return"0 B";const N=1024,j=["B","KB","MB","GB"],F=Math.floor(Math.log(m)/Math.log(N));return`${parseFloat((m/N**F).toFixed(2))} ${j[F]}`},T=m=>{const N=new Set(w);N.has(m)?N.delete(m):N.add(m),x(N)};return n&&r.length===0?e("div",{class:"flex items-center justify-center h-64",children:e("div",{class:"text-gray-500",children:"Loading files..."})}):e("div",{children:[e("div",{class:"flex justify-between items-center mb-6",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Storage"}),e("div",{class:"flex gap-2",children:[w.size>0&&e("button",{type:"button",onClick:p,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:["Delete Selected (",w.size,")"]}),e("label",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer",children:[l?"Uploading...":"Upload Files",e("input",{type:"file",multiple:!0,onChange:d,disabled:l,class:"hidden"})]})]})]}),a&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-red-600",children:a}),e("button",{type:"button",onClick:()=>o(null),class:"mt-2 text-sm text-red-500 hover:text-red-700",children:"Dismiss"})]}),e("div",{class:"bg-white shadow rounded-lg overflow-hidden",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[e("th",{class:"w-12 px-6 py-3",children:e("input",{type:"checkbox",checked:w.size===r.length&&r.length>0,onChange:m=>{m.target.checked?x(new Set(r.map(j=>j.key))):x(new Set)}})}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:r.length===0?e("tr",{children:e("td",{colSpan:6,class:"px-6 py-4 text-center text-gray-500",children:"No files uploaded yet"})}):r.map(m=>e("tr",{class:"hover:bg-gray-50",children:[e("td",{class:"px-6 py-4",children:e("input",{type:"checkbox",checked:w.has(m.key),onChange:()=>T(m.key)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm font-medium text-gray-900",children:m.key})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:v(m.size)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:m.contentType||"Unknown"})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:new Date(m.uploaded).toLocaleString()})}),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e("a",{href:`/api/storage/download/${encodeURIComponent(m.key)}`,class:"text-blue-600 hover:text-blue-900 mr-4",download:!0,children:"Download"}),e("button",{type:"button",onClick:()=>k(m.key),class:"text-red-600 hover:text-red-900",children:"Delete"})]})]},m.key))})]})})]})}function Cn(){return e(ln,{children:e(hr,{children:[e(we,{path:"/",component:xn}),e(we,{path:"/database",component:yn}),e(we,{path:"/custom-sql",component:mn}),e(we,{path:"/storage",component:kn}),e(we,{path:"/push",component:wn}),e(we,{path:"/auth",component:hn}),e(we,{path:"/settings",component:_n})]})})}Kr(e(Cn,{}),document.getElementById("app"));
//# sourceMappingURL=index-C9FBbR_E.js.map
